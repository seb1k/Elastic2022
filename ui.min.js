/**
 * Roundcube webmail functions for the Elastic skin
 *
 * Copyright (c) The Roundcube Dev Team
 *
 * The contents are subject to the Creative Commons Attribution-ShareAlike
 * License. It is allowed to copy, distribute, transmit and to adapt the work
 * by keeping credits to the original autors in the README file.
 * See http://creativecommons.org/licenses/by-sa/3.0/ for details.
 *
 * @license magnet:?xt=urn:btih:90dc5c0be029de84e523b9b3922520e79e0e6f08&dn=cc0.txt CC0-1.0
 */
function rcube_elastic_ui(){var e,t,n=this,i="normal",a="light",o=!1,s=!1,r=rcmail.is_framed(),l={config:{standard_windows:rcmail.env.standard_windows,message_extwin:rcmail.env.message_extwin,compose_extwin:rcmail.env.compose_extwin,help_open_extwin:rcmail.env.help_open_extwin},checkboxes:0,small_screen_config:{standard_windows:!0,message_extwin:!1,compose_extwin:!1,help_open_extwin:!1}},c={},d=[],u=[],m={menu:$("#layout-menu"),sidebar:$("#layout-sidebar"),list:$("#layout-list"),content:$("#layout-content")},p={menu:$("a.task-menu-button"),back_list:$("a.back-list-button"),back_content:$("a.back-content-button")};function h(e,t,n,i){var a,o=!0,s=$("<a>"),l=e.attr("id")||(new Date).getTime(),c=l+"-clone",d=e[0].className+(n?" "+n:"");return t?(a=e.data("popup"))&&(s.data({popup:a,"toggle-button":e.data("toggle-button")}),M(s[0]),o=!1,rcmail.register_menu_button(s[0],a)):(d=d.replace("btn-primary","primary").replace(/(btn[a-z-]*|button|disabled)/g,"").trim(),d+=" button"+(i?"":" disabled")),s.attr({id:c,href:"#",class:d}).append($('<span class="inner">').text(e.text())),o&&s.on("click",(function(t){e.click()})),r&&!t?(s.data("target",e),u.push($.extend({button_id:c},f(e[0].id)))):function(e,t,n){var i=f(e);i&&rcmail.register_button(i.command,t,i.data.type,n,i.data.sel)}(l,c,d.replace(" disabled","")),s}function f(e){var t,n,i;for(i in rcmail.buttons)for(t=0;t<rcmail.buttons[i].length;t++)if((n=rcmail.buttons[i][t]).id==e)return{command:i,index:t,data:n}}function v(){$("[data-list]").filter("ul,table").each((function(){var e=$(this),t=e.data("list");if(rcmail[t]&&rcmail[t].multiselect){var n,i=e.parents("layout-sidebar,#layout-list,#layout-content").last().find(".header"),a=i.find("ul");a.length?(n=a.find("a.select").data("toggle-button"))&&(n=$("#"+n)):a=i,rcmail[t].enable_checkbox_selection();var s=1;e.is("#contacts-table")&&(s=0),s&&e.addClass("withselection"),n=$("<a>").attr({class:"button selection disabled",role:"button",title:rcmail.gettext("select")}),rcmail.addEventListener("listupdate",(function(e){"mail"==rcmail.task&&(listupdate_go_msgs(),check_usernameSPAN_plugin(),rcmail.enable_command("e2022-sortmenu",!0),rcmail.register_command("e2022-sortmenu",e2022_sortmenu),rcmail.enable_command("e2022-filtermenu",!0),rcmail.register_command("e2022-filtermenu",e2022_filtermenu),e2022_sortmenu_start(),e2022_dragdropevent(),redraw_cubeselect(),rcmail.message_list.addEventListener("select",redraw_cubeselect),rcmail.addEventListener("actionafter",(function(e){"delete"==e.action&&hide_messagestack_few_secs()}))),sessionStorage.getItem("autoopen")&&(Date.now()<parseInt(sessionStorage.getItem("autoopen"))&&messagelist.querySelector(".message").dispatchEvent(new Event("mousedown")),sessionStorage.removeItem("autoopen"))}))}o&&rcmail[t]&&("function"==typeof rcmail[t].draggable?rcmail[t].draggable("destroy"):"boolean"==typeof rcmail[t].draggable&&(rcmail[t].draggable=!1),rcmail[t].dblclick_time=0)})),window.MutationObserver&&$("[data-label-msg]").filter("ul,table").each((function(){var e=$('<div class="listing-info hidden">').insertAfter(this),t=$(this),n=function(){var n,i,a=t.data("label-msg"),o=t.is("ul")?t:t.children("tbody");if(!rcmail.env.search_request&&!rcmail.env.qsearch&&a&&!o.children(":visible").length)return n=t.data("label-ext"),i=t.data("create-command"),!n||i&&!rcmail.commands[i]||(a+=" "+n),void e.text(a).removeClass("hidden");e.addClass("hidden")},i=function(){if(rcmail.busy||!t.is(":visible"))return setTimeout(i,250);clearTimeout(l.list_timer),l.list_timer=setTimeout(n,50)};new MutationObserver(i).observe(t[0],{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}),i()})),"print"!=rcmail.env.action&&$("#attachment-list > li").each((function(){H(this)}));var e=function(e){"phone"==i&&rcmail.display_message(rcmail.gettext(e),"confirmation")};if(rcmail.addEventListener("fileappended",(function(t){t.attachment.complete&&(H(t.item),"text/vcard"==t.attachment.mimetype&&rcmail.commands["attach-vcard"]&&e("vcard_attachments.vcardattached"))})).addEventListener("managesieve.insertrow",(function(e){g(e.obj)})).addEventListener("add-recipient",(function(){e("recipientsadded")})),rcmail.init_pagejumper(".pagenav > input"),"mail"==rcmail.task){if("compose"==rcmail.env.action){rcmail.addEventListener("compose-encrypted",(function(e){$("a.mode-html, button.attach").prop("disabled",e.active),$("a.attach, a.responses:not(.edit)")[e.active?"addClass":"removeClass"]("disabled")})),$("#layout-sidebar > .footer:not(.pagenav) > a.button").click((function(){$(this).is(".disabled")&&rcmail.display_message(rcmail.gettext("nocontactselected"),"warning")})),$("a.button.enigma").length&&($("a.button.enigma").remove(),$("#enigmamenu div.form-group").each((function(){$("#compose-options").prepend(this)})));var t=rcmail.get_cookie("fromButton");null==t&&(t=!0,1==_from.options.length&&(t="false")),"false"==t?$("#compose_from").hide():$("#fromButton").prop("checked",!0);var n=$("#compose-subject")[0];n.placeholder=n.closest("#compose_subject").querySelector("label").innerText,is_in_iframe()&&minicompose_start()}$("#fromButton").prop("disabled",!1),rcmail.env.extwin||"compose"!=rcmail.env.action&&"show"!=rcmail.env.action||$("a.mail",m.menu).attr({"aria-disabled":!1,onclick:"return rcmail.command('list','',this,event);"}),"preview"!=rcmail.env.action&&"show"!=rcmail.env.action||($("a").filter('[href^="mailto:"]').each((function(){var e,t;t=(e=this).onclick,e.onclick=null,$(e).on("click",(function(n,i){return i||W($("#mailto-menu"),e,n,t)}))})),elastic2022_change_mailheader(),elastic2022_change_attachmentslist(),elastic2022_markasjunkoption(),window.parent&&"small"==window.parent.UI.get_screen_mode()&&(rcmail.env.display_next=!1,window.parent.rcmail.env.display_next=!1))}else"settings"==rcmail.task?(rcmail.addEventListener("identity-encryption-show",(function(e){g(e.container)})),rcmail.addEventListener("identity-encryption-update",(function(e){g(e.container)})),document.URL.includes("_section=general")&&elastic2022_create_settingsmenu()):"login"==rcmail.env.task&&setTimeout((function(){if($("#ifplcontainer").length){ifplcontainer.remove();var e='\n\t\t\t\t\t\t<div class="custom-control custom-switch" style="display:block;width:100%;text-align:left;margin:12px 0 4px 5px;">\n\t\t\t\t\t\t\t<input type="checkbox" class="custom-control-input" id="_ifpl" name="_ifpl" value="1">\n\t\t\t\t\t\t\t<label class="custom-control-label" for="_ifpl" style="text-indent: 12px;line-height: 32px;">'+rcmail.gettext("ifpl_rememberme","persistent_login")+"</label>\n\t\t\t\t\t\t</div>";$("#rcmloginpwd").parent().append(e)}}));rcmail.set_env({thread_padding:"1.5rem",popup_width_small:1025,popup_width:1200}),rcmail.env.devel_mode&&window.less?less.pageLoadFinished.then((function(){k(),rcmail.env.compose_focus_elem&&$(rcmail.env.compose_focus_elem).focus()})):k();var a,s=rcmail.env.date_format_localized;s&&(a=function(e){$(e).filter(".datepicker").attr("placeholder",s),$(e).parent().find("select").each((function(){J(this)}))},$("input.datepicker").each((function(){a(this)})),rcmail.addEventListener("insert-edit-field",a))}function g(e){if(e||(e=document),$("input.button,button",e).not(".btn").addClass("btn").not(".btn-primary,.primary,.mainaction").addClass("btn-secondary"),$("input.button.mainaction,button.primary,button.mainaction",e).addClass("btn-primary"),$("button.btn.delete,button.btn.discard",e).addClass("btn-danger"),$.each(["warning","error","information","confirmation"],(function(){var t=this;$(".box"+t+":not(.ui.alert)",e).each((function(){P(this,t,!0)}))})),e!=document&&1==$(".popup",e).children().length){var t=$(".popup",e).children().first();if(t.is("img"))$(".popup",e).addClass("justified");else if(t.is("label")){var n=t.find("input").detach(),i=t.detach(),a=n.attr("id");a||n.attr("id",a="dialog-input-elastic"),$(".popup",e).addClass("formcontent").append($('<div class="form-group row">').append(i.attr("for",a).addClass("col-sm-2 col-form-label")).append($('<div class="col-sm-10">').append(n))),n.focus()}}var o="input:not(.button,.no-bs,[type=button],[type=radio],[type=checkbox],[type=file]),textarea";$(o,$(".propform",e)).addClass("form-control"),$("[type=checkbox]",$(".propform",e)).addClass("form-check-input"),$("select",e).addClass("form-control custom-select"),e!=document&&$(o,e).addClass("form-control"),$("table.propform",e).each((function(){var e=0,t=0,n=["sm",4,8];$(this).attr("class").match(/cols-([a-z]+)-(\d)-(\d)/)&&(n=[RegExp.$1,RegExp.$2,RegExp.$3]),$(this).find("> tbody > tr, > tr").each((function(){var i,a,o=$(this),s=["form-group","row"],r=o.children("td");2==r.length?(i=r.first(),a=r.last(),$("label",i).addClass("col-form-label"),i.addClass("col-"+n[0]+"-"+n[1]),a.addClass("col-"+n[0]+"-"+n[2]),1!=a.find("[type=checkbox]").length||a.find(".proplist").length?a.find("input:not([type=hidden]),textarea,radio,select").length?t++:(a.addClass("form-control-plaintext"),e++):(s.push("form-check"),a.find("a").length&&s.push("with-link"),t++),a.children(".datepicker")&&2==a.children("input").length&&a.addClass("datetime")):1==r.length&&r.css("width","100%"),o.addClass(s.join(" "))})),e>t&&$(this).addClass("text-only")})),$("td.input-group",e).each((function(){$(this).children().slice(1).addClass("input-group-append")})),$("fieldset.propform:not(.grouped) div.row",e).each((function(){var e=$("input:not([type=hidden]),select,textarea",this).length>0;e&&$(o,this).addClass("form-control"),$(this).children().last().addClass("col-sm-8"+(e?"":" form-control-plaintext")),$(this).children().first().addClass("col-sm-4 col-form-label"),$(this).addClass("form-group")})),$("fieldset.propform.grouped fieldset",e).each((function(){$(".row",this).each((function(){var e,t=$("input,select,textarea",this).length>0,n=$(this).children();t&&$(o,this).addClass("form-control"),n.length<2||((e=n.first()).is("select")?e.addClass("input-group-prepend"):e.wrap('<span class="input-group-prepend">').addClass("input-group-text"),t||n.last().addClass("form-control-plaintext"),$(".content",this).addClass("input-group-prepend input-group-append input-group-text"),$("a.deletebutton",this).addClass("input-group-text icon delete").wrap('<span class="input-group-append">'),$(this).addClass("input-group"))}))})),$("fieldset.advanced",e).each((function(){var e=$(this).children(".propform").first();e.wrap($("<div>").addClass("collapse")),$(this).children("legend").first().addClass("closed").on("click",(function(){e.parent().collapse("toggle"),$(this).toggleClass("closed")}))})),$(".propform > .prop.block:not(.row)",e).each((function(){$(this).addClass("form-group row").each((function(){$("label",this).addClass("col-form-label").wrap($('<div class="col-sm-4">')),$("input,select,textarea",this).wrap($('<div class="col-sm-8">')),$(o,this).addClass("form-control")}))})),$("td.rowbuttons > a",e).addClass("btn"),$("form.tabbed,div.tabbed",e).each((function(e,t){var n=[],i=$("<ul>").attr({class:"nav nav-tabs",role:"tablist"});$(this).addClass("tab-content").children("fieldset").each((function(t,i){var a,o=i.id||"tab"+e+"-"+t,s=$(i).data("navlink-class");$(i).addClass("tab-pane").attr({id:o,role:"tabpanel"}),a=$("<li>").addClass("nav-item").append($("<a>").addClass("nav-link"+(s?" "+s:"")).attr({role:"tab",href:"#"+o}).text($("legend",i).first().text()).click((function(e){return $(this).tab("show"),z(e),!1}))),$("legend",i).first().hide(),n.push(a)})),i.append(n).insertBefore(t),$("a.nav-link",i).first().click()})),$("input[type=file]:not(.custom-file-input)",e).each((function(){var e=rcmail.gettext("choosefile"+(this.multiple?"s":"")),t=$("<label>").attr({class:"custom-file-label","data-browse":rcmail.gettext("browse")}).text(e);$(this).addClass("custom-file-input").wrap('<div class="custom-file">'),$(this).on("change",(function(){var t=e;this.files.length&&(t=this.files[0].name,this.files.length>1&&(t+=", ...")),$(this).next().text(t)})).parent().append(t)})),$("table:not(.table,.compact-table,.propform,.listing,.ui-datepicker-calendar)",e).filter((function(){return!$(this).parent().is(".propform")&&!$(this).parents("#message-header,.message-htmlpart,.message-partheaders,.boxinformation,.raw-tables").length})).each((function(){var e=$(this).addClass("table");e.parent().addClass("table-responsive-sm"),e.find("thead").addClass("thead-default")})),$("input.pretty-checkbox, .propform input[type=checkbox], .form-check input[type=checkbox], .popupmenu.form input[type=checkbox], .menu input[type=checkbox]",e).each((function(){X(this)})),$(e).is(".actionrow")&&$("input[type=checkbox]",e).each((function(){X(this)})),$(".input-group-combo > select",e).first().on("change",(function(){var e=$(this),t=function(){e[e.next().is(":visible")?"removeClass":"addClass"]("alone")};setTimeout(t,50),setTimeout(t,2e3)})).trigger("change"),$("#message-objects",e).children(":not(.ui.alert)").add(".part-notice").each((function(){var e=String($(this).removeClass("notice part-notice").attr("class")).split(/\s/)[0]||"warning";P(this,e),$(this).addClass("box"+e),$("a",this).addClass("btn btn-primary btn-sm")})),$(".error",e).addClass("is-invalid"),"login"==rcmail.env.task&&e==document&&($("#rcmloginsubmit").addClass("btn-lg text-uppercase w-100"),$("#rcmloginoauth").addClass("btn btn-secondary btn-lg w-100"),$("#login-form table tr").each((function(){var e=$("input,select",this),t=$("label",this),n=e.data("icon"),i=$("<i>").attr("class","input-group-text icon "+e.attr("name").replace("_",""));n&&i.addClass(n),$(this).addClass("form-group row"),t.parent().css("display","none"),e.addClass(e.is("select")?"custom-select":"form-control").attr("placeholder",t.text()).before($('<span class="input-group-prepend">').append(i)).parent().addClass("input-group input-group-lg")}))),$("select:not([multiple])",e).each((function(){J(this)}))}function _(e){var t=[],n=$("#"+e.id).parent().is(".html-editor");if(e.config.plugins+=" autoresize",te()&&(e.config.toolbar="undo redo | link image styleselect"),is_in_iframe()&&(e.config.toolbar="bold italic underline link image attachfile"),"mail"==rcmail.task&&"compose"==rcmail.env.action){var i=!1,a=$("#compose-content > form"),o=function(e){"Tab"==e.key&&e.shiftKey&&$("#compose-content > form").scrollTop(0)};t.push((function(e){e.on("keypress",o)})),$("#composebody").on("keypress",o),a.on("scroll",(function(){var e=$(".tox-editor-container",a),t=e.find(".tox-toolbar-overlord"),n=e.offset(),o=a.offset().top;n&&n.top-o<0?(t.css({position:"fixed",top:o+"px",width:e.width()+"px"}),i=!0):(i&&($("#compose-subject").focus(),i=!1),t.css({position:"relative",top:0,width:"auto"}))})),$(window).resize((function(){a.trigger("scroll")}))}n&&(e.config.toolbar="plaintext | "+e.config.toolbar,e.config.setup_callback=function(e){e.ui.registry.addButton("plaintext",{tooltip:rcmail.gettext("plaintoggle"),icon:"close",onAction:function(t){rcmail.command("toggle-editor",{id:e.id,html:!1},"",t.originalEvent)&&$("#"+e.id).parent().removeClass("ishtml")}}),e.ui.registry.addButton("attachfile",{tooltip:rcmail.labels.choosefiles,text:'<svg height="21" viewBox="0 0 21 21" width="21" xmlns="http://www.w3.org/2000/svg"><path d="m9.24264069 5.05025253v7.07106777c.17157287 3.7363257-1.24264069 5.6219437-4.24264069 5.6568543-3 .0349105-4.41421356-1.8507075-4.24264069-5.6568543v-7.07106777c-.11438191-2.82842712.82842713-4.24264068 2.82842713-4.24264068s2.94280904 1.41421356 2.82842712 4.24264068v7.07106777c.07786153 1.4142136-.39354299 2.1213204-1.41421356 2.1213204s-1.49207509-.7071068-1.41421356-2.1213204v-7.07106777" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="matrix(.70710678 .70710678 -.70710678 .70710678 13.535219 1.393091)"/></svg>',onAction:e=>document.querySelector(".upload-form button").click()})}),t.push((function(e){e.on("OpenWindow",(function(e){var t=$(".tox-dialog:last")[0],n=function(e){var n=$(t).find(".tox-dialog__body"),i=$(t).find(".tox-dialog__footer").find("button");e||(4===i.length?n.closest(".tox-dialog").addClass("tox-search-dialog"):2==i.length&&i.first().insertAfter(i[1])),n.find(".tox-checkbox > input").each((function(){X(this)})),n.find(".tox-textarea,.tox-textfield").addClass("form-control")};window.MutationObserver&&new MutationObserver(n).observe($(".tox-dialog__body-content",t)[0],{childList:!0}),n()}))})),rcmail.addEventListener("editor-load",(function(e){if($.each(t,(function(){this(e.ref.editor)})),is_in_iframe()){document.querySelector(".tox-tinymce").style.height="504px";var n=document.querySelectorAll(".tox-toolbar__primary button");n[0].parentElement.style.display="none";var i=n[n.length-1];i.style.position="absolute",i.style.right="0",$(".hint").appendTo("#dragdiv"),composebody_ifr.contentWindow.addEventListener("dragover",(e=>{"file"==e.dataTransfer.items[0].kind&&window.parent.parent.show_all_dragdivTS()})),composebody_ifr.contentWindow.addEventListener("dragleave",(e=>{window.parent.parent.hide_all_dragdivTS()})),composebody_ifr.contentWindow.addEventListener("drop",(e=>{window.parent.parent.hide_all_dragdivTS()}))}}))}function b(e){if($("ul",e.obj).addClass("menu listing iconized"),$(e.obj).addClass("popupmenu popover"),g(e.obj),$("input",e.obj).addClass("form-control"),ee()&&$(e.obj).is(".googie_window")){var t=rcmail.gettext("close"),n=$("<a>").attr("class","button icon cancel").text(t).click((function(t){t.stopPropagation(),$(".popover-overlay").remove(),$(e.obj).hide()}));$('<h3 class="popover-header">').append(n).prependTo(e.obj),$(".popover-overlay").length||$("<div>").attr("class","popover-overlay").appendTo("body").click((function(){$(this).remove()})),$("ul,button",e.obj).click((function(e){$(e.target).is("input")||$(".popover-overlay").remove()}))}}function y(e){if(r&&$.each(u,(function(t,n){e.command==n.command&&parent.$("#"+n.button_id)[e.status?"removeClass":"addClass"]("disabled")})),"mail"==rcmail.task)switch(e.command){case"reply-list":if(1==rcmail.env.reply_all_mode){var t=rcmail.gettext(e.status?"replylist":"replyall");$(".toolbar a.reply-all").attr("title",t).find(".inner").text(t)}break;case"compose-encrypted":$(".toolbar a.encrypt").parent().show();break;case"compose-encrypted-signed":$("#encryption-menu-button").show()}}function w(){var e=$(window).width();o=e<=1024,i=e>1200?"large":e>768?"normal":"small"}function k(){var e;w(),x(),E(),(e=ee())?(rcmail.set_env(l.small_screen_config),rcmail.enable_command("extwin",!1)):(rcmail.set_env(l.config),rcmail.enable_command("extwin",!0)),$.each(d,(function(){$(this)[e?"hide":"show"]()})),rcmail.triggerEvent("skin-resize",{mode:i})}function x(){if(!r||m.sidebar.length||m.list.length){switch(i){case"phone":S(),j(!1);break;case"small":S(),j(!0),m.list.length&&$(".header > ul.menu",m.list).addClass("popupmenu");break;case"normal":!function(){var e;m.list.length&&(e=m.list.is(l.last_selected)||!m.sidebar.is(l.last_selected)&&!m.sidebar.is(".layout-sticky"),m.list[e?"removeClass":"addClass"]("hidden"));m.sidebar.length&&(e=!m.list.length||m.sidebar.is(l.last_selected)||m.sidebar.is(".layout-sticky"),m.sidebar[e?"removeClass":"addClass"]("hidden"));m.content.removeClass("hidden"),j(!0),L()}();break;case"large":$.each(m,(function(e,t){t.removeClass("hidden")})),L(),m.list&&$(".header > ul.menu.popupmenu",m.list).removeClass("popupmenu")}C(i),T(),bw.webkit&&bw.ipad&&bw.agent.match(/OS 9/)&&$(".iframe-wrapper").each((function(){var e=$(this).height();e&&$(this).children("iframe").height(e)})),document.getElementById("messagecontframe")&&messagecontframe.postMessage("resize_message","*")}else T()}function E(){var e=Z(),t=$(document.documentElement);t[0].className.match(/layout-([a-z]+)/)?RegExp.$1!=e.mode&&t.removeClass("layout-"+RegExp.$1).addClass("layout-"+e.mode):t.addClass("layout-"+e.mode),e.touch&&!t.is(".touch")?t.addClass("touch"):!e.touch&&t.is(".touch")&&t.removeClass("touch")}function C(e){var t=rcmail.env.additional_logos;t&&($("#logo").data("src-default")||$("#logo").data("src-default",$("#logo").attr("src")),"phone"==e&&"dark"==a&&t["small-dark"]?$("#logo").attr("src",t["small-dark"]):"phone"==e&&t.small?$("#logo").attr("src",t.small):"dark"==a&&t.dark?$("#logo").attr("src",t.dark):$("#logo").attr("src",$("#logo").data("src-default")))}function T(){$("#layout > div > .header").each((function(){var e,t=0,n=0,i={left:0,right:0};$(this).children(":visible:not(.position-absolute)").each((function(){e||!$(this).is(".header-title")?i[e?"right":"left"]+=this.offsetWidth:e=$(this)})),0+i.right>=i.left?(t=0,n=i.right+0-i.left):(n=0,t=i.left-(0+i.right)),$(e).css({"margin-right":t+"px","margin-left":n+"px","padding-right":"0px"})}))}function S(){var e,t=!1;m.content.length&&(e=t=m.content.is(l.last_selected),m.content[e?"removeClass":"addClass"]("hidden"),$(".header > ul.menu",m.content).addClass("popupmenu")),m.list.length&&(e=!t&&m.list.is(l.last_selected),m.list[e?"removeClass":"addClass"]("hidden"),$(".header > ul.menu",m.list).addClass("popupmenu")),m.sidebar.length&&(e=!t&&(m.sidebar.is(l.last_selected)||!m.list.length),m.sidebar[e?"removeClass":"addClass"]("hidden")),t&&p.back_list.show()}function L(){p.back_list.filter((function(){return 0==$(this).parents("#layout-sidebar").length})).hide(),$("ul.menu.popupmenu").removeClass("popupmenu")}function R(e){T(),click_menu()}function q(e){m.list.length||m.sidebar.length?(m.sidebar.addClass("hidden").removeClass("layout-sticky"),m.list.removeClass("hidden"),"small"!=i&&"phone"!=i||(l.last_selected=m.list[0]||m.sidebar[0],x(),rcmail.show_contentframe(!1),$("[data-list]",m.list).each((function(){var e=$(this).data("list");rcmail[e]&&(rcmail[e].clear_selection?rcmail[e].clear_selection():rcmail[e].select&&rcmail[e].select())}))),e&&m.list.children(".scroller").scrollTop(0),l.last_selected=m.list[0]):history.back(),T()}function j(e){e?("phone"==i&&($('<div id="menu-overlay" class="popover-overlay">').on("click",(function(){j(!1)})).appendTo("body"),l.menu_initialized||(l.menu_initialized=!0,$("a",m.menu).on("click",(function(e){"phone"==i&&j()}))),m.menu.addClass("popover")),m.menu.removeClass("hidden")):($("#menu-overlay").remove(),m.menu.addClass("hidden").removeClass("popover"))}function I(e){"loading"==e.type&&$(".iframe-loader:visible").length?rcmail.hide_message(e.object):(P(e.object,e.type,!0),$(e.object).attr("role","alert"))}function P(e,t,n){var i,a="ui alert",o=!$(e).is(".noicon");n&&o&&!$(e).is(".aligned-buttons")&&$(e).html($("<span>").html($(e).html())),(i={information:"alert-info",notice:"alert-info",confirmation:"alert-success",warning:"alert-warning",error:"alert-danger",loading:"alert-info loading",uploading:"alert-info loading",vcardattachment:"alert-info"}[t=t.split(" ")[0]])&&(a+=" "+i,o&&$("<i>").attr("class","icon").prependTo(e)),$(e).addClass(a)}function A(e){$();var t=$("a.button.options",e),i=$("input:not([type=hidden])",e),a=i.attr("placeholder"),o=($("form",e),function(){$(e).is(".open")&&t.click()}),s=function(){$(e)[i.val()||"mail"==rcmail.task&&$("#s_interval").val()||rcmail.gui_objects.foldersfilter&&"---"!=$(rcmail.gui_objects.foldersfilter).val()?"addClass":"removeClass"]("active")};t.on("click",(function(i){var a=$(this).data("target"),o=$("#"+a),r=$(e).is(".open");o.length&&(r||(n[a]?n[a](o.get(0),this,i):"function"==typeof window[a]&&window[a](o.get(0),this,i)),o.next()[r?"show":"hide"](),o.toggleClass("hidden"),$(".floating-action-buttons").toggleClass("hidden"),$(e).toggleClass("open"),$("button.search",o).off("click.search").on("click.search",(function(){t.click(),s()})))})),i.on("input change",s).on("focus blur",(function(e){i.attr("placeholder","blur"==e.type?a:"")})),$("a.reset",e).on("click",(function(n){i.val("").change().trigger("keyup.treelist",{keyCode:27}),$(e).is(".open")&&t.click(),rcmail.gui_objects.foldersfilter&&($(rcmail.gui_objects.foldersfilter).val("---").change(),rcmail.folder_filter("---")),s()})),rcmail.addEventListener("init",s).addEventListener("responsebeforesearch",s).addEventListener("beforelist",o).addEventListener("afterlist",s).addEventListener("beforesearch",o)}function M(e,t){if(r&&ee())return parent.UI.popup_init(e,t||window);t||(t=window);var i,a=$(e).data("popup"),o=$(t.$("#"+a).get(0)),s=o,l=$(e).attr("title");$(e).attr({"aria-haspopup":"true","aria-expanded":"false","aria-owns":a}).popover({content:function(){return t!=window&&(o=s.clone(!0,!0)).attr("id",a+"-clone").appendTo(document.body).find("li > a").attr("onclick","").off("click").on("click",(function(n){return $(this).is(".disabled")||($(e).popover("hide"),t.$("#"+$(this).attr("id")).click()),!1})),o.get(0)},trigger:$(e).data("popup-trigger")||"click",placement:$(e).data("popup-pos")||"bottom",animation:!0,boundary:"window",html:!0}).on("show.bs.popover",(function(s){var r=o.data("popup-init");a&&c[a]&&(c[a].transitioning=!0),r&&n[r]?n[r](o.get(0),e,s):r&&t[r]&&t[r](o.get(0),e,s),i=$("div.popover:visible").length+1,o.removeClass("hidden").attr("aria-hidden",!1).find('[aria-haspopup="true"]').data("level",i+1).off("click.popup").on("click.popup",(function(e){e.stopPropagation()})),ee()||o.css("max-height",Math.min(539,$(window).height()-30))})).on("shown.bs.popover",(function(t){var n=ee(),o=$("#"+$(e).attr("aria-describedby"));if(i=$(e).data("level")||1,n){var s=i>1?"back":"close",r=rcmail.gettext(s),l="button icon "+("back"==s?"back":"cancel");$(".popover-header",o).empty().append($("<a>").attr("class",l).text(r).on("click",(function(t){$(e).popover("hide"),i>1&&t.stopPropagation()})).on("mousedown",(function(e){e.stopPropagation()})))}$.each(c,(function(e,t){$(t.target).data("level")==i&&e!=a&&O(e)})),"key"==$(e).data("event")&&(o.off("keydown.popup").on("keydown.popup","a.active",(function(t){var n,i,a="next";switch(t.which){case 27:case 9:return $(e).popover("toggle").focus(),!1;case 38:case 63232:a="previous";case 40:case 63233:for(n=t.target.parentNode;n=n[a+"Sibling"];)if(i=$(n).children(".active")[0]){i.focus();break}return!1}})),o.find("a.active").first().focus()),a&&c[a]&&(c[a].transitioning=!1),n&&!$(".popover-overlay").length&&$("<div>").attr("class","popover-overlay").appendTo("body").click((function(){$(this).remove()})),$(".popover-body",o).addClass("webkit-scroller")})).on("hide.bs.popover",(function(){1==i&&$(".popover-overlay").remove(),a&&c[a]&&o.is(":visible")&&(c[a].transitioning=!0)})).on("hidden.bs.popover",(function(){/-clone$/.test(o.attr("id"))?o.remove():o.attr("aria-hidden",!0).addClass("hidden").appendTo(o.data("popup-parent")||document.body),$(".popover-body:empty").each((function(){$(this).parent().remove()})),a&&c[a]&&delete c[a]})).on("click",(function(){$(this).data("event","mouse")})).on("keydown",(function(e){if(e.originalEvent)switch(e.originalEvent.which){case 13:case 32:e.preventDefault(),$(this).data("event","key").popover("toggle");break;case 27:$(this).popover("hide")}})),l&&$(e).attr("title",l),o.attr("aria-hidden","true").data("button",e),o.data("editable")&&o.on("click mousedown",(function(e){e.stopPropagation()}))}function z(e){t&&t>(new Date).getTime()-250||$(".popover.show").each((function(){var t=$(".popover-body",this).children().first().data("button");t&&e.target!=t&&!$(t).find(e.target).length&&"string"!=typeof t&&$(t).popover("hide"),t||$(this).remove()}))}function B(e){if(e&&e.name&&(!e.props||!1!==e.props.skinable)){if(r&&ee())return e.win||(e.win=window),parent.UI.menu_toggle(e);if("messagelistmenu"==e.name);else if("menu-open"==e.event){var t,n,i=$("ul",e.obj).first(),a=e.props&&e.props.link?e.props.link:e.originalEvent.target;if(!i.length)return;$(a).is("span")&&(a=$(a).parents("a,li")[0]),e.name.match(/^drag/)&&(n=rcube_event.get_mouse_pos(e.originalEvent),a=$("<a>").css({position:"absolute",left:n.x,top:n.y,height:"1px",width:"1px",visibility:"hidden"}).appendTo(document.body).get(0)),n=$(a).data("popup-pos")||"right","folder-selector"==e.name?i.addClass("listing folderlist"):"addressbook-selector"==e.name||"contactgroup-selector"==e.name?i.addClass("listing contactlist"):i.hasClass("menu")&&i.addClass("listing"),"pagejump-selector"==e.name&&(i.addClass("simplelist"),e.obj.addClass("simplelist"),n="top"),c[e.name]&&O(e.name,e.originalEvent),(t=function(){if(c[e.name]&&c[e.name].transitioning)return setTimeout(t,50);$(a).data("popup")||($(a).data({event:rcube_event.is_keyboard(e.originalEvent)?"key":"mouse",popup:e.name,"popup-pos":n,"popup-trigger":"manual"}),M(a,e.win)),c[e.name]={target:a},setTimeout((function(){$(a).popover("show")}),1)})()}else O(e.name,e.originalEvent);e.originalEvent.stopPropagation()}}function O(e,t){var n=function(e){var t;c[e]?t=c[e].target:(t=$("#"+e).data("button"))||(e.match(/(?!-)menu$/)&&(e=e.substr(0,e.length-4)),t=$("#"+e+"-menu").data("button"));return t}(e);e.match(/^drag/)?$(n).popover("dispose").remove():($(n).popover("hide"),"forwardmenu"==e&&z(t))}function D(e){$("[aria-owns="+e+"]").popover("dispose").data("popup",null)}function N(e,t,n){var i=$(t).parent().attr("id").replace(/^attach/,"");return $.each(["open","download","rename"],(function(){var t=this;$("#attachmenu"+t,e).off("click").attr("onclick","").click((function(e){return rcmail.command(t+"-attachment",i,this,e.originalEvent)}))})),rcmail.command("menu-open",{menu:"attachmentmenu",id:i},e,n)}function H(e){if(!(e=$(e)).is(".no-menu")&&!e.children(".dropdown").length){var t=rcmail.gettext("options"),n=e.find("a.filename"),i=$("<a>").attr({href:"#",tabindex:n.attr("tabindex")||0,title:t,class:"button icon dropdown skip-content"}).on("click",(function(e){return N($("#attachmentmenu"),i,e)})).append($("<span>").attr("class","inner").text(t));n.length?i.insertAfter(n):i.appendTo(e)}}function W(e,t,n,i){var a=$(t).attr("href").replace(/^mailto:/,"");return a.indexOf("@")<0||(e.find("a").off("click").removeClass("active"),rcmail.env.has_writeable_addressbook&&$(".addressbook",e).addClass("active").on("click",(function(e){var n=a,i=$(t).filter(".rcmContactAddress").text();return n=n.split("?")[0].split(",")[0].replace(/(^<|>$)/g,""),i&&(n='"'+(i=i.replace("<"+n+">","")).trim()+'" <'+n+">"),rcmail.command("add-contact",n,this,e.originalEvent)})),$(".compose",e).addClass("active").on("click",(function(e){return i?(t.onclick=i,$(t).trigger("click",[!0]),t.onclick=null):rcmail.command("compose",a,this,e.originalEvent),!1})),rcmail.command("menu-open",{menu:"mailto-menu",link:t},t,n.originalEvent))}function F(e){var t=$("#quotadisplay"),n=t.find(".bar"),i=e.total?e.percent:0;n.length||(n=$('<span class="bar"><span class="value"></span></span>').appendTo(t)),i>0&&i<10&&(i=10),n.find(".value").css("width",i+"%")[i>=90?"addClass":"removeClass"]("warning"),t.attr({"data-original-title":"",title:t.find(".count").attr("title")}),e.table?t.css("cursor","pointer").data("popup-pos","top").off("click").on("click",(function(t){rcmail.simple_dialog(e.table,"quota",null,{cancel_button:"close"})})):t.tooltip("dispose").tooltip({trigger:ee()?"click":"hover"})}function Y(e){e=e.replace(/[,;\s]*[\r\n]+/g,",").trim();var t=[],n='(\\S+|("[^"]+"))@\\S+',i=new RegExp("(<"+n+">)"),a=new RegExp("("+n+")"),o=e.match(/(?=\S)[^",;]*(?:"[^\\"]*(?:\\[,;\S][^\\"]*)*"[^",;]*)*/g);return $.each(o||[],(function(){if(this.length&&(i.test(this)||a.test(this))){var n,o=this;for(e=e.replace(o,"");o.length&&0===o.indexOf(RegExp.$1)&&(n=RegExp.$1,t.push({name:"",email:n.replace(/(^<|>$)/g,"").replace(/[^a-z]$/gi,"")}),o=o.replace(n,"").trim(),i.test(o)||a.test(o)););n!=RegExp.$1&&RegExp.$1&&(n=RegExp.$1,t.push({name:o.replace(n,"").trim(),email:n.replace(/(^<|>$)/g,"")}))}})),e=e.replace(/[,;]+/,",").replace(/^[,;\s]+/,""),{recipients:t,text:e}}function U(e){if((e=$(e)).length){var t=$('<div class="iframe-loader">').append($('<div class="spinner spinner-border" role="status">').append($('<span class="sr-only">').text(rcmail.gettext("loading"))));e.on("load error loaded",(function(){setTimeout((function(){t.remove()}),500)})).parent().append(t),s&&e.parent().addClass("ios-scroll")}}function X(e){var t,n;(e=$(e)).is(".custom-control-input")||((n=e.attr("id"))||(n="icochk"+ ++l.checkboxes,e.attr("id",n)),e.parent().is("label")?(t=e.parent(),e=e.detach(),t.before(e)):t=$("<label>"),t.attr({for:n,class:"custom-control-label",title:e.attr("title")||""}).on("click",(function(e){e.stopPropagation()})),e.addClass("form-check-input custom-control-input").wrap('<div class="custom-control custom-switch">').parent().append(t))}function Q(e){var t,n=$(e.row).find("input[id^=icochk]");n.length&&(t="icochk"+ ++l.checkboxes,n.attr("id",t).next("label").attr("for",t))}function J(e){if(!bw.iphone&&!bw.ipad&&!(e=$(e)).is(".pretty-select")){var n="select"+e.attr("id")+e.attr("name"),i=function(){if(e[0].ownerDocument.defaultView.$(".select-menu .listing").data("ident")==n)return!0},a=function(){var t=i();return e.popover("dispose").focus(),!t};e.addClass("pretty-select custom-select form-control").on("mousedown keydown",(function(o){if(!(e=$(o.target)).prop("disabled"))return 9==o.which?(a(),!0):27==o.which||"mousedown"==o.type&&i()?a():(e.focus(),e.prop("disabled",!0),setTimeout((function(){e.prop("disabled",!1)}),0),o.stopPropagation(),"mousedown"==o.type||13==o.which||32==o.which||40==o.which||63233==o.which?(function(t){var i,o=-1,s=[],r=[],l=e.closest(".ui-dialog")[0],c=(document.documentElement.clientHeight||$(document.body).height())-75,d=$(document.body).width()-20,u=Math.min(e.outerWidth(),d),m=e.val();ee()||(c*=.5),z(t),$("option",e).each((function(){var e=$(this).text(),t=$('<a href="#">').data("value",this.value).addClass(this.disabled?"disabled":"active"+(this.value==m?" selected":""));e.length?(t.text(e),r.push(this.disabled?"":e.charAt(0).toLowerCase())):(t.html("&nbsp;"),r.push("")),s.push($("<li>").append(t))}));var p=$('<ul class="listing selectable iconized">').attr("data-ident",n).data("button",e[0]).append(s).on("click","a.active",(function(){var t=$(this).data("value"),n=a();return e.val(t).change(),n})).on("keydown","a.active",(function(e){var t,n,s,l,c="next";switch(e.which){case 27:case 9:return a();case 13:case 32:return $(this).click(),!1;case 38:case 63232:c="previous";case 40:case 63233:for(t=e.target.parentNode;t=t[c+"Sibling"];)if(l=$(t).children(".active")[0]){l.focus();break}return!1;default:(n=e.originalEvent.key)&&1==n.length&&(n=n.toLowerCase(),i!=n&&(o=-1),((s=r.indexOf(n,o+1))>-1||(s=r.indexOf(n))>-1)&&p.find("a").eq(s).focus(),i=n,o=s)}}));e.popover("dispose").popover({container:l||document.body,content:p[0],placement:"bottom",trigger:"manual",boundary:"viewport",html:!0,offset:"0,2",sanitize:!1,template:'<div class="popover select-menu" style="min-width: '+u+"px; max-width: "+d+'px"><div class="popover-header"></div><div class="popover-body" style="max-height: '+c+'px"></div></div>'}).on("shown.bs.popover",(function(){e.focus(),p.parent().prev().empty().append($('<a class="button icon cancel">').text(rcmail.gettext("close")).on("click",(function(e){return e.stopPropagation(),a()})));var n=p.find("a.selected").first();if(n.focus().length){var s=p.parent();o=p.find("a").index(n[0]),i=r[o],bw.mz&&o>5&&s.scrollTop(s.scrollTop()+s.height()/2-20)}else rcube_event.is_keyboard(t)&&p.find("a.active").first().focus();p.on("mousedown",(function(e){e.stopPropagation()}))})).popover("show")}(o),t=(new Date).getTime(),!1):void 0)}))}}function K(e,t,n,i,a){error("smart_field_row_add");var o,s=$('<div class="input-group"><input type="text" class="form-control"><span class="input-group-append"><a class="icon reset input-group-text" href="#"></a></span></div>');return o=s.find("input").attr({value:t,name:i.name+"[]",size:$(i).data("size"),title:i.title,placeholder:i.placeholder}).keydown((function(t){if(13==t.which){var n=K(e,"",(new Date).getTime(),i,o.parent());$("input",n).focus()}else if((8==t.which||46==t.which)&&""==o.val()){var a=o.parent();if(e.children().length>1)return a.prev().length?a.prev().children("input").focus():a.next().children("input").focus(),a.remove(),!1}})),s.find("a.reset").click((function(){var t=$(this.parentNode.parentNode);e.children().length>1?($("input",t.next().length?t.next():t.prev()).focus(),t.remove()):$("input",t).val("").focus()})),s.find("input,a").on("focus",(function(){e.addClass("focused")})).on("blur",(function(){e.removeClass("focused")})),a?a.after(s):s.appendTo(e),s}function V(t){var n=t.find(".scroller .listing").first().attr("id"),i=rcmail.env.task+"."+(n||rcmail.env.action+"."+t.attr("id")),a=function(t){e||(e=rcmail.local_storage_get_item("prefs.elastic",{}));if(null==e[t]){var n=rcmail.get_cookie(t);null!=n&&(e[t]=n,rcmail.local_storage_set_item("prefs.elastic",e)&&rcmail.set_cookie(t,n,new Date))}return e[t]}(i),o=t.is(".sidebar-right"),s=function(e){t.css({width:Math.max(100,e),flex:"none"})};t[o?"prev":"next"]().length&&($('<div class="column-resizer">').addClass(o?"inverted":null).appendTo(t).on("mousedown",(function(n){var a,r=$(this),l=t.position().left;r.addClass("active"),document.body.style.userSelect="none",$(document).on("mousemove.resizer",(function(e){clearTimeout(a),a=setTimeout((function(){o&&(l=t.position().left);var n=rcube_event.get_mouse_pos(e).x,i=o?t.width()+(l-n):n-l;s(i)}),5)})).on("mouseup.resizer",(function(){$(document).off(".resizer"),$("iframe").off(".resizer"),document.body.style.userSelect="auto",r.removeClass("active"),function(t,n){e[t]=n,rcmail.local_storage_set_item("prefs.elastic",e)||rcmail.set_cookie(t,n,!1)}(i,t.width())}))})),a&&s(a))}function G(e,t,n,i){var o=function(e){$(e).css({color:$(document.body).css("color"),backgroundColor:$(document.body).css("background-color")})},s="dark"==a&&/_task=mail/.test(e)&&/_action=viewsource/.test(e);if(!ee()||!0===i){/_task=mail/.test(e)&&/_action=get/.test(e)&&(t=!0);var r=l.open_window.call(rcmail,e,t,n);return s&&$(r).on("load",(function(){o(r.document.body)})),r}e=rcmail.add_url(e,"_framed",1),e=rcmail.add_url(e,"_extwin",1);var c,d="",u={cancel_button:"close",width:768,height:768},m=$("<iframe>").attr({id:"windowframe",src:e});return/_action=([a-z_]+)/.test(e)&&(c=rcmail.labels[RegExp.$1])&&(d=c),/_frame=1/.test(e)&&(u.dialogClass="no-titlebar"),s&&m.on("load",(function(){o(m[0].contentWindow.document.body)})),rcmail.simple_dialog(m,d,null,u),!0}function Z(){if(r){var e=$(parent.document.documentElement);return{mode:e[0].className.match(/layout-([a-z]+)/)?RegExp.$1:i,touch:e.is(".touch")}}return{mode:i,touch:o}}function ee(){var e=Z();return"phone"==e.mode||"small"==e.mode}function te(){return Z().touch}this.register_content_buttons=function(e){if(l.frame_nav&&e&&e.length){var t=l.frame_nav.children(".buttons");d=[],$.each(e,(function(){this.data("target")&&d.push(this.data("target"))})),t.html("").append(e)}},this.menu_hide=O,this.menu_toggle=B,this.menu_destroy=D,this.popup_init=M,this.about_dialog=function(e){var t,n,i=!1,a=$("<iframe>").attr({id:"aboutframe",src:rcmail.url("settings/about",{_framed:1})}),o=$("#supportlink");o.length&&(t=o.attr("href"))&&(i=o.text(),n=function(e){t.indexOf("mailto:")<0?window.open(t):location.href=t});rcmail.simple_dialog(a,$(e).text(),n,{button:i,button_class:"help",cancel_button:"close",height:400})},this.headers_dialog=function(){if(document.getElementById("messagecontframe"))return void messagecontframe.postMessage("headers_dialog","*");var e={_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_framed:1},t=$("<iframe>").attr({id:"headersframe",src:rcmail.url("headers",e)});rcmail.simple_dialog(t,"Headers",null,{cancel_button:"close",height:600});return!0},this.import_dialog=function(){if(!rcmail.commands["import-messages"])return;var e=$("#uploadform").clone(!0);rcmail.simple_dialog(e,rcmail.gettext("importmessages"),(function(t){return rcmail.command("import-messages",$(e.find("form")[0]))}),{button:"import",closeOnEscape:!0,minWidth:400})},this.props_dialog=function(){var e=$("#properties-menu").clone();rcmail.simple_dialog(e,rcmail.gettext("properties"),null,{cancel_button:"close",height:400})},this.spellmenu=function(e){var t,n,i=[],a=rcmail.spellcheck_lang(),o=$("ul",e);if(!o.length){for(t in o=$('<ul class="selectable listing iconized" role="menu">'),rcmail.env.spell_langs)n=$('<li role="menuitem">'),$('<a href="#'+t+'" tabindex="0"></a>').text(rcmail.env.spell_langs[t]).addClass("active").data("lang",t).on("click keypress",(function(e){if("keypress"!=e.type||13==rcube_event.get_keycode(e))return rcmail.spellcheck_lang_set($(this).data("lang")),rcmail.hide_menu("spell-menu",e),!1})).appendTo(n),i.push(n);o.append(i).appendTo(e)}$("li",o).each((function(){var e=$("a",this);e.data("lang")==a?e.addClass("selected").attr("aria-selected","true"):e.hasClass("selected")&&e.removeClass("selected").removeAttr("aria-selected")}))},this.searchmenu=function(e){var t,n="*",i=$('input[name="s_mods[]"]',e),a=$("#s_scope",e),o=$("#s_interval",e),s=rcmail.env.mailbox,r=rcmail.env.search_mods,l=rcmail.env.search_scope||"base";$(e).data("initialized")||($(e).data("initialized",!0),i.length&&(i.on("change",(function(){!function(e,t){var n,i,a=rcmail.env.task,o=rcmail.env.search_mods||{},s=rcmail.env.mailbox;"mail"==a?(o[s]||(o[s]=rcube_clone_object(o["*"])),i=o[s],n="text"):(i=o,n="*");t.checked?i[t.value]=1:delete i[t.value];t.value==n&&$('input[name="s_mods[]"]',e).not(t).map((function(){this.checked=!0,t.checked?(this.disabled=!0,delete i[this.value]):(this.disabled=!1,i[this.value]=1)}));rcmail.set_searchmods(i)}(e,this)})),rcmail.addEventListener("beforesearch",(function(){rcmail.env.search_scope=a.val(),rcmail.env.search_interval=o.val()}))));if(a.val(l),r)if("mail"==rcmail.env.task&&(r=r[s]||r["*"],n="text"),r[n])i.map((function(){this.checked=!0,this.disabled=this.value!=n}));else for(t in i.prop("disabled",!1).prop("checked",!1),r)i.filter('[value="'+t+'"]').prop("checked",!0)},this.header_reset=function(e){$("#"+e).val("").change().closest(".form-group").nextAll(":not(.hidden)").first().find("input").focus(),$("a[data-target="+e.replace(/^_/,"")+"]").addClass("active"),rcmail.set_menu_buttons(),$("#mini"+e).show()},this.attachmentmenu=N,this.mailtomenu=W,this.recipient_selector=function(e,t){t||(t={});var n=rcmail.gettext(t.title||"insertcontact"),i=$("#recipient-dialog"),a=i.parent(),o=function(){i.is(":visible")&&rcmail.env.recipient_dialog.dialog("close")};rcmail.env.recipient_selector_initialized||(rcmail.addEventListener("add-recipient",o),rcmail.env.recipient_selector_initialized=!0);e&&(rcmail.env.focused_field="#_"+e);rcmail.contact_list.clear_selection(),rcmail.contact_list.multiselect=!("multiselect"in t)||t.multiselect,rcmail.env.recipient_dialog=rcmail.simple_dialog(i,n,(function(){if(t.action)return t.action(),void o();rcmail.command("add-recipient")}),{button:rcmail.gettext(t.button||"insert"),button_class:t.button_class||"insert recipient",height:600,classes:{"ui-dialog-content":"p-0"},open:function(){$("#directorylist a").first().focus()},close:function(){i.appendTo(a),$(this).remove(),$(t.focus||rcmail.env.focused_field).focus()}})},this.show_list=q,this.show_sidebar=R,this.smart_field_init=function(e){var t=e.id+"_list",n=$('<div class="multi-input"><div class="content"></div><div class="invalid-feedback"></div></div>'),i=e.value?e.value.split("\n"):[""];if($("#"+t).length)return;$.each(i,(function(t,i){K($(".content",n),i,t,e)})),n.attr("id",t),(e=$(e)).attr("disabled")?n.hide():e.prop("disabled",!0);e.data("hidden")&&n.hide();e.after(n),e.hasClass("is-invalid")&&(n.addClass("is-invalid"),$(".invalid-feedback",n).text(e.data("error-msg")))},this.smart_field_reset=function(e,t){var n=e.id+"_list",i=t.length?t:[""],a=$("#"+n).children(".content");a.empty(),$.each(i,(function(t,n){K(a,n,t,e)}))},this.form_errors=function(e){$.each(e,(function(){var e=$("#"+this[0]).addClass("is-invalid");if("list"==e.data("type"))return e.data("error-msg",this[2]),void $("#"+this[0]+"_list > .invalid-feedback").text(this[2]);e.after($('<span class="invalid-feedback">').text(this[2]))}))},this.switch_nav_list=function(e){var t,n,i=$("a",e),a=$(e).next();a.height()?(a.animate({height:"0"},250),i.addClass("expand").removeClass("collapse"),$(e).removeClass("expanded")):(t=$("tr,li",a).filter((function(){return"none"!=this.style.display})),n=$(t[0]).height()||50,a.animate({height:Math.min(5,t.length)*n+1+"px"},250),i.addClass("collapse").removeClass("expand"),$(e).addClass("expanded"))},this.searchbar_init=A,this.pretty_checkbox=X,this.pretty_select=J,this.datepicker_init=function(e){window.MutationObserver&&$(e).not("[data-observed]").each((function(){var e,t=!0,n=r?parent:window;$(this).attr("data-observed","1"),r&&($(this).detach().appendTo(parent.document.body),$('<div id="ui-datepicker-div" class="hidden">').appendTo(document.body)),new MutationObserver((function(i){$.each(i,(function(i,a){if("attributes"==a.type){var o="true"==$(a.target).attr("aria-hidden");o!=t&&(o?e&&e.remove():e=$("<div>").attr("class","ui-widget-overlay datepicker").appendTo(n.document.body).click((function(e){$(this).remove(),r&&$.datepicker._hideDatepicker()})),t=o)}else a.addedNodes.length&&r&&(n.$("select.ui-datepicker-month",a.target).on("change",(function(){$.datepicker._selectMonthYear($.datepicker._lastInput,this,"M")})),n.$("select.ui-datepicker-year",a.target).on("change",(function(){$.datepicker._selectMonthYear($.datepicker._lastInput,this,"Y")})))}))})).observe(this,{childList:!0,subtree:!1,attributes:!0,attributeFilter:["aria-hidden"]})}))},this.bootstrap_style=g,this.get_screen_mode=function(){return i},this.screen_resize_headers=T,this.is_mobile=ee,this.is_touch=te,w(),E(),function(){(function(){if("print"==rcmail.env.action)return;var e=rcmail.get_cookie("colorMode"),t=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){rcmail.set_cookie("colorMode","",new Date)},o=function(){try{$(this.contentWindow.document).find("html")["dark"==a?"addClass":"removeClass"]("dark-mode")}catch(e){}},s=function(){"dark"==a?($("#taskmenu a.theme").removeClass("dark").addClass("light").find("span").text(rcmail.gettext("lightmode")),$(".click_change_theme").removeClass("dark").addClass("light").find("span"),$(".sebicon_contrast_txt").text(rcmail.gettext("lightmode")),$("html").addClass("dark-mode"),$('meta[name="theme-color"]').attr("content","#1A1C1E")):($("#taskmenu a.theme").removeClass("light").addClass("dark").find("span").text(rcmail.gettext("darkmode")),$(".click_change_theme").removeClass("light").addClass("dark").find("span"),$(".sebicon_contrast_txt").text(rcmail.gettext("darkmode")),$("html").removeClass("dark-mode"),$('meta[name="theme-color"]').attr("content","#ffffff")),C(i),$("iframe").each(o)};if(!1===rcmail.env.dark_mode_support)return void("dark"==e&&(n(),$("iframe").each(o)));$("#taskmenu a.theme").on("click",(function(){a=$(this).is(".dark")?"dark":"light",s(),rcmail.set_cookie("colorMode",a,!1)})),$(".click_change_theme").on("click",(function(){a=$(this).is(".dark")?"dark":"light",s(),rcmail.set_cookie("colorMode",a,!1)})),t.addListener((function(e){a=e.matches?"dark":"light",s(),n()})),e?a=e:t.matches&&(a="dark");s(),$("iframe").on("load",o)})(),l.last_selected=$("#layout > div.selected")[0],!l.last_selected&&m.content.length&&$.each(["sidebar","list","content"],(function(){if(m[this].length)return l.last_selected=m[this][0],m[this].addClass("selected"),!1}));if($(window).on("resize",(function(){clearTimeout(l.resize_timeout),l.resize_timeout=setTimeout((function(){k()}),25)})),l.open_window=rcmail.open_window,rcmail.open_window=G,rcmail.addEventListener("message",I).addEventListener("menu-open",B).addEventListener("menu-close",B).addEventListener("editor-init",_).addEventListener("autocomplete_create",b).addEventListener("googiespell_create",b).addEventListener("setquota",F).addEventListener("enable-command",y).addEventListener("destroy-entity-selector",(function(e){D(e.name)})).addEventListener("clonerow",Q).addEventListener("init",v).addEventListener("responseafter",add_prio_icon).addEventListener("listupdate",add_messagecontframe_event_dragdrop),m.list.length||m.content.length){var e=[];$("[data-fab]").each((function(){var t=$(this),n=t.data("fab-task")||"*",i=t.data("fab-action")||"*";"*"!=n&&n!=rcmail.env.task||"*"!=i&&i!=rcmail.env.action&&("none"!=i||rcmail.env.action)||e.push(h(t,!1,!1,!0))})),e.length&&$('<div class="floating-action-buttons">').append(e).appendTo(m.list.length?m.list:m.content)}m.sidebar.length&&V(m.sidebar);m.list.length&&V(m.list)}(),g(),function(){if(l.got_smart_toolbar)return;l.got_smart_toolbar=!0;var e,t=[],n=[],i=Z(),a=function(e,t,n){var i=$('<li role="menuitem">');(e=n?h($(e),!0,"hidden-big hidden-large"):$(e).detach()).contents().filter((function(){3==this.nodeType&&0==this.nodeValue.trim().length&&$(this).remove()})),e.is(".spacer")?i.addClass("spacer"):i.append(e),t.push(i)};if(m.content.find(".header > .menu").each((function(){var e=$(this);e.children().each((function(){a(this,t)})),e.remove()})),m.list.find(".header > .menu").each((function(){var o=$(this);e=o.next(),o.children().each((function(){"large"!=i.mode&&$(this).data("popup-pos","right"),a(this,t,!0),a(this,n)})),o.remove()})),$('ul[data-menu="toolbar-small"] > li > a').each((function(){var e=$(this).clone();e.attr("id",this.id+"_clone"),t.push($('<li role="menuitem">').addClass("hidden-big").append(e))})),n.length){var o=m.list.children(".header"),s={class:"menu toolbar popupmenu listing iconized",id:"toolbar-list-menu"},r=$('<a class="button icon toolbar-list-button" href="#list-menu">').attr({"data-popup":"toolbar-list-menu"}),c=$("<ul>").attr(s).data("popup-parent",o).append(n);e.length?c.insertBefore(e):o.append(c),o.append(r)}if(t.length){o=m.content.children(".header"),s={class:"menu toolbar popupmenu listing iconized",id:"toolbar-menu"},r=$('<a class="button icon toolbar-menu-button" href="#menu">').attr({"data-popup":"toolbar-menu"});o.append($("<ul>").attr(s).data("popup-parent",o).append(t)).append(r),m.list.find("a.toolbar-menu-button").click((function(e){e.stopPropagation(),r.click()}))}}(),function(){if(!m.list.length)return;var e=l.last_selected,t=function(e){"string"==typeof e&&e.length||(e=$("h1.voice").text()||$("title").text()||""),m.content.find(".header > .header-title").text(e)},n=function(n,i,a,o){ee()&&l.frame_nav&&function(e,t){if(e.match(/_action=(create|add)/)||e.match(/_nav=hide/))return void $(l.frame_nav).addClass("hide-nav-buttons");var n,i,a,o=$("[data-list]",m.list).data("list");if(!o||!(a=rcmail[o]))return void($(l.frame_nav).is(".hide-nav-buttons")&&!$(".buttons",l.frame_nav).children().length&&$(l.frame_nav).addClass("hidden"));$(l.frame_nav).removeClass("hide-nav-buttons hidden"),(i=a.get_single_selection())&&(a.rows&&a.rows[i]&&!a.rows[i].expanded?a.expand_row(t,i):a.get_node&&(n=a.get_node(i))&&n.collapsed&&a.expand(i));var s,r,c=$("#"+rcmail.env.contentframe),d=$("a.button.next",l.frame_nav).off("click").addClass("disabled"),u=$("a.button.prev",l.frame_nav).off("click").addClass("disabled");((r=a.get_next())||rcmail.env.current_page<rcmail.env.pagecount)&&d.removeClass("disabled").on("click",(function(){l.content_lock=!0,U(c),r?a.select(r):(rcmail.env.list_uid="FIRST",rcmail.command("nextpage"))}));((s=a.get_prev())&&("*"!=s||"subscription_list"!=o)||rcmail.env.current_page>1)&&u.removeClass("disabled").on("click",(function(){l.content_lock=!0,U(c),s?a.select(s):(rcmail.env.list_uid="LAST",rcmail.command("previouspage"))}))}(i,n),a&&!m.content.is(":visible")?l.last_selected=m.content[0]:a||l.last_selected==e||l.content_lock||(l.last_selected=e),x(),t(o&&a?o:null),l.content_lock=!1},a=function(e){"large"!=i&&!l.content_lock&&e.force&&q(),l.content_lock=!1,e.title&&$(".header > .header-title",m.list).text(e.title)},o=function(e){var t={};if("addressbook"!=rcmail.env.task&&"mail"!=rcmail.env.task||(t.force=!0),"mail"==rcmail.env.task&&!rcmail.env.action){var n="string"==$.type(e)?e:rcmail.env.mailbox,i=rcmail.env.mailboxes[n];t.title=i?i.name:""}a(t)};m.content.find("iframe").on("load",(function(e){var i,a="",o=!0;add_messagecontframe_event_dragdrop(),$(this).parent(".iframe-wrapper").scrollTop(0);try{o=!(a=(i=e.target.contentWindow).location.href).endsWith(rcmail.env.blankpage),$(i).on("unload",t)}catch(e){}n(e,a,o)})),rcmail.addEventListener("afterlist",o).addEventListener("afterlistgroup",o).addEventListener("afterlistsearch",o).addEventListener("show-list",(function(e){e.force=!0,a(e)})).addEventListener("show-content",(function(e){e.obj&&!$(e.obj).is("iframe")&&($(e.scrollElement||e.obj).scrollTop(0),ee()&&U(e.obj)),n(e.event||new Event,"_action="+(e.mode||"edit"),!0,e.title)}))}(),$("[data-popup]").each((function(){M(this)})),$(document).on("click",z),rcube_webmail.set_iframe_events({mousedown:z,touchstart:z}),function(){var e,t,i=[];$.ui&&$.widget("ui.dialog",$.ui.dialog,{open:function(){return $(this.element).is(".iframe")&&(this.options.width=Math.max(576,this.options.width)),this._super(),function(e){var t=$(e.uiDialog),n=t.width(),i=t.height(),a=$(window).width(),o=$(window).height();a<=480?t.css({width:"100%",height:"100%"}):(i>o&&t.css("height","100%"),n>a&&t.css("width","100%"));$(document).click(),U($("div.popup > iframe",t)),g(e.uiDialog)}(this),this},close:function(){return this._super(),$(".select-menu:visible").remove(),this}}),p.menu.on("click",(function(){return R(),!1})),p.back_list.on("click",(function(){return q(),!1})),p.back_content.on("click",(function(){return function(e){m.list.addClass("hidden"),m.sidebar.addClass("hidden"),m.content.removeClass("hidden"),e&&m.sidebar.removeClass("layout-sticky");T(),l.last_selected=m.content[0]}(!0),!1})),$(".searchbar").each((function(){A(this)})),!r||rcmail.env.extwin||parent.$(".ui-dialog:visible").length?r||((e=m.content.find(".boxtitle").first().detach().text())||(e=$("h1.voice").first().text()),e&&m.content.find(".header > .header-title").text(e)):(e=$("h1.voice").first().text())&&parent.$("#layout-content > .header > .header-title:not(.constant)").text(e);$("a[data-content-button]").each((function(){i.push(h($(this)))})),$(".formbuttons").filter((function(){return!$(this).parent(".searchoptions").length})).find("button").each((function(){var e=$(this);(r||e.parents("#layout-content").length)&&(e.is(".cancel")?e.addClass("hidden"):i.push(h(e)))})),(r?parent.UI:n).register_content_buttons(i),(t=rcmail.gui_objects.messageform)&&(t=$('form[name="'+t+'"]'),$("#_cc, #_bcc, #_replyto, #_followupto",$(".compose-headers")).each((function(){$(this).on("change",(function(){$("#compose"+$(this).attr("id"))[this.value?"removeClass":"addClass"]("hidden"),$("#mini"+$(this).attr("id"))[this.value?"addClass":"removeClass"]("hidden")}))})),$("#compose-options").find("textarea,input,select").each((function(){var e=$("<input>").attr({type:"hidden",name:$(this).attr("name")}).appendTo(t);$(this).attr("tabindex",2).on("change",(function(){e.val("checkbox"!=this.type||this.checked?$(this).val():"")})).change()})));$("[data-recipient-input]").each((function(){var e,t,n,i,a,o,s,r,l;e=this,i="",a=function(){$(e).val(t.text()+n.val())},o=function(e,t,i){var s=$('<li class="recipient">'),r=$('<span class="name">').html(function(e){var t,n,i="",a=e.length;for('"'!=e.charAt(0)&&e.indexOf('"')>-1&&(e='"'+e.replace("\\","\\\\").replace('"','\\"')+'"'),t=0;t<a;t++)switch(n=e.charAt(t)){case'"':if(t>0&&t<a-1){i+='"';break}i+='<span class="quotes">'+n+"</span>";break;case"\\":i+='<span class="quotes">'+n+"</span>","\\"==e.charAt(t+1)&&(i+=n,t++);break;case"<":i+="&lt;";break;case">":i+="&gt;";break;default:i+=n}return i}(e||t)).on("dblclick",(function(e){!function(e,t){var n=$(e.target).parents(".recipient"),i=n.text().replace(/,+$/,""),a=$("<input>").attr({type:"text","data-submit":"true"}).val(i),o=$("<label>").text(rcmail.gettext("recipient")).append(a);rcmail.simple_dialog(o,"recipientedit",(function(){var e,o=a.val();if(o){if(o!=i){if(1!=(e=Y(o)).recipients.length)return!1;t(e.recipients[0].name,e.recipients[0].email,n)}return!0}}))}(e,o)})),l=$('<span class="email">'),c=$("<a>").attr({class:"button icon remove"}).click((function(){return s.remove(),a(),n.focus(),!1}));e&&(t=" <"+t+">"),l.text((e?t:"")+","),s.attr("title",e?e+t:null).append([r,l,c]),i?i.replaceWith(s):s.insertBefore(n.parent()),a()},s=function(e){var t;return t=Y(e=(e||n.val()).replace(/[,;\s]+$/,"")),$.each(t.recipients,(function(){o(this.name,this.email)})),n.val(t.text),a(),t.recipients.length>0},r=function(e,n,i){var a,o,r=this.value;!1!==i&&("paste"==e.type?(o=(e.originalEvent.clipboardData||window.clipboardData).getData("text")||"",r=r.substring(0,this.selectionStart)+o+r.substring(this.selectionEnd),e.preventDefault()):n&&(a=t.find("li.recipient").last()).length&&this.value.indexOf(a.text().replace(/[ ,]+$/,""))>-1&&a.remove(),s(r))},l=function(e){return 8!=e.keyCode||n.val().length?!((" "==e.key||","==e.key||";"==e.key||"Enter"==e.key&&!rcmail.ksearch_visible())&&s())&&void 0:(t.children("li.recipient").last().remove(),a(),!1)},n=$("<input>").attr({type:"text",tabindex:$(e).attr("tabindex")}).on("paste change",r).on("keydown",l).on("blur",(function(){t.removeClass("focus")})).on("focus mousedown",(function(){t.addClass("focus")})),t=$("<ul>").addClass("form-control recipient-input ac-input rounded-left").append($('<li class="input">').append(n)).on("mouseup",(function(){i=window.getSelection().toString()})).on("click",(function(){i.length||n.focus()})).sortable({appendTo:document.body,items:"> .recipient",connectWith:".recipient-input",receive:function(e,n){var i=t.text();t.find(".recipient").remove(),s(i),n.sender&&n.sender.find("input").change()}}),$(e).css({position:"absolute",opacity:0,left:"-5000px",width:"10px"}).attr("tabindex",-1).after(t).on("focus",(function(e){n.focus(),e.preventDefault()})).on("change",(function(){$("li.recipient",t).remove(),n.val(this.value).change()})).change(),rcmail.init_address_input_events(n)})),$(".image-upload").each((function(){var e,t,n,i;e=this,t=$("<a>").attr({class:"icon button delete",href:"#"}).click((function(e){return rcmail.command("delete-photo","",this,e),!1})),n=$(e).find("img")[0],i=function(){var t=-1!=(n.currentSrc||n.src).indexOf(rcmail.env.photo_placeholder);$(e)[t?"removeClass":"addClass"]("changed")},$(e).append(t).click((function(){rcmail.upload_input("upload-form")})),i(),$(n).on("load",i)})),$("textarea[data-html-editor]").each((function(){!function(e){var t,n=!1,i=$(e),a=i.parent(),o=$('<a class="mce-i-html" href="#" tabindex="-1"></a>').attr("title",rcmail.gettext("htmltoggle")).on("click",(function(e){rcmail.command("toggle-editor",{id:i.attr("id"),html:!0},"",e.originalEvent)&&a.addClass("ishtml")})).on("keydown",(function(e){if(9==e.which)return i.focus(),!1})),s=$('<div class="editor-toolbar">').append(o);a.is("td")?(t=$('input[type="checkbox"]',a.parent().next()),n=!0):t=i.next("select.hidden");if(function(e){var t,n,i=function(){if(!e.scrollHeight)return setTimeout(i,250);if(t||(t=parseInt($(e).css("padding-top"))+parseInt($(e).css("padding-bottom"))+2,n=$(e).height()),!(e.scrollHeight-t<=n)){var a,o=0;$(e).parents().each((function(){if(this.scrollTop>0)return a=this,o=this.scrollTop,!1}));var s=$(e).outerHeight();$(e).outerHeight(0);var r=Math.max(n,e.scrollHeight);$(e).outerHeight(s),r!==s&&$(e).height(r),o&&(a.scrollTop=o)}};$(e).on("input",i).trigger("input")}(e),1!=t.length)return;a.addClass("html-editor"),i.after(s).data("control",t).on("keydown",(function(e){e.altKey&&121==e.which&&o.focus()})),n&&(t.parents("tr").first().hide(),a.prev().hide(),a.addClass("col-sm-12"))}(this)})),$("#dragmessage-menu,#dragcontact-menu").each((function(){rcmail.gui_object("dragmenu",this.id)})),setTimeout((function(){$(".button-selected").addClass("selected")}),50),$(".listbutton").each((function(){var e=f(this.id);$(this).addClass("button").removeClass("listbutton"),e.data.sel&&(e.data.sel=e.data.sel.replace("listbutton","button")),e.data.act&&(e.data.act=e.data.act.replace("listbutton","button")),rcmail.buttons[e.command][e.index]=e.data,rcmail.init_button(e.command,e.data)})),$("[data-hidden]").each((function(){for(var e,t=$(this).data("hidden"),n=$(this).parent("li"),i=/(large|big|small|phone|lbs)/g;e=i.exec(t);)$(n.length?n:this).addClass("hidden-"+e[1])})),$("[data-list]").each((function(){$("input[type=checkbox]",this).each((function(){X(this)}))})),r&&$(".formcontent").each((function(){$(this).next(".formbuttons").length&&$(this).parent().addClass("formcontainer")}));$("#attachment-list + a.zipdownload").appendTo(".header-links"),$("html").filter(".ipad,.iphone,.webkit.mobile,.webkit.tablet").addClass("webkit-scroller").length&&$(m.menu).addClass("webkit-scroller");$(".treelist").each((function(){var e=this,t=function(){$(e)[$(".treetoggle",e).length>0?"removeClass":"addClass"]("notree")};window.MutationObserver&&new MutationObserver(t).observe(e,{childList:!0,subtree:!0}),t(),$("li.mailbox > a").on("mouseover",(function(){rcube_webmail.long_subject_title_ex(this)}))}))}(),k()}if(log=Function.prototype.bind.call(console.log,console),warn=Function.prototype.bind.call(console.warn,console),error=Function.prototype.bind.call(console.error,console),function(e){window.jQuery&&window.bootstrap&&bootstrap.Popover&&(e.fn.popover=function(e){return this.each((function(){const t=bootstrap.Popover.getInstance(this);if("string"==typeof e)return void(t&&"function"==typeof t[e]&&t[e]());t&&t.dispose();const n=e||{};n.popperConfig||(n.popperConfig=function(e){return{...e,modifiers:[...e.modifiers||[],{name:"offset",options:{offset:[0,0]}}]}}),new bootstrap.Popover(this,n||{})}))},e.fn.tab=function(e){return this.each((function(){const t=bootstrap.Tab.getOrCreateInstance(this);"string"==typeof e&&"function"==typeof t[e]&&t[e]()}))})}(window.jQuery),window.rcmail)rcmail.show_menu=function(e,t,n){var i="object"==typeof e?e.menu:e,a=$("#"+i);return"string"==typeof e&&(e={menu:i}),rcmail.triggerEvent(!1===t?"menu-close":"menu-open",{name:i,obj:a,props:e,originalEvent:n})},rcmail.hide_menu=function(e,t){return rcmail.triggerEvent("menu-close",{name:e,props:{menu:e},originalEvent:t})};else var rcmail=parent.rcmail,rcube_webmail=parent.rcube_webmail,bw={};var UI=new rcube_elastic_ui;if($&&$.datepicker){var __newInst=$.datepicker._newInst;$.extend($.datepicker,{_newInst:function(e,t){var n=__newInst.call(this,e,t);return n.inline||UI.datepicker_init(n.dpDiv),n}})}
/*!
 * pulltorefreshjs v0.1.22
 * (c) Rafael Soto
 * Released under the MIT License.
 */if(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).PullToRefresh=t()}(this,(function(){"use strict";var e={pullStartY:null,pullMoveY:null,handlers:[],styleEl:null,events:null,dist:0,state:"pending",timeout:null,distResisted:0,supportsPassive:!1,supportsPointerEvents:"undefined"!=typeof window&&!!window.PointerEvent};try{window.addEventListener("test",null,{get passive(){e.supportsPassive=!0}})}catch(e){}var t,n={setupDOM:function(t){if(!t.ptrElement){var n=document.createElement("div");t.mainElement!==document.body?t.mainElement.parentNode.insertBefore(n,t.mainElement):document.body.insertBefore(n,document.body.firstChild),n.classList.add(t.classPrefix+"ptr"),n.innerHTML=t.getMarkup().replace(/__PREFIX__/g,t.classPrefix),t.ptrElement=n,"function"==typeof t.onInit&&t.onInit(t),e.styleEl||(e.styleEl=document.createElement("style"),e.styleEl.setAttribute("id","pull-to-refresh-js-style"),document.head.appendChild(e.styleEl)),e.styleEl.textContent=t.getStyles().replace(/__PREFIX__/g,t.classPrefix).replace(/\s+/g," ")}return t},onReset:function(t){t.ptrElement&&(t.ptrElement.classList.remove(t.classPrefix+"refresh"),t.ptrElement.style[t.cssProp]="0px",setTimeout((function(){t.ptrElement&&t.ptrElement.parentNode&&(t.ptrElement.parentNode.removeChild(t.ptrElement),t.ptrElement=null),e.state="pending"}),t.refreshTimeout))},update:function(t){var n=t.ptrElement.querySelector("."+t.classPrefix+"icon"),i=t.ptrElement.querySelector("."+t.classPrefix+"text");n&&("refreshing"===e.state?n.innerHTML=t.iconRefreshing:n.innerHTML=t.iconArrow),i&&("releasing"===e.state&&(i.innerHTML=t.instructionsReleaseToRefresh),"pulling"!==e.state&&"pending"!==e.state||(i.innerHTML=t.instructionsPullToRefresh),"refreshing"===e.state&&(i.innerHTML=t.instructionsRefreshing))}},i=function(t){return e.pointerEventsEnabled&&e.supportsPointerEvents?t.screenY:t.touches[0].screenY},a=function(){var a;function o(t){var o=e.handlers.filter((function(e){return e.contains(t.target)}))[0];e.enable=!!o,o&&"pending"===e.state&&(a=n.setupDOM(o),o.shouldPullToRefresh()&&(e.pullStartY=i(t)),clearTimeout(e.timeout),n.update(o))}function s(t){a&&a.ptrElement&&e.enable&&(e.pullStartY?e.pullMoveY=i(t):a.shouldPullToRefresh()&&(e.pullStartY=i(t)),"refreshing"!==e.state?("pending"===e.state&&(a.ptrElement.classList.add(a.classPrefix+"pull"),e.state="pulling",n.update(a)),e.pullStartY&&e.pullMoveY&&(e.dist=e.pullMoveY-e.pullStartY),e.distExtra=e.dist-a.distIgnore,e.distExtra>0&&(t.cancelable&&t.preventDefault(),a.ptrElement.style[a.cssProp]=e.distResisted+"px",e.distResisted=a.resistanceFunction(e.distExtra/a.distThreshold)*Math.min(a.distMax,e.distExtra),"pulling"===e.state&&e.distResisted>a.distThreshold&&(a.ptrElement.classList.add(a.classPrefix+"release"),e.state="releasing",n.update(a)),"releasing"===e.state&&e.distResisted<a.distThreshold&&(a.ptrElement.classList.remove(a.classPrefix+"release"),e.state="pulling",n.update(a)))):t.cancelable&&a.shouldPullToRefresh()&&e.pullStartY<e.pullMoveY&&t.preventDefault())}function r(){if(a&&a.ptrElement&&e.enable){if(clearTimeout(t),t=setTimeout((function(){a&&a.ptrElement&&"pending"===e.state&&n.onReset(a)}),500),"releasing"===e.state&&e.distResisted>a.distThreshold)e.state="refreshing",a.ptrElement.style[a.cssProp]=a.distReload+"px",a.ptrElement.classList.add(a.classPrefix+"refresh"),e.timeout=setTimeout((function(){var e=a.onRefresh((function(){return n.onReset(a)}));e&&"function"==typeof e.then&&e.then((function(){return n.onReset(a)})),e||a.onRefresh.length||n.onReset(a)}),a.refreshTimeout);else{if("refreshing"===e.state)return;a.ptrElement.style[a.cssProp]="0px",e.state="pending"}n.update(a),a.ptrElement.classList.remove(a.classPrefix+"release"),a.ptrElement.classList.remove(a.classPrefix+"pull"),e.pullStartY=e.pullMoveY=null,e.dist=e.distResisted=0}}function l(){a&&a.mainElement.classList.toggle(a.classPrefix+"top",a.shouldPullToRefresh())}var c=e.supportsPassive?{passive:e.passive||!1}:void 0;return e.pointerEventsEnabled&&e.supportsPointerEvents?(window.addEventListener("pointerup",r),window.addEventListener("pointerdown",o),window.addEventListener("pointermove",s,c)):(window.addEventListener("touchend",r),window.addEventListener("touchstart",o),window.addEventListener("touchmove",s,c)),window.addEventListener("scroll",l),{onTouchEnd:r,onTouchStart:o,onTouchMove:s,onScroll:l,destroy:function(){e.pointerEventsEnabled&&e.supportsPointerEvents?(window.removeEventListener("pointerdown",o),window.removeEventListener("pointerup",r),window.removeEventListener("pointermove",s,c)):(window.removeEventListener("touchstart",o),window.removeEventListener("touchend",r),window.removeEventListener("touchmove",s,c)),window.removeEventListener("scroll",l)}}},o={distThreshold:60,distMax:80,distReload:80,distIgnore:0,mainElement:"body",triggerElement:"body",ptrElement:".ptr",classPrefix:"ptr--",cssProp:"min-height",iconArrow:"&#8675;",iconRefreshing:"&hellip;",instructionsPullToRefresh:"Pull down to refresh",instructionsReleaseToRefresh:"Release to refresh",instructionsRefreshing:"Refreshing",refreshTimeout:500,getMarkup:function(){return'\n<div class="__PREFIX__box">\n  <div class="__PREFIX__content">\n    <div class="__PREFIX__text"></div>\n  </div>\n</div>\n'},getStyles:function(){return"\n.__PREFIX__ptr {\n  pointer-events: none;\n  font-size: 0.85em;\n  font-weight: bold;\n  height: 0;\n  transition: height 0.3s, min-height 0.3s;\n  text-align: center;\n  width: 100%;\n  overflow: hidden;\n  display: flex;\n  align-items: flex-end;\n  align-content: stretch;\n}\n\n.__PREFIX__box {\n  padding: 10px;\n  flex-basis: 100%;\n}\n\n.__PREFIX__pull {\n  transition: none;\n}\n\n.__PREFIX__text {\n  margin-top: .33em;\n}\n\n.__PREFIX__icon {\n  transition: transform .3s;\n}\n\n/*\nWhen at the top of the page, disable vertical overscroll so passive touch\nlisteners can take over.\n*/\n.__PREFIX__top {\n  touch-action: pan-x pan-down pinch-zoom;\n}\n\n.__PREFIX__release .__PREFIX__icon {\n  transform: rotate(180deg);\n}\n"},onInit:function(){},onRefresh:function(){return location.reload()},resistanceFunction:function(e){return Math.min(1,e/2.5)},shouldPullToRefresh:function(){return!window.scrollY}},s=["mainElement","ptrElement","triggerElement"],r=function(t){var n={};return Object.keys(o).forEach((function(e){n[e]=t[e]||o[e]})),n.refreshTimeout="number"==typeof t.refreshTimeout?t.refreshTimeout:o.refreshTimeout,s.forEach((function(e){"string"==typeof n[e]&&(n[e]=document.querySelector(n[e]))})),e.events||(e.events=a()),n.contains=function(e){return n.triggerElement.contains(e)},n.destroy=function(){clearTimeout(e.timeout);var t=e.handlers.indexOf(n);e.handlers.splice(t,1)},n};return{setPassiveMode:function(t){e.passive=t},setPointerEventsMode:function(t){e.pointerEventsEnabled=t},destroyAll:function(){e.events&&(e.events.destroy(),e.events=null),e.handlers.forEach((function(e){e.destroy()}))},init:function(t){void 0===t&&(t={});var n=r(t);return e.handlers.push(n),n},_:{setupHandler:r,setupEvents:a,setupDOM:n.setupDOM,onReset:n.onReset,update:n.update}}})),"small"==UI.get_screen_mode()&&document.getElementById("messagelist-content")){PullToRefresh.init({mainElement:"#messagelist",onRefresh:function(){return new Promise((function(e){setTimeout((function(){UI_pull_to_refresh(e)}),0)}))},shouldPullToRefresh:function(){return(!document.querySelector("#greydiv")||!document.querySelector("#greydiv").classList.contains("fadeoff70create"))&&!document.getElementById("messagelist-content").scrollTop},refreshTimeout:50,instructionsPullToRefresh:'<i class="sebicon iconrefresh icon_pulltorefresh" ></i>',instructionsRefreshing:'<i class="sebicon iconrefresh icon_pulltorefresh anim_rotatepulltorefresh" ></i>',instructionsReleaseToRefresh:'<i class="sebicon iconrefresh icon_pulltorefresh"></i>'})}if(document.getElementById("messagelist-content")&&(document.getElementById("messagelist-content").addEventListener("wheel",(e=>{scroll_mailbymail(e)})),new ResizeObserver(resizemessagelist).observe(document.getElementById("messagelist-content"))),document.getElementsByClassName("gitissue16").length){var move=$("#folderlist-content").width()-$("#mailboxlist").width();$(".gitissue16 a").css({marginRight:move+"px"})}function resizemessagelist(){if(document.getElementById("messagelist-content")&&(document.getElementById("searchmenu").classList.contains("hidden")?$("#messagelist-header").show():$("#messagelist-header").hide(),document.getElementById("searchmenu").classList.contains("hidden"))){var e=document.getElementById("messagelist-content");if($("html.layout-small").length)e.style.paddingBottom="0px";else{var t=e.offsetHeight;if(e.querySelector(".message")){var n=e.querySelector(".message").getBoundingClientRect().height;e.style.paddingBottom=t%n+"px"}}}}function scroll_mailbymail(e){e.preventDefault(),e.stopPropagation();var t=document.getElementById("messagelist-content"),n=t.scrollTop,i=t.querySelectorAll("tr.message");i=Array.from(i).filter((e=>"none"!=e.style.display));for(var a=0;a<i.length&&!(n<=i[a].offsetTop);a++);i[a].offsetTop-n>15&&e.deltaY>0&&a--,e.deltaY>0?a++:a--,a<0&&(a=0),a>=i.length&&(a=i.length),t.scrollTop=i[a].offsetTop}function refresh_mail_anim(){var e=document.getElementsByClassName("refresh")[0];e.classList.add("anim_rotate"),e.classList.add("disabled");UI_pull_to_refresh((function(){e.classList.remove("anim_rotate"),e.classList.remove("disabled")})),document.activeElement.blur()}var r=document.getElementsByClassName("refresh");if(r.length&&(r[0].setAttribute("onClick","refresh_mail_anim()"),r[0].style.width="45px"),document.documentElement.classList.contains("iframe")){var header=document.querySelector(".header-content");if(header&&(set_onclick_to_class(header,".flag","return parent.rcmail.command('mark','flagged','',this,event)"),set_onclick_to_class(header,".unread","return parent.rcmail.command('mark','unread',this,event)"),set_onclick_to_class(header,".delete","return parent.rcmail.command('delete','',this,event)")),parent.rcmail.env.archive_folder){var h=document.getElementById("message-header"),delete_icon=h.querySelector(".reply"),ab=document.createElement("a");ab.className="button archive hide_small",ab.onclick=function(e){return parent.rcmail.command("plugin.archive","",this,e)},ab.innerHTML="<span class='inner'>"+parent.rcmail.labels["archive.buttontext"]+"</span>",delete_icon.parentElement.insertBefore(ab,delete_icon);var li_prev=document.getElementById("message-menu-inner").querySelector(".unread").parentNode,li=document.createElement("li");li.onclick=function(e){return parent.rcmail.command("plugin.archive","",this,e)},li.innerHTML='<a class="archive" id="" role="button" tabindex="0" aria-disabled="false" href="#" onclick="return parent.rcmail.command(\'plugin.archive\',\'\',this,event)" title=""><span class="inner">'+parent.rcmail.labels["archive.buttontext"]+"</span></a>",li_prev.parentElement.insertBefore(li,li_prev),parent.document.getElementById("header_topmenu_archive").style.display="inline-block"}}if("preview"==rcmail.env.action){var contactphoto=$(".contactphoto")[0];contactphoto.onerror=function(){change_contactphoto_by_divLetter()}}function change_contactphoto_by_divLetter(){var e=$(".contactphoto")[0],t=document.createElement("div");t.className="sel_circle maillogo_no_select replacecontactpic";var n=textforcircle($(".header .from").text()),i=colors_from_txt(n);t.style.backgroundColor="#"+i,t.innerHTML=n,e.parentElement.appendChild(t),e.style.display="none"}function flag_click(){window.frameElement?(parent.messagelist.querySelector(".selected").querySelector(".flag").firstChild.click(),parent.hide_messagestack_few_secs()):(document.body.classList.contains("status-flagged")?rcmail.command("mark","unflagged",this,event):rcmail.command("mark","flagged",this,event),hide_messagestack_few_secs())}function unread_click(){window.frameElement?(parent.messagelist.querySelector(".selected").querySelector(".msgicon").click(),parent.hide_messagestack_few_secs()):rcmail.command("mark","unread",this,event)}function hide_messagestack_few_secs(){document.getElementById("messagestack").style.visibility="hidden",UI_pull_to_refresh_check((function(){}))}function set_onclick_to_class(e,t,n){for(var i=e.querySelectorAll(t),a=0;a<i.length;a++)i[a].setAttribute("onClick",n)}function UI_pull_to_refresh(e){document.getElementById("messagestack").style.visibility="hidden",rcmail.command("checkmail","",!1,!1),UI_pull_to_refresh_check(e)}function UI_pull_to_refresh_check(e){$("#messagestack").html()?setTimeout((function(){UI_pull_to_refresh_check(e)}),100):(document.getElementById("messagestack").style.visibility="visible",e())}function listupdate_go_msgs(){for(var e=document.getElementById("messagelist").querySelectorAll(".message"),t=localStorage.contactphoto??"{}",n=JSON.parse(t),i=[],a=0;a<e.length;a++){var o=e[a].querySelector(".selection");if(!o.querySelector(".sel_circle")){o.querySelector("input").style.display="none",(m=document.createElement("div")).className="sel_circle maillogo_no_select",m.onclick=function(e){e.preventDefault()};var s="";if(e[a].querySelector(".rcmContactAddress"))s=e[a].querySelector(".rcmContactAddress").title;var r=urlencode(s);if(1==n[r])m.style.backgroundImage="url('?_task=addressbook&_action=photo&_email="+r+"&_error=1&_bgcolor=transparent')",m.style.backgroundColor="";else{var l=get_personna_from_mailblock(e[a]),c=colors_from_txt(l);m.style.backgroundColor="#"+c,m.innerHTML=l}void 0===n[r]&&i.push(s),o.appendChild(m),(m=document.createElement("div")).className="sel_circle maillogo_is_select",m.onclick=function(e){e.preventDefault()},m.style.backgroundColor="#0078D4",m.innerHTML="<i class='sebicon selecticon' style='color:#fff' onclick='return function(e){e.preventDefault()}'></i>",o.appendChild(m)}var d=e[a].querySelectorAll(".attachment").length,u=e[a].querySelectorAll(".report").length;if((2==d||u)&&(e[a].querySelector(".subject").querySelector(".subject").style.paddingRight="18px"),!e[a].querySelector(".deleteicon")){var m,p=e[a].querySelector(".size");if((m=document.createElement("span")).className="sebicon deleteicon insummary",m.onclick=function(e){var t=e.target.closest(".message").uid;rcmail.env.mailbox==rcmail.env.trash_mailbox?rcmail.with_selected_messages("delete",{_uid:[t]}):rcmail.command("move",{id:rcmail.env.trash_mailbox,uids:[t]},"",event,!0)},!p)(p=document.createElement("span")).className="size skip-on-drag",e[a].querySelector(".date").after(p);p.appendChild(m)}}i=[...new Set(i)];for(a=0;a<i.length;a++)setTimeout((function(e){check_contactphoto(e)}),0,i[a])}function check_contactphoto(e){var t=urlencode(e),n=new XMLHttpRequest,i="?_task=addressbook&_action=photo&_email="+t+"&_error=1&_bgcolor=transparent";n.open("GET",i,!0),n.onerror=function(){console.log("** An error occurred during the check")},n.onload=function(){4==n.readyState&&200==n.status?LS_add_info(t,1):4==n.readyState&&204==n.status?LS_add_info(t,0):warn("xmlhttprequest unknow-readyState:"+n.readyState+"-status:"+n.status);for(var i=document.getElementById("messagelist").querySelectorAll('[title="'+e+'"]'),a=0;a<i.length;a++){var o=i[a].closest(".message").querySelector(".selection").querySelector("div");4==n.readyState&&200==n.status&&(o.innerHTML="",o.style.backgroundImage="url('?_task=addressbook&_action=photo&_email="+t+"&_error=1&_bgcolor=transparent')",o.style.backgroundColor="")}},n.send()}function LS_add_info(e,t){var n=localStorage.contactphoto??"{}",i=JSON.parse(n);i[e]=t,localStorage.contactphoto=JSON.stringify(i)}function LS_remove_contact(){LS_remove(urlencode($("#ff_email0")[0].value))}function LS_remove(e){var t=localStorage.contactphoto??"{}",n=JSON.parse(t);delete n[e],localStorage.contactphoto=JSON.stringify(n)}function elastic2022_logout(){delete localStorage.contactphoto,rcmail.command("switch-task","logout",!1,!1)}function get_personna_from_mailblock(e){return e.querySelector(".rcmContactAddress")?textforcircle(e.querySelector(".rcmContactAddress").textContent):""}function textforcircle(e){var t=(e=e.trim().replace(/[|&;$%@"<>()+-.,]/g,"").trim()).split(" "),n=e.charAt(0);return t[1]&&(n+=t[1].charAt(0)),n.toUpperCase()}function colors_from_txt(e){if(!e)return"AAA";for(var t="DF71AE D45345 9877D5 6EB9C2 A47563 E1843B 62BF78 5196D5 EACF47".split(" "),n=0,i=0;i<e.length;i++)n+=e.charAt(i).charCodeAt(0)+255*i;return t[n%t.length]}function click_menu(){if(!document.querySelector("#greydiv")){var e=document.createElement("div");e.id="greydiv",e.onclick=function(){close_leftmenu()},document.body.appendChild(e)}if(document.querySelector("#greydiv").classList.add("fadeoff70create"),!document.querySelector("#menuleft")){document.querySelector("#greydiv").insertAdjacentHTML("afterend","<div id='menuleft'><div>&nbsp;</div><div id='menuleft_cont'></div><hr style='margin-top:40px;border-top:1px solid #374549;width: 80%;'><div id='menuleft_bottom' class='menu'></div></div>")}var t=document.querySelector("#menuleft");if(setTimeout((function(){t.classList.add("menu_marginleft")}),0),"mail"==rcmail.env.task&&($("#menuleft").prepend($(".header-title.username")),$("#menuleft_cont").append($("#folderlist-content")),$("#menuleft_cont").append($(".gitissue16"))),"addressbook"==rcmail.env.task&&($("#menuleft_cont").append($("#directorylist")),$("#directorylist").append($("#layout-sidebar .header a"))),"calendar"==rcmail.env.task&&($("#menuleft_cont").append($("#layout-sidebar .searchbar")),$("#menuleft_cont").append($("#calendars-content"))),!menuleft_cont.classList.contains("link_added")){var n="",a=document.querySelector(".menu_bottom").querySelectorAll("a");for(i=0;i<a.length;++i)n+="<div class='menuopt'>"+a[i].outerHTML+"</div>";n+=document.querySelector("#taskmenu").innerHTML,document.querySelector("#menuleft_bottom").innerHTML=n,$("#mailboxlist a").on("click",(function(){close_leftmenu()})),$("#menuleft_bottom > .click_change_theme").click((function(){$("#taskmenu .click_change_theme").click()})),menuleft_cont.classList.add("link_added")}}function close_leftmenu(){document.querySelector("#greydiv").classList.contains("fadeoff70create")&&(document.querySelector("#greydiv").classList.remove("fadeoff70create"),document.querySelector("#menuleft").classList.remove("menu_marginleft"),"mail"==rcmail.env.task&&setTimeout((function(){$("#layout-sidebar").prepend($(".header-title.username")),$("#folderlist-content").insertBefore($(".menu.menu_bottom")),$(".gitissue16").insertBefore($(".menu.menu_bottom"))}),300),"addressbook"==rcmail.env.task&&setTimeout((function(){$("#directorylist").insertBefore($("#layout-sidebar .scroller")),$("#layout-sidebar .header").append($("#directorylist a.sidebar-menu"))}),300),"calendar"==rcmail.env.task&&(setTimeout((function(){$("#menuleft .searchbar").insertBefore($(".menu.menu_bottom"))}),50),setTimeout((function(){$("#calendars-content").insertBefore($(".menu.menu_bottom"))}),50)))}function dtel(e){$("#mailboxlist a")[0].text=e}function mail_menu_show_attachement(){$("#layout-sidebar").removeClass("hidden"),$("#layout-content").addClass("hidden"),UI.screen_resize_headers()}function autoscale_message_reset(){delete document.body.dataset.originalscrollWidth;var e=document.querySelector("#messagebody").style;e.width="",e.height="",e.transform="",e.transformOrigin="","no"!=$("#divscale_default").data("scale")&&setTimeout((function(){autoscale_message()}),0)}function autoscale_message(){if(window.innerWidth-$(document).width()>=0)$("#divscale_default").css("display","none");else{$("#divscale_default").css("display","inline-block");var e=document.body.scrollWidth,t=document.querySelector("#messagebody").style;if(t.width=e+"px",document.body.dataset.originalscrollWidth)var n=document.body.dataset.originalscrollWidth,i=document.body.dataset.originalHeight;else{n=document.body.scrollWidth,i=document.querySelector("#message-htmlpart1").getBoundingClientRect().height;document.body.dataset.originalscrollWidth=n,document.body.dataset.originalHeight=i}var a=(document.body.clientWidth-7)/n;t.height=i*a+"px",t.transform="scale("+a+")",t.transformOrigin="0 0"}}function scale_default(){$("#divscale_default").css("display","none"),$("#divscale_default").data("scale","no"),autoscale_message_reset()}function go_PWA(){var e=window.location.href,t=e.substring(0,e.lastIndexOf("/"))+"/",n=document.title.split(" ::")[0];n.includes(")")&&(n=n.split(") ")[1]);var i={name:n,theme_color:$('meta[name="theme-color"]').attr("content"),start_url:t,icons:[{src:t+"/skins/elastic2022/images/rc192x192.png",sizes:"192x192",purpose:"maskable",purpose:"any"},{src:t+"/skins/elastic2022/images/rc512x512.png",sizes:"512x512",purpose:"maskable",purpose:"any"}],display:"standalone"};const a=JSON.stringify(i),o=new Blob([a],{type:"application/json"});let s=new FileReader;s.readAsDataURL(o),s.onload=function(){var e=document.createElement("link");e.href=s.result,e.rel="manifest",document.getElementsByTagName("head")[0].appendChild(e)}}function define_priority(e){var t=0;e.checked&&(t=1),(e=$("#compose-priority")[0]).value=t,e.dispatchEvent(new Event("change"))}function check_usernameSPAN_plugin(){0!=$("#plugin-ident_switch-account").length&&($sw=$("#plugin-ident_switch-account"),plugin_switchIdent_addCbElastic2022($sw)&&$sw.show());$("#identity_switch_dropdown ul li").length>1&&($sw=$("#identity_switch_menu"),identity_switch_addCbElastic2022($sw)&&$sw.show())}function plugin_switchIdent_addCbElastic2022(e){var t=$(".header-title.username");return t.length>0&&(t.prepend(e),!0)}function identity_switch_addCbElastic2022(e){var t=$(".header-title.username");if(e.css("background-color","transparent").css("padding","4px 0 0 2rem"),t.length>0){t.prepend(e),t.css("margin-left","20px");var n=$(".header-title.username"),i=$("<"+n[0].nodeName+"/>");return $.each(n[0].attributes,(function(e,t){i.attr(t.name,t.value)})),n.children().each((function(){i.append(this)})),n.replaceWith(i),$("#identity_switch_menu").css("height","30px").css("width","180px"),$("#identity_switch_dropdown").css("left","-48px").css("margin-top","-3px"),!0}return!1}function elastic2022_change_mailheader(){var e=$(".header-headers .date")[0].closest("tr");e.querySelector(".header-title").style.visibility="hidden",e.parentElement.appendChild(e),$(".messagedate").text($(".header-headers .date")[0].innerHTML),$(".header-headers .date").parent().hide(),$(".header-headers .replyto").parent().remove(),$(".header-headers .sender").each((function(){$(".header-headers .from .adr a")[0].href==jQuery(this).find(".rcmContactAddress")[0].href&&this.parentElement.remove()})),$(".header-headers .priority .prio3").closest("tr").remove(),$(".header-headers .header-title").first().remove(),$(".header-headers .header.from").attr("colspan",2),$(".header-headers .header-title").last().text("").width(0),$(".header-content").css("opacity",1)}function elastic2022_change_attachmentslist(){if($(".attachment-size").each((function(){this.innerText=this.innerText.replace(/[()~]/g,"")})),$(".attachmentslist .filename").off(),$(".attachmentslist .filename").removeAttr("onclick"),$(".attachmentslist .filename").attr("target","_blank"),$(".attachmentslist li:not(.rfc822, .pdf, .image) .filename").attr("download",""),$(".attachmentslist .image,.attachmentslist .jpg").each((function(){var e=jQuery(this).find(".filename")[0].href;e+="&_embed=1&_mimeclass=image&_thumb=1",jQuery(this).find(".filename").append("<div class='attachmentslistthumnb' style='background-image: url("+e+");'></div>")})),$(".attachmentslist .html").each((function(){jQuery(this).find(".filename").attr("href","#");var e=jQuery(this).attr("id").replace(/^attach/,"");jQuery(this).find(".filename").on("click",(function(){return rcmail.command("download-attachment",e,!1)}))})),"function"==typeof rcube_calendar){var e=$("#attachmentsavecal").text();$(".attachmentslist .ics").each((function(){jQuery(this).find(".filename").append("<div class='attachmentslistplus' title='"+e+"' onclick='click_add_calendar(event,this)'></div>")}))}if($(".attachmentslist .rfc822").each((function(){var e=jQuery(this).find(".filename")[0],t=e.href;e.href+="&_extwin=1&_frame=1",e.dataset.original_href=t,jQuery(this).find(".filename").append("<div class='attachmentslistplus' onclick='click_dl_attachement(this)'></div>")})),$(".attachmentslist .audio").each((function(){jQuery(this).find(".filename").append("<div class='attachmentslistplus' onclick='audiobutton(event,this)'></div>")})),$(".zipdownload").length){var t=$(".zipdownload")[0];$(".tdzipdownload").css("display","table-cell"),$(".tdzipdownload").prop("title",t.innerText),$(".tdzipdownload").on("click",(function(){window.location=t.href})),$(".tdattachmentslist").attr("style","padding-right: 6px !important"),$(".zipdownload").remove()}$(".attachmentslist li").length>3&&($("#attach_fullsize").show(),setTimeout((function(){$("#attach_fullsize").show()}),300),$(".attachmentslist").css("max-height","100px"))}function elastic2022_markasjunkoption(){parent.rcmail.labels["markasjunk.notjunk"]&&(b_markasjunk_junk.classList.remove("hidden"),b_markasjunk_notjunk.classList.remove("hidden"))}function debug_markasjunk_button(){b_markasjunk_notjunk.innerText=parent.rcmail.labels["markasjunk.notjunk"]}function audiobutton(e,t){var n=$("#audioplayer")[0],i=jQuery(t).closest(".filename")[0].href;if(n.src==i){if(0==n.paused)return n.pause(),t.classList.remove("audiopause"),void e.preventDefault()}else audioend(),n.src=i;n.play(),t.classList.add("audiopause"),audioanim(),e.preventDefault()}function audioanim(){var e=$(".audiopause")[0],t=$("#audioplayer")[0],n=100*t.currentTime/t.duration;isNaN(n)&&(n=0),n>=100&&audioend(),e&&(e.closest("li").style.backgroundSize=n+"% 42px",setTimeout((function(){audioanim()}),50))}function audioend(){$(".audio").css("background-size","0% 42px"),$(".audiopause").removeClass("audiopause")}function click_add_calendar(e,t){var n=t.closest("li").id.replace("attach",""),i=$.ajax("?_task=calendar&_action=print",{async:!1}).responseText,a=i.indexOf("rcmail.set_env({")+15,o=i.indexOf("\n",a)-2,s=i.substring(a,o),r=JSON.parse(s),l=0;$.each(r.calendars,(function(e,t){t.editable&&l++})),1==l?rcmail.http_post("calendar/mailimportattach",{_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_part:n},rcmail.set_busy(!0,"itip.savingdata")):(rcmail.command("menu-open",{menu:"popupcalendarchoice",link:t},t,e),$("#popupcalendarchoice ul").empty(),$.each(r.calendars,(function(e,t){if(t.editable){var i=t.name,a=t.calendar_id;$("#popupcalendarchoice ul").append($('<li role="menuitem" onclick="click_add_calendarid('+a+",'"+n+'\')"><a class="calendar" role="button" tabindex="-1" aria-disabled="true" href="#">'+i+"</a></li>"))}}))),e.preventDefault()}function click_dl_attachement(e){var t=e.closest("a").dataset.original_href;location.assign(t),event.preventDefault()}function click_add_calendarid(e,t){rcmail.http_post("calendar/mailimportattach",{_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_part:t,_calendar:e},rcmail.set_busy(!0,"itip.savingdata"))}function attach_fullsize(){$(".attachmentslist").css("max-height","unset"),$("#attach_fullsize").hide()}function click_from_button(e){if(!e.disabled){var t=e.checked;rcmail.set_cookie("fromButton",t,!1),t?$("#compose_from").show():$("#compose_from").hide()}}function e2022_sortmenu_start(){$("#listsort-menu .submit").removeClass("submit");var e=rcmail.env.sort_col;e||(e="arrival"),$("#listsort-menu ."+e).addClass("submit"),$("#listsort-menu ."+rcmail.env.sort_order).addClass("submit")}function e2022_sortmenu(){var e=event.target;e.closest("ul").querySelector(".submit").classList.remove("submit"),e.classList.add("submit"),e2022_sortmenu_refresh()}function e2022_sortmenu_refresh(){var e=[...document.querySelector(".sort_order .submit").classList].filter((e=>"submit"!=e))[0],t=[...document.querySelector(".sort_col .submit").classList].filter((e=>"submit"!=e))[0];rcmail.set_list_sorting(t,e),rcmail.list_mailbox("","",t+"_"+e)}function e2022_filtermenu(){var e=[...event.target.classList].filter((e=>e.startsWith("_")))[0].replace("_","");"WITHATTACHMENT"==e&&(e="OR OR OR HEADER Content-Type application/ HEADER Content-Type multipart/mixed HEADER Content-Type multipart/signed HEADER Content-Type multipart/report"),$(rcmail.gui_objects.search_filter).val(e),rcmail.command("search")}function click_cubeselect(e){if($(":focus").blur(),"cubeselectfull"==e.className)return e.className="cubeselect",void rcmail.command("select-none","",!1,!1);e.className="cubeselectfull",rcmail.command("select-all","page",!1,!1)}function redraw_cubeselect(){var e=$('#messagelist .message:not([style*="display: none"])').length,t=$('#messagelist .message.selected:not([style*="display: none"])').length,n="cubeselect";t&&t>1&&t<e&&(n="cubeselectpartial"),t&&e==t&&(n="cubeselectfull"),cubeselect.className=n}function add_prio_icon(e){rcmail.message_list&&Object.entries(rcmail.message_list.rows).filter((([e,t])=>1===t.prio)).forEach((e=>{var t=e[1].obj.querySelectorAll(".attachment");2==t.length?t[0].innerHTML+="<div class='div_prio1'>!</div>":t[0].innerHTML="<div class='div_prio1' style='right:4px'>!</div>"}))}function click_delete_button(){if($(".header_back_back").length){var e=rcmail.env.uid;rcmail.env.mailbox==rcmail.env.trash_mailbox?rcmail.with_selected_messages("delete",{_uid:[e]}):rcmail.command("move",{id:rcmail.env.trash_mailbox,uids:[e]},"",event,!0)}else window.frameElement?parent.postMessage("simulate_click_delete_message","*"):$(".focused .deleteicon").click()}function header_back_back_func(){location.href=rcmail.env.comm_path.split("?")[0]}function check_minicompse(){return new_minicompose(),!1}function new_minicompose(){minicompose_container.insertAdjacentHTML("beforeend",'<div class="minicompose_maindiv" class="z-depth-2">\n<div class="minicompose_header"  onclick="minicompose_header_click2(this)">\n\t<div class="minicompose_header_left">\n\t\t<div class="minicompose_send" onclick="minicompose_send2(this)"><i class="sebicon sendicon"></i></div><i class="sebicon composeicon"></i><span class="minicompose_title"></span>\n\t</div>\n\t<div class="minicompose_header_right">\n\t\t<div class="sebicon minusicon" onclick="minicompose_but_hide2(this)"></div><div class="sebicon extwinicon" onclick="minicompose_extwin2(this)"></div><div class="sebicon closeicon" onclick="close_minicompose2(this)"></div>\n\t</div>\n</div>\n<iframe class="minicompose_iframe" src="?_task=mail&_action=compose" style="border:0;width:100%;height:calc(100% - 20px)"></iframe>\n</div>');var e=minicompose_container.querySelectorAll("iframe");minicompose_header_click2(e[e.length-1])}function close_minicompose2(e){error(e);var t=e.closest(".minicompose_maindiv");e.querySelector("iframe");t.parentNode.removeChild(t)}function minicompose_start(){$(".header").hide();var e=document.getElementById("compose-subject");e.addEventListener("beforeinput",minicompose_change_subject),e.addEventListener("keyup",minicompose_change_subject),$("#compose-headers .table-responsive-sm").css({"padding-right":"6px"}),window.addEventListener("beforeunload",(function(e){window.parent.close_minicompose2(window.frameElement)})),$(document.body).on("dragover dragleave drop",(function(e){return rcmail.document_drag_hover(e,"dragover"==e.type)})),$(document.body).addClass("droptarget").on("dragover dragleave",(function(e){return rcmail.file_drag_hover(e,"dragover"==e.type)})).get(0).addEventListener("drop",(function(e){return rcmail.file_dropped(e)}),!1),$("#attachment-list").insertAfter("#composebodycontainer"),$("#attachment-list").addClass("mini-attachement-list"),document.body.addEventListener("dragover",(e=>{window.parent.show_all_dragdivTS()})),document.body.addEventListener("dragleave",(e=>{window.parent.hide_all_dragdivTS()})),document.body.addEventListener("drop",(e=>{window.parent.hide_all_dragdivTS()}))}window.onmessage=function(e){"headers_dialog"==e.data&&UI.headers_dialog(),"resize_message"==e.data&&autoscale_message_reset(),"simulate_click_delete_message"==e.data&&$(".focused .deleteicon").click()},go_PWA();var dragdivshow=!1;function show_all_dragdiv(){dragdivshow||(document.querySelectorAll(".minicompose_iframe").forEach((e=>{e.contentWindow.dragdiv.style.display="block"})),dragdivshow=!0)}function hide_all_dragdiv(){document.querySelectorAll(".minicompose_iframe").forEach((e=>{e.contentWindow.dragdiv.style.display="none"})),dragdivshow=!1}function minicompose_change_subject(e){window.frameElement.parentElement.querySelector(".minicompose_title").innerText=e.target.value}function minicompose_header_click2(e){var t=e.closest(".minicompose_maindiv");t.classList.remove("minicompose_reduced2"),t.querySelector(".composeicon").style.display="none",t.querySelector(".sendicon").style.display="block"}function minicompose_but_hide2(e){var t=e.closest(".minicompose_maindiv");t.classList.add("minicompose_reduced2"),t.querySelector(".composeicon").style.display="block",t.querySelector(".sendicon").style.display="none",event.stopPropagation()}function get_iframe_from_minicomposeelm(e){return e.closest("#minicompose_maindiv").querySelector("iframe")}function minicompose_extwin2(e){e.closest(".minicompose_maindiv").querySelector("iframe").contentWindow.minicompose_extwinframe(),close_minicompose2(e)}function minicompose_extwinframe(){rcmail.enable_command("extwin",!0),rcmail.command("extwin","",this,event)}function minicompose_send2(e){e.closest(".minicompose_maindiv").querySelector("iframe").contentWindow.minicompose_sendframe()}function minicompose_sendframe(){rcmail.command("send","",this,event)}function is_in_iframe(){return window.self!==window.top}function elastic2022_create_settingsmenu(){}function e2022_dragdropevent(){var e=document.body;e.addEventListener("dragover",(e=>{show_all_dragdivTS()})),e.addEventListener("dragleave",(e=>{hide_all_dragdivTS()}))}var TShide=!1;function show_all_dragdivTS(){if(TShide)return clearTimeout(TShide),void(TShide=!1);show_all_dragdiv()}function hide_all_dragdivTS(){clearTimeout(TShide),TShide=setTimeout(hide_all_dragdiv,100)}function add_messagecontframe_event_dragdrop(){if(messagecontframe){var e=messagecontframe.document.body;e.getAttribute("dragdropfunc")?warn("add_messagecontframe_event_dragdrop already set"):(e.addEventListener("dragover",(e=>{window.parent.show_all_dragdivTS()})),e.addEventListener("dragleave",(e=>{window.parent.hide_all_dragdivTS()})),e.addEventListener("drop",(e=>{window.parent.hide_all_dragdivTS()})),e.setAttribute("dragdropfunc","true"))}else warn("no messagecontframe")}