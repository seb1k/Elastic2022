/**
 * Roundcube webmail functions for the Elastic skin
 *
 * Copyright (c) The Roundcube Dev Team
 *
 * The contents are subject to the Creative Commons Attribution-ShareAlike
 * License. It is allowed to copy, distribute, transmit and to adapt the work
 * by keeping credits to the original autors in the README file.
 * See http://creativecommons.org/licenses/by-sa/3.0/ for details.
 *
 * @license magnet:?xt=urn:btih:90dc5c0be029de84e523b9b3922520e79e0e6f08&dn=cc0.txt CC0-1.0
 */

log = function() {    return Function.prototype.bind.call(console.log, console);}();
warn = function() {    return Function.prototype.bind.call(console.warn, console);}();
error = function() {    return Function.prototype.bind.call(console.error, console);}();

 "use strict";function rcube_elastic_ui(){var e,t,n,a,s,o=this,l="normal",c="light",d=!1,u=rcmail.is_framed(),p={config:{standard_windows:rcmail.env.standard_windows,message_extwin:rcmail.env.message_extwin,compose_extwin:rcmail.env.compose_extwin,help_open_extwin:rcmail.env.help_open_extwin},checkboxes:0,small_screen_config:{standard_windows:!0,message_extwin:!1,compose_extwin:!1,help_open_extwin:!1}},m={},h=[],f=[],v={menu:$("#layout-menu"),sidebar:$("#layout-sidebar"),list:$("#layout-list"),content:$("#layout-content")},g={menu:$("a.task-menu-button"),back_list:$("a.back-list-button"),back_content:$("a.back-content-button")};function b(e,t,n,a){var s,o,l,c,d,p=!0,m=$("<a>"),h=e.attr("id")||new Date().getTime(),v=h+"-clone",g=e[0].className+(n?" "+n:"");return(t?(d=e.data("popup"))&&(m.data({popup:d,"toggle-button":e.data("toggle-button")}),O(m[0]),p=!1,rcmail.register_menu_button(m[0],d)):(g=g.replace("btn-primary","primary").replace(/(btn[a-z-]*|button|disabled)/g,"").trim(),g+=" button"+(a?"":" disabled")),m.attr({id:v,href:"#",class:g}).append($('<span class="inner">').text(e.text())),p&&m.on("click",function(t){e.click()}),u&&!t)?(m.data("target",e),f.push($.extend({button_id:v},y(e[0].id)))):(s=h,o=v,l=g.replace(" disabled",""),(c=y(s))&&rcmail.register_button(c.command,o,c.data.type,l,c.data.sel)),m}function y(e){var t,n,a;for(a in rcmail.buttons)for(t=0;t<rcmail.buttons[a].length;t++)if((n=rcmail.buttons[a][t]).id==e)return{command:a,index:t,data:n}}function k(){$("[data-list]").filter("ul,table").each(function(){var e=$(this),t=e.data("list");if(rcmail[t]&&rcmail[t].multiselect){var n,a,s=e.parents("layout-sidebar,#layout-list,#layout-content").last(),o=s.find(".header"),l=o.find("ul");l.length?(a=l.find("a.select").data("toggle-button"))&&(a=$("#"+a)):l=o,rcmail[t].enable_checkbox_selection();var c=1;if(e.is("#contacts-table")&&(c=0),c&&e.addClass("withselection"),!a){if(a=$("<a>").attr({class:"button selection disabled",role:"button",title:rcmail.gettext("select")}).on("click",function(){UI.toggle_list_selection(this,e.attr("id"))}).append($('<span class="inner">').text(rcmail.gettext("select"))),l.is(".menu")){if(a.prependTo(l).wrap('<li role="menuitem">'),v.content){var u=b(a,!0,"hidden-big hidden-large");$('<li role="menuitem">').append(u).appendTo("#toolbar-menu"),a=a.add(u)}}else(n=e.data("list-select-replace"))?$(n).replaceWith(a):(a.appendTo(l).addClass("icon"),s.is("#layout-sidebar")||a.addClass("toolbar-button"))}rcmail.addEventListener("listupdate",function(e){e.list&&e.list==rcmail[t]&&(e.rowcount?a.addClass("active").removeClass("disabled").attr("tabindex",0):a.removeClass("active").addClass("disabled").attr("tabindex",-1)),"mail"==rcmail.task&&(listupdate_go_msgs(),is_plugin_ident_switch_account()&&init_plugin_ident_switch_account(),rcmail.enable_command("e2022-sortmenu",!0),rcmail.register_command("e2022-sortmenu",e2022_sortmenu),rcmail.enable_command("e2022-filtermenu",!0),rcmail.register_command("e2022-filtermenu",e2022_filtermenu),e2022_sortmenu_start()),sessionStorage.getItem("autoopen")&&(Date.now()<parseInt(sessionStorage.getItem("autoopen"))&&messagelist.querySelector(".message").dispatchEvent(new Event("mousedown")),sessionStorage.removeItem("autoopen"))})}d&&rcmail[t]&&("function"==typeof rcmail[t].draggable?rcmail[t].draggable("destroy"):"boolean"==typeof rcmail[t].draggable&&(rcmail[t].draggable=!1),rcmail[t].dblclick_time=0)}),window.MutationObserver&&$("[data-label-msg]").filter("ul,table").each(function(){var e=$('<div class="listing-info hidden">').insertAfter(this),t=$(this),n=function(){var n,a,s=t.data("label-msg"),o=t.is("ul")?t:t.children("tbody");if(!rcmail.env.search_request&&!rcmail.env.qsearch&&s&&!o.children(":visible").length){n=t.data("label-ext"),a=t.data("create-command"),n&&(!a||rcmail.commands[a])&&(s+=" "+n),e.text(s).removeClass("hidden");return}e.addClass("hidden")},a=function(){if(rcmail.busy||!t.is(":visible"))return setTimeout(a,250);clearTimeout(p.list_timer),p.list_timer=setTimeout(n,50)};new MutationObserver(a).observe(t[0],{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}),a()}),"print"!=rcmail.env.action&&$("#attachment-list > li").each(function(){K(this)});var e=function(e){"phone"==l&&rcmail.display_message(rcmail.gettext(e),"confirmation")};if(rcmail.addEventListener("fileappended",function(t){t.attachment.complete&&(K(t.item),"text/vcard"==t.attachment.mimetype&&rcmail.commands["attach-vcard"]&&e("vcard_attachments.vcardattached"))}).addEventListener("managesieve.insertrow",function(e){x(e.obj)}).addEventListener("add-recipient",function(){e("recipientsadded")}),rcmail.init_pagejumper(".pagenav > input"),"mail"==rcmail.task){if("compose"==rcmail.env.action){rcmail.addEventListener("compose-encrypted",function(e){$("a.mode-html, button.attach").prop("disabled",e.active),$("a.attach, a.responses:not(.edit)")[e.active?"addClass":"removeClass"]("disabled")}),$("#layout-sidebar > .footer:not(.pagenav) > a.button").click(function(){$(this).is(".disabled")&&rcmail.display_message(rcmail.gettext("nocontactselected"),"warning")}),$("a.button.enigma").length&&($("a.button.enigma").remove(),$("#enigmamenu div.form-group").each(function(){$("#compose-options").prepend(this)}));var t=rcmail.get_cookie("fromButton");null==t&&(t=!0,1==_from.options.length&&(t="false")),"false"==t?$("#compose_from").hide():$("#fromButton").prop("checked",!0)}$("#fromButton").prop("disabled",!1),rcmail.env.extwin||"compose"!=rcmail.env.action&&"show"!=rcmail.env.action||$("a.mail",v.menu).attr({"aria-disabled":!1,onclick:"return rcmail.command('list','',this,event);"}),("preview"==rcmail.env.action||"show"==rcmail.env.action)&&($("a").filter('[href^="mailto:"]').each(function(){var e,t;e=this,t=e.onclick,e.onclick=null,$(e).on("click",function(n,a){return a||V($("#mailto-menu"),e,n,t)})}),elastic2022_change_mailheader(),elastic2022_change_attachmentslist())}else"settings"==rcmail.task?(rcmail.addEventListener("identity-encryption-show",function(e){x(e.container)}),rcmail.addEventListener("identity-encryption-update",function(e){x(e.container)})):"login"==rcmail.env.task&&setTimeout(function(){if($("#ifplcontainer").length){ifplcontainer.remove();var e=`
						<div class="custom-control custom-switch" style="display:block;width:100%;text-align:left;margin:12px 0 4px 5px;">
							<input type="checkbox" class="custom-control-input" id="_ifpl" name="_ifpl" value="1">
							<label class="custom-control-label" for="_ifpl" style="text-indent: 12px;line-height: 32px;">`+rcmail.gettext("ifpl_rememberme","persistent_login")+`</label>
						</div>`;$("#rcmloginpwd").parent().append(e)}});rcmail.set_env({thread_padding:"1.5rem",popup_width_small:1025,popup_width:1200}),rcmail.env.devel_mode&&window.less?less.pageLoadFinished.then(function(){T(),rcmail.env.compose_focus_elem&&$(rcmail.env.compose_focus_elem).focus()}):T();var n,a=rcmail.env.date_format_localized;a&&(n=function(e){$(e).filter(".datepicker").attr("placeholder",a),$(e).parent().find("select").each(function(){et(this)})},$("input.datepicker").each(function(){n(this)}),rcmail.addEventListener("insert-edit-field",n))}function x(e){if(e||(e=document),$("input.button,button",e).not(".btn").addClass("btn").not(".btn-primary,.primary,.mainaction").addClass("btn-secondary"),$("input.button.mainaction,button.primary,button.mainaction",e).addClass("btn-primary"),$("button.btn.delete,button.btn.discard",e).addClass("btn-danger"),$.each(["warning","error","information","confirmation"],function(){var t=this;$(".box"+t+":not(.ui.alert)",e).each(function(){H(this,t,!0)})}),e!=document&&1==$(".popup",e).children().length){var t=$(".popup",e).children().first();if(t.is("img"))$(".popup",e).addClass("justified");else if(t.is("label")){var n=t.find("input").detach(),a=t.detach(),s=n.attr("id");s||n.attr("id",s="dialog-input-elastic"),$(".popup",e).addClass("formcontent").append($('<div class="form-group row">').append(a.attr("for",s).addClass("col-sm-2 col-form-label")).append($('<div class="col-sm-10">').append(n))),n.focus()}}var o="input:not(.button,.no-bs,[type=button],[type=radio],[type=checkbox],[type=file]),textarea";$(o,$(".propform",e)).addClass("form-control"),$("[type=checkbox]",$(".propform",e)).addClass("form-check-input"),$("select",e).addClass("form-control custom-select"),e!=document&&$(o,e).addClass("form-control"),$("table.propform",e).each(function(){var e=0,t=0,n=["sm",4,8];$(this).attr("class").match(/cols-([a-z]+)-(\d)-(\d)/)&&(n=[RegExp.$1,RegExp.$2,RegExp.$3]),$(this).find("> tbody > tr, > tr").each(function(){var a,s,o=$(this),l=["form-group","row"],c=o.children("td");2==c.length?(a=c.first(),s=c.last(),$("label",a).addClass("col-form-label"),a.addClass("col-"+n[0]+"-"+n[1]),s.addClass("col-"+n[0]+"-"+n[2]),1!=s.find("[type=checkbox]").length||s.find(".proplist").length?s.find("input:not([type=hidden]),textarea,radio,select").length?t++:(s.addClass("form-control-plaintext"),e++):(l.push("form-check"),s.find("a").length&&l.push("with-link"),t++),s.children(".datepicker")&&2==s.children("input").length&&s.addClass("datetime")):1==c.length&&c.css("width","100%"),o.addClass(l.join(" "))}),e>t&&$(this).addClass("text-only")}),$("td.input-group",e).each(function(){$(this).children().slice(1).addClass("input-group-append")}),$("fieldset.propform:not(.grouped) div.row",e).each(function(){var e=$("input:not([type=hidden]),select,textarea",this).length>0;e&&$(o,this).addClass("form-control"),$(this).children().last().addClass("col-sm-8"+(e?"":" form-control-plaintext")),$(this).children().first().addClass("col-sm-4 col-form-label"),$(this).addClass("form-group")}),$("fieldset.propform.grouped fieldset",e).each(function(){$(".row",this).each(function(){var e,t=$("input,select,textarea",this).length>0,n=$(this).children();t&&$(o,this).addClass("form-control"),!(n.length<2)&&((e=n.first()).is("select")?e.addClass("input-group-prepend"):e.wrap('<span class="input-group-prepend">').addClass("input-group-text"),t||n.last().addClass("form-control-plaintext"),$(".content",this).addClass("input-group-prepend input-group-append input-group-text"),$("a.deletebutton",this).addClass("input-group-text icon delete").wrap('<span class="input-group-append">'),$(this).addClass("input-group"))})}),$("fieldset.advanced",e).each(function(){var e=$(this).children(".propform").first();e.wrap($("<div>").addClass("collapse")),$(this).children("legend").first().addClass("closed").on("click",function(){e.parent().collapse("toggle"),$(this).toggleClass("closed")})}),$(".propform > .prop.block:not(.row)",e).each(function(){$(this).addClass("form-group row").each(function(){$("label",this).addClass("col-form-label").wrap($('<div class="col-sm-4">')),$("input,select,textarea",this).wrap($('<div class="col-sm-8">')),$(o,this).addClass("form-control")})}),$("td.rowbuttons > a",e).addClass("btn"),$("form.tabbed,div.tabbed",e).each(function(e,t){var n=[],a=$("<ul>").attr({class:"nav nav-tabs",role:"tablist"});$(this).addClass("tab-content").children("fieldset").each(function(t,a){var s,o=a.id||"tab"+e+"-"+t,l=$(a).data("navlink-class");$(a).addClass("tab-pane").attr({id:o,role:"tabpanel"}),s=$("<li>").addClass("nav-item").append($("<a>").addClass("nav-link"+(l?" "+l:"")).attr({role:"tab",href:"#"+o}).text($("legend",a).first().text()).click(function(e){return $(this).tab("show"),N(e),!1})),$("legend",a).first().hide(),n.push(s)}),a.append(n).insertBefore(t),$("a.nav-link",a).first().click()}),$("input[type=file]:not(.custom-file-input)",e).each(function(){var e=rcmail.gettext("choosefile"+(this.multiple?"s":"")),t=$("<label>").attr({class:"custom-file-label","data-browse":rcmail.gettext("browse")}).text(e);$(this).addClass("custom-file-input").wrap('<div class="custom-file">'),$(this).on("change",function(){var t=e;this.files.length&&(t=this.files[0].name,this.files.length>1&&(t+=", ...")),$(this).next().text(t)}).parent().append(t)}),$("table:not(.table,.compact-table,.propform,.listing,.ui-datepicker-calendar)",e).filter(function(){return!$(this).parent().is(".propform")&&!$(this).parents("#message-header,.message-htmlpart,.message-partheaders,.boxinformation,.raw-tables").length}).each(function(){var e=$(this).addClass("table");e.parent().addClass("table-responsive-sm"),e.find("thead").addClass("thead-default")}),$("input.pretty-checkbox, .propform input[type=checkbox], .form-check input[type=checkbox], .popupmenu.form input[type=checkbox], .menu input[type=checkbox]",e).each(function(){Z(this)}),$(e).is(".actionrow")&&$("input[type=checkbox]",e).each(function(){Z(this)}),$(".input-group-combo > select",e).first().on("change",function(){var e=$(this),t=function(){e[e.next().is(":visible")?"removeClass":"addClass"]("alone")};setTimeout(t,50),setTimeout(t,2e3)}).trigger("change"),$("#message-objects",e).children(":not(.ui.alert)").add(".part-notice").each(function(){var e=String($(this).removeClass("notice part-notice").attr("class")).split(/\s/)[0]||"warning";H(this,e),$(this).addClass("box"+e),$("a",this).addClass("btn btn-primary btn-sm")}),$(".error",e).addClass("is-invalid"),"login"==rcmail.env.task&&e==document&&($("#rcmloginsubmit").addClass("btn-lg text-uppercase w-100"),$("#rcmloginoauth").addClass("btn btn-secondary btn-lg w-100"),$("#login-form table tr").each(function(){var e=$("input,select",this),t=$("label",this),n=e.data("icon"),a=$("<i>").attr("class","input-group-text icon "+e.attr("name").replace("_",""));n&&a.addClass(n),$(this).addClass("form-group row"),t.parent().css("display","none"),e.addClass(e.is("select")?"custom-select":"form-control").attr("placeholder",t.text()).before($('<span class="input-group-prepend">').append(a)).parent().addClass("input-group input-group-lg")})),$("select:not([multiple])",e).each(function(){et(this)})}function w(e){var t=[],n=$("#"+e.id).parent().is(".html-editor");if(e.config.plugins+=" autoresize",er()&&(e.config.toolbar="undo redo | link image styleselect"),"mail"==rcmail.task&&"compose"==rcmail.env.action){var a=!1,s=$("#compose-content > form"),o=function(e){"Tab"==e.key&&e.shiftKey&&$("#compose-content > form").scrollTop(0)};t.push(function(e){e.on("keypress",o)}),$("#composebody").on("keypress",o),s.on("scroll",function(){var e=$(".tox-editor-container",s),t=e.find(".tox-toolbar-overlord"),n=e.offset(),o=s.offset().top;n&&n.top-o<0?(t.css({position:"fixed",top:o+"px",width:e.width()+"px"}),a=!0):(a&&($("#compose-subject").focus(),a=!1),t.css({position:"relative",top:0,width:"auto"}))}),$(window).resize(function(){s.trigger("scroll")})}n&&(e.config.toolbar="plaintext | "+e.config.toolbar,e.config.setup_callback=function(e){e.ui.registry.addButton("plaintext",{tooltip:rcmail.gettext("plaintoggle"),icon:"close",onAction:function(t){rcmail.command("toggle-editor",{id:e.id,html:!1},"",t.originalEvent)&&$("#"+e.id).parent().removeClass("ishtml")}})}),t.push(function(e){e.on("OpenWindow",function(e){var t=$(".tox-dialog:last")[0],n=function(e){var n=$(t).find(".tox-dialog__body"),a=$(t).find(".tox-dialog__footer").find("button");e||(4===a.length?n.closest(".tox-dialog").addClass("tox-search-dialog"):2==a.length&&a.first().insertAfter(a[1])),n.find(".tox-checkbox > input").each(function(){Z(this)}),n.find(".tox-textarea,.tox-textfield").addClass("form-control")};window.MutationObserver&&new MutationObserver(n).observe($(".tox-dialog__body-content",t)[0],{childList:!0}),n()})}),rcmail.addEventListener("editor-load",function(e){$.each(t,function(){this(e.ref.editor)})})}function C(e){if($("ul",e.obj).addClass("menu listing iconized"),$(e.obj).addClass("popupmenu popover"),x(e.obj),$("input",e.obj).addClass("form-control"),eo()&&$(e.obj).is(".googie_window")){var t=rcmail.gettext("close"),n=$("<a>").attr("class","button icon cancel").text(t).click(function(t){t.stopPropagation(),$(".popover-overlay").remove(),$(e.obj).hide()});$('<h3 class="popover-header">').append(n).prependTo(e.obj),$(".popover-overlay").length||$("<div>").attr("class","popover-overlay").appendTo("body").click(function(){$(this).remove()}),$("ul,button",e.obj).click(function(e){$(e.target).is("input")||$(".popover-overlay").remove()})}}function E(e){if(u&&$.each(f,function(t,n){e.command==n.command&&parent.$("#"+n.button_id)[e.status?"removeClass":"addClass"]("disabled")}),"mail"==rcmail.task)switch(e.command){case"reply-list":if(1==rcmail.env.reply_all_mode){var t=rcmail.gettext(e.status?"replylist":"replyall");$(".toolbar a.reply-all").attr("title",t).find(".inner").text(t)}break;case"compose-encrypted":$(".toolbar a.encrypt").parent().show();break;case"compose-encrypted-signed":$("#encryption-menu-button").show()}}function _(){var e,t=$(window).width();e=t>1200?"large":t>768?"normal":"small",d=t<=1024,l=e}function L(){return l}function T(){var e;_(),S(),R(),(e=eo())?(rcmail.set_env(p.small_screen_config),rcmail.enable_command("extwin",!1)):(rcmail.set_env(p.config),rcmail.enable_command("extwin",!0)),$.each(h,function(){$(this)[e?"hide":"show"]()}),rcmail.triggerEvent("skin-resize",{mode:l})}function S(){if(u&&!v.sidebar.length&&!v.list.length){P();return}switch(l){case"phone":q(),B(!1);break;case"small":q(),B(!0),v.list.length&&$(".header > ul.menu",v.list).addClass("popupmenu");break;case"normal":var e;v.list.length&&(e=v.list.is(p.last_selected)||!v.sidebar.is(p.last_selected)&&!v.sidebar.is(".layout-sticky"),v.list[e?"removeClass":"addClass"]("hidden")),v.sidebar.length&&(e=!v.list.length||v.sidebar.is(p.last_selected)||v.sidebar.is(".layout-sticky"),v.sidebar[e?"removeClass":"addClass"]("hidden")),v.content.removeClass("hidden"),B(!0),z();break;case"large":$.each(v,function(e,t){t.removeClass("hidden")}),z(),v.list&&$(".header > ul.menu.popupmenu",v.list).removeClass("popupmenu")}I(l),P(),bw.webkit&&bw.ipad&&bw.agent.match(/OS 9/)&&$(".iframe-wrapper").each(function(){var e=$(this).height();e&&$(this).children("iframe").height(e)}),document.getElementById("messagecontframe")&&messagecontframe.postMessage("resize_message","*")}function R(){var e=es(),t=$(document.documentElement);t[0].className.match(/layout-([a-z]+)/)?RegExp.$1!=e.mode&&t.removeClass("layout-"+RegExp.$1).addClass("layout-"+e.mode):t.addClass("layout-"+e.mode),e.touch&&!t.is(".touch")?t.addClass("touch"):!e.touch&&t.is(".touch")&&t.removeClass("touch")}function I(e){var t=rcmail.env.additional_logos;t&&($("#logo").data("src-default")||$("#logo").data("src-default",$("#logo").attr("src")),"phone"==e&&"dark"==c&&t["small-dark"]?$("#logo").attr("src",t["small-dark"]):"phone"==e&&t.small?$("#logo").attr("src",t.small):"dark"==c&&t.dark?$("#logo").attr("src",t.dark):$("#logo").attr("src",$("#logo").data("src-default")))}function P(){$("#layout > div > .header").each(function(){var e,t=0,n=0,a={left:0,right:0};$(this).children(":visible:not(.position-absolute)").each(function(){if(!e&&$(this).is(".header-title")){e=$(this);return}a[e?"right":"left"]+=this.offsetWidth}),0+a.right>=a.left?(t=0,n=a.right+0-a.left):(n=0,t=a.left-(0+a.right)),$(e).css({"margin-right":t+"px","margin-left":n+"px","padding-right":"0px"})})}function q(){var e,t=!1;v.content.length&&(e=t=v.content.is(p.last_selected),v.content[e?"removeClass":"addClass"]("hidden"),$(".header > ul.menu",v.content).addClass("popupmenu")),v.list.length&&(e=!t&&v.list.is(p.last_selected),v.list[e?"removeClass":"addClass"]("hidden"),$(".header > ul.menu",v.list).addClass("popupmenu")),v.sidebar.length&&(e=!t&&(v.sidebar.is(p.last_selected)||!v.list.length),v.sidebar[e?"removeClass":"addClass"]("hidden")),t&&g.back_list.show()}function z(){g.back_list.filter(function(){return 0==$(this).parents("#layout-sidebar").length}).hide(),$("ul.menu.popupmenu").removeClass("popupmenu")}function A(e){P(),click_menu()}function M(e){v.list.length||v.sidebar.length?(v.sidebar.addClass("hidden").removeClass("layout-sticky"),v.list.removeClass("hidden"),("small"==l||"phone"==l)&&(p.last_selected=v.list[0]||v.sidebar[0],S(),rcmail.show_contentframe(!1),$("[data-list]",v.list).each(function(){var e=$(this).data("list");rcmail[e]&&(rcmail[e].clear_selection?rcmail[e].clear_selection():rcmail[e].select&&rcmail[e].select())})),e&&v.list.children(".scroller").scrollTop(0),p.last_selected=v.list[0]):history.back(),P()}function B(e){e?("phone"==l&&($('<div id="menu-overlay" class="popover-overlay">').on("click",function(){B(!1)}).appendTo("body"),p.menu_initialized||(p.menu_initialized=!0,$("a",v.menu).on("click",function(e){"phone"==l&&B()})),v.menu.addClass("popover")),v.menu.removeClass("hidden")):($("#menu-overlay").remove(),v.menu.addClass("hidden").removeClass("popover"))}function j(e){if("loading"==e.type&&$(".iframe-loader:visible").length){rcmail.hide_message(e.object);return}H(e.object,e.type,!0),$(e.object).attr("role","alert")}function H(e,t,n){var a,s="ui alert",o=!$(e).is(".noicon");n&&o&&!$(e).is(".aligned-buttons")&&$(e).html($("<span>").html($(e).html())),(a=({information:"alert-info",notice:"alert-info",confirmation:"alert-success",warning:"alert-warning",error:"alert-danger",loading:"alert-info loading",uploading:"alert-info loading",vcardattachment:"alert-info"})[t=t.split(" ")[0]])&&(s+=" "+a,o&&$("<i>").attr("class","icon").prependTo(e)),$(e).addClass(s)}function D(e){$();var t=$("a.button.options",e),n=$("input:not([type=hidden])",e),a=n.attr("placeholder"),s=($("form",e),function(){if(n.val()||"mail"==rcmail.task&&$("#s_interval").val()||rcmail.gui_objects.foldersfilter&&"---"!=$(rcmail.gui_objects.foldersfilter).val())return!0}),l=function(){$(e).is(".open")&&t.click()},c=function(){$(e)[s()?"addClass":"removeClass"]("active")};t.on("click",function(n){var a=$(this).data("target"),s=$("#"+a),l=$(e).is(".open");s.length&&(l||(o[a]?o[a](s.get(0),this,n):"function"==typeof window[a]&&window[a](s.get(0),this,n)),s.next()[l?"show":"hide"](),s.toggleClass("hidden"),$(".floating-action-buttons").toggleClass("hidden"),$(e).toggleClass("open"),$("button.search",s).off("click.search").on("click.search",function(){t.click(),c()}))}),n.on("input change",c).on("focus blur",function(e){n.attr("placeholder","blur"==e.type?a:"")}),$("a.reset",e).on("click",function(a){n.val("").change().trigger("keyup.treelist",{keyCode:27}),$(e).is(".open")&&t.click(),rcmail.gui_objects.foldersfilter&&($(rcmail.gui_objects.foldersfilter).val("---").change(),rcmail.folder_filter("---")),c()}),rcmail.addEventListener("init",c).addEventListener("responsebeforesearch",c).addEventListener("beforelist",l).addEventListener("afterlist",c).addEventListener("beforesearch",l)}function O(e,t){if(u&&eo())return parent.UI.popup_init(e,t||window);t||(t=window);var n,a=$(e).data("popup"),s=$(t.$("#"+a).get(0)),l=s,c=$(e).attr("title"),d=function(){return t!=window&&(s=l.clone(!0,!0)).attr("id",a+"-clone").appendTo(document.body).find("li > a").attr("onclick","").off("click").on("click",function(n){return $(this).is(".disabled")||($(e).popover("hide"),t.$("#"+$(this).attr("id")).click()),!1}),s.get(0)};$(e).attr({"aria-haspopup":"true","aria-expanded":"false","aria-owns":a}).popover({content:d,trigger:$(e).data("popup-trigger")||"click",placement:$(e).data("popup-pos")||"bottom",animation:!0,boundary:"window",html:!0}).on("show.bs.popover",function(l){var c=s.data("popup-init");a&&m[a]&&(m[a].transitioning=!0),c&&o[c]?o[c](s.get(0),e,l):c&&t[c]&&t[c](s.get(0),e,l),n=$("div.popover:visible").length+1,s.removeClass("hidden").attr("aria-hidden",!1).find('[aria-haspopup="true"]').data("level",n+1).off("click.popup").on("click.popup",function(e){e.stopPropagation()}),eo()||s.css("max-height",Math.min(539,$(window).height()-30))}).on("shown.bs.popover",function(t){var s=eo(),o=$("#"+$(e).attr("aria-describedby"));if(n=$(e).data("level")||1,s){var l=n>1?"back":"close",c=rcmail.gettext(l);$(".popover-header",o).empty().append($("<a>").attr("class","button icon "+("back"==l?"back":"cancel")).text(c).on("click",function(t){$(e).popover("hide"),n>1&&t.stopPropagation()}).on("mousedown",function(e){e.stopPropagation()}))}$.each(m,function(e,t){$(t.target).data("level")==n&&e!=a&&F(e)}),"key"==$(e).data("event")&&(o.off("keydown.popup").on("keydown.popup","a.active",function(t){var n,a,s="next";switch(t.which){case 27:case 9:return $(e).popover("toggle").focus(),!1;case 38:case 63232:s="previous";case 40:case 63233:for(n=t.target.parentNode;n=n[s+"Sibling"];)if(a=$(n).children(".active")[0]){a.focus();break}return!1}}),o.find("a.active").first().focus()),a&&m[a]&&(m[a].transitioning=!1),s&&!$(".popover-overlay").length&&$("<div>").attr("class","popover-overlay").appendTo("body").click(function(){$(this).remove()}),$(".popover-body",o).addClass("webkit-scroller")}).on("hide.bs.popover",function(){1==n&&$(".popover-overlay").remove(),a&&m[a]&&s.is(":visible")&&(m[a].transitioning=!0)}).on("hidden.bs.popover",function(){/-clone$/.test(s.attr("id"))?s.remove():s.attr("aria-hidden",!0).addClass("hidden").appendTo(s.data("popup-parent")||document.body),$(".popover-body:empty").each(function(){$(this).parent().remove()}),a&&m[a]&&delete m[a]}).on("click",function(){$(this).data("event","mouse")}).on("keydown",function(e){if(e.originalEvent)switch(e.originalEvent.which){case 13:case 32:e.preventDefault(),$(this).data("event","key").popover("toggle");break;case 27:$(this).popover("hide")}}),c&&$(e).attr("title",c),s.attr("aria-hidden","true").data("button",e),s.data("editable")&&s.on("click mousedown",function(e){e.stopPropagation()})}function N(e){!(t&&t>new Date().getTime()-250)&&$(".popover.show").each(function(){var t=$(".popover-body",this).children().first().data("button");t&&e.target!=t&&!$(t).find(e.target).length&&"string"!=typeof t&&$(t).popover("hide"),t||$(this).remove()})}function W(e){if(e&&e.name&&(!e.props||!1!==e.props.skinable)){if(u&&eo())return e.win||(e.win=window),parent.UI.menu_toggle(e);if("messagelistmenu"==e.name);else if("menu-open"==e.event){var t,n,a=$("ul",e.obj).first(),s=e.props&&e.props.link?e.props.link:e.originalEvent.target;if(!a.length)return;$(s).is("span")&&(s=$(s).parents("a,li")[0]),e.name.match(/^drag/)&&(n=rcube_event.get_mouse_pos(e.originalEvent),s=$("<a>").css({position:"absolute",left:n.x,top:n.y,height:"1px",width:"1px",visibility:"hidden"}).appendTo(document.body).get(0)),n=$(s).data("popup-pos")||"right","folder-selector"==e.name?a.addClass("listing folderlist"):"addressbook-selector"==e.name||"contactgroup-selector"==e.name?a.addClass("listing contactlist"):a.hasClass("menu")&&a.addClass("listing"),"pagejump-selector"==e.name&&(a.addClass("simplelist"),e.obj.addClass("simplelist"),n="top"),m[e.name]&&F(e.name,e.originalEvent),(t=function(){if(m[e.name]&&m[e.name].transitioning)return setTimeout(t,50);$(s).data("popup")||($(s).data({event:rcube_event.is_keyboard(e.originalEvent)?"key":"mouse",popup:e.name,"popup-pos":n,"popup-trigger":"manual"}),O(s,e.win)),m[e.name]={target:s},setTimeout(function(){$(s).popover("show")},1)})()}else F(e.name,e.originalEvent);e.originalEvent.stopPropagation()}}function F(e,t){var n,a,s=(n=e,m[n]?a=m[n].target:(a=$("#"+n).data("button"))||(n.match(/(?!-)menu$/)&&(n=n.substr(0,n.length-4)),a=$("#"+n+"-menu").data("button")),a);e.match(/^drag/)?$(s).popover("dispose").remove():($(s).popover("hide"),"forwardmenu"==e&&N(t))}function Y(e){$("[aria-owns="+e+"]").popover("dispose").data("popup",null)}function U(e){log("Not needed elastic2022, replaced by dropdown menu")}function X(e,t,n){var a=$(t).parent().attr("id").replace(/^attach/,"");return $.each(["open","download","rename"],function(){var t=this;$("#attachmenu"+t,e).off("click").attr("onclick","").click(function(e){return rcmail.command(t+"-attachment",a,this,e.originalEvent)})}),rcmail.command("menu-open",{menu:"attachmentmenu",id:a},e,n)}function K(e){if(!(e=$(e)).is(".no-menu")&&!e.children(".dropdown").length){var t=rcmail.gettext("options"),n=e.find("a.filename"),a=$("<a>").attr({href:"#",tabindex:n.attr("tabindex")||0,title:t,class:"button icon dropdown skip-content"}).on("click",function(e){return X($("#attachmentmenu"),a,e)}).append($("<span>").attr("class","inner").text(t));n.length?a.insertAfter(n):a.appendTo(e)}}function V(e,t,n,a){var s=$(t).attr("href").replace(/^mailto:/,"");return 0>s.indexOf("@")||(e.find("a").off("click").removeClass("active"),rcmail.env.has_writeable_addressbook&&$(".addressbook",e).addClass("active").on("click",function(e){var n=s,a=$(t).filter(".rcmContactAddress").text();return n=n.split("?")[0].split(",")[0].replace(/(^<|>$)/g,""),a&&(n='"'+(a=a.replace("<"+n+">","")).trim()+'" <'+n+">"),rcmail.command("add-contact",n,this,e.originalEvent)}),$(".compose",e).addClass("active").on("click",function(e){return a?(t.onclick=a,$(t).trigger("click",[!0]),t.onclick=null):rcmail.command("compose",s,this,e.originalEvent),!1}),rcmail.command("menu-open",{menu:"mailto-menu",link:t},t,n.originalEvent))}function G(e){var t=$("#quotadisplay"),n=t.find(".bar"),a=e.total?e.percent:0;n.length||(n=$('<span class="bar"><span class="value"></span></span>').appendTo(t)),a>0&&a<10&&(a=10),n.find(".value").css("width",a+"%")[a>=90?"addClass":"removeClass"]("warning"),t.attr({"data-original-title":"",title:t.find(".count").attr("title")}),e.table?t.css("cursor","pointer").data("popup-pos","top").off("click").on("click",function(t){rcmail.simple_dialog(e.table,"quota",null,{cancel_button:"close"})}):t.tooltip("dispose").tooltip({trigger:eo()?"click":"hover"})}function J(e){e=e.replace(/[,;\s]*[\r\n]+/g,",").trim();var t=[],n='(\\S+|("[^"]+"))@\\S+',a=RegExp("(<"+n+">)"),s=RegExp("("+n+")"),o=e.match(/(?=\S)[^",;]*(?:"[^\\"]*(?:\\[,;\S][^\\"]*)*"[^",;]*)*/g);return $.each(o||[],function(){if(this.length&&(a.test(this)||s.test(this))){var n,o=this;for(e=e.replace(o,"");o.length&&0===o.indexOf(RegExp.$1)&&(n=RegExp.$1,t.push({name:"",email:n.replace(/(^<|>$)/g,"").replace(/[^a-z]$/gi,"")}),o=o.replace(n,"").trim(),a.test(o)||s.test(o)););n!=RegExp.$1&&RegExp.$1&&(n=RegExp.$1,t.push({name:o.replace(n,"").trim(),email:n.replace(/(^<|>$)/g,"")}))}}),{recipients:t,text:e=e.replace(/[,;]+/,",").replace(/^[,;\s]+/,"")}}function Q(e){if((e=$(e)).length){var t=$('<div class="iframe-loader">').append($('<div class="spinner spinner-border" role="status">').append($('<span class="sr-only">').text(rcmail.gettext("loading"))));e.on("load error loaded",function(){setTimeout(function(){t.remove()},500)}).parent().append(t)}}function Z(e){var t,n;!(e=$(e)).is(".custom-control-input")&&((n=e.attr("id"))||(n="icochk"+ ++p.checkboxes,e.attr("id",n)),e.parent().is("label")?(t=e.parent(),e=e.detach(),t.before(e)):t=$("<label>"),t.attr({for:n,class:"custom-control-label",title:e.attr("title")||""}).on("click",function(e){e.stopPropagation()}),e.addClass("form-check-input custom-control-input").wrap('<div class="custom-control custom-switch">').parent().append(t))}function ee(e){var t,n=$(e.row).find("input[id^=icochk]");n.length&&(t="icochk"+ ++p.checkboxes,n.attr("id",t).next("label").attr("for",t))}function et(e){if(!(bw.iphone||bw.ipad||(e=$(e)).is(".pretty-select"))){var n="select"+e.attr("id")+e.attr("name"),a=function(){if(e[0].ownerDocument.defaultView.$(".select-menu .listing").data("ident")==n)return!0},s=function(){var t=a();return e.popover("dispose").focus(),!t},o=function(t){var a,o=-1,l=[],c=[],d=e.closest(".ui-dialog")[0],u=(document.documentElement.clientHeight||$(document.body).height())-75,p=$(document.body).width()-20,m=Math.min(e.outerWidth(),p),h=e.val();eo()||(u*=.5),N(t),$("option",e).each(function(){var e=$(this).text(),t=$('<a href="#">').data("value",this.value).addClass(this.disabled?"disabled":"active"+(this.value==h?" selected":""));e.length?(t.text(e),c.push(this.disabled?"":e.charAt(0).toLowerCase())):(t.html("&nbsp;"),c.push("")),l.push($("<li>").append(t))});var f=$('<ul class="listing selectable iconized">').attr("data-ident",n).data("button",e[0]).append(l).on("click","a.active",function(){var t=$(this).data("value"),n=s();return e.val(t).change(),n}).on("keydown","a.active",function(e){var t,n,l,d,u="next";switch(e.which){case 27:case 9:return s();case 13:case 32:return $(this).click(),!1;case 38:case 63232:u="previous";case 40:case 63233:for(t=e.target.parentNode;t=t[u+"Sibling"];)if(d=$(t).children(".active")[0]){d.focus();break}return!1;default:(n=e.originalEvent.key)&&1==n.length&&(a!=(n=n.toLowerCase())&&(o=-1),((l=c.indexOf(n,o+1))>-1||(l=c.indexOf(n))>-1)&&f.find("a").eq(l).focus(),a=n,o=l)}});e.popover("dispose").popover({container:d||document.body,content:f[0],placement:"bottom",trigger:"manual",boundary:"viewport",html:!0,offset:"0,2",sanitize:!1,template:'<div class="popover select-menu" style="min-width: '+m+"px; max-width: "+p+'px"><div class="popover-header"></div><div class="popover-body" style="max-height: '+u+'px"></div></div>'}).on("shown.bs.popover",function(){e.focus(),f.parent().prev().empty().append($('<a class="button icon cancel">').text(rcmail.gettext("close")).on("click",function(e){return e.stopPropagation(),s()}));var n=f.find("a.selected").first();if(n.focus().length){var l=f.parent();a=c[o=f.find("a").index(n[0])],bw.mz&&o>5&&l.scrollTop(l.scrollTop()+l.height()/2-20)}else rcube_event.is_keyboard(t)&&f.find("a.active").first().focus();f.on("mousedown",function(e){e.stopPropagation()})}).popover("show")};e.addClass("pretty-select custom-select form-control").on("mousedown keydown",function(n){return(e=$(n.target)).prop("disabled")?void 0:9==n.which?(s(),!0):27==n.which||"mousedown"==n.type&&a()?s():(e.focus(),e.prop("disabled",!0),setTimeout(function(){e.prop("disabled",!1)},0),n.stopPropagation(),"mousedown"==n.type||13==n.which||32==n.which||40==n.which||63233==n.which)?(o(n),t=new Date().getTime(),!1):void 0})}}function en(e,t,n,a,s){error("smart_field_row_add");var o,l=$('<div class="input-group"><input type="text" class="form-control"><span class="input-group-append"><a class="icon reset input-group-text" href="#"></a></span></div>');return o=l.find("input").attr({value:t,name:a.name+"[]",size:$(a).data("size"),title:a.title,placeholder:a.placeholder}).keydown(function(t){if(13==t.which){var n=en(e,"",new Date().getTime(),a,o.parent());$("input",n).focus()}else if((8==t.which||46==t.which)&&""==o.val()){var s=o.parent();if(e.children().length>1)return s.prev().length?s.prev().children("input").focus():s.next().children("input").focus(),s.remove(),!1}}),l.find("a.reset").click(function(){var t=$(this.parentNode.parentNode);e.children().length>1?($("input",t.next().length?t.next():t.prev()).focus(),t.remove()):$("input",t).val("").focus()}),l.find("input,a").on("focus",function(){e.addClass("focused")}).on("blur",function(){e.removeClass("focused")}),s?s.after(l):l.appendTo(e),l}function ea(t){var n=t.find(".scroller .listing").first().attr("id"),a=rcmail.env.task+"."+(n||rcmail.env.action+"."+t.attr("id")),s=function t(n){if(e||(e=rcmail.local_storage_get_item("prefs.elastic",{})),null==e[n]){var a=rcmail.get_cookie(n);null!=a&&(e[n]=a,rcmail.local_storage_set_item("prefs.elastic",e)&&rcmail.set_cookie(n,a,new Date))}return e[n]}(a),o=t.is(".sidebar-right"),l=function(e){t.css({width:Math.max(100,e),flex:"none"})};t[o?"prev":"next"]().length&&($('<div class="column-resizer">').addClass(o?"inverted":null).appendTo(t).on("mousedown",function(n){var s,c=$(this),d=t.position().left;c.addClass("active"),document.body.style.userSelect="none",$(document).on("mousemove.resizer",function(e){clearTimeout(s),s=setTimeout(function(){o&&(d=t.position().left);var n=rcube_event.get_mouse_pos(e).x;l(o?t.width()+(d-n):n-d)},5)}).on("mouseup.resizer",function(){var n,s;$(document).off(".resizer"),$("iframe").off(".resizer"),document.body.style.userSelect="auto",c.removeClass("active"),n=a,s=t.width(),e[n]=s,rcmail.local_storage_set_item("prefs.elastic",e)||rcmail.set_cookie(n,s,!1)})}),s&&l(s))}function ei(e,t,n,a){var s=function(e){$(e).css({color:$(document.body).css("color"),backgroundColor:$(document.body).css("background-color")})},o="dark"==c&&/_task=mail/.test(e)&&/_action=viewsource/.test(e);if(!eo()||!0===a){/_task=mail/.test(e)&&/_action=get/.test(e)&&(t=!0);var l=p.open_window.call(rcmail,e,t,n);return o&&$(l).on("load",function(){s(l.document.body)}),l}e=rcmail.add_url(e,"_framed",1),e=rcmail.add_url(e,"_extwin",1);var d,u="",m={cancel_button:"close",width:768,height:768},h=$("<iframe>").attr({id:"windowframe",src:e});return/_action=([a-z_]+)/.test(e)&&(d=rcmail.labels[RegExp.$1])&&(u=d),/_frame=1/.test(e)&&(m.dialogClass="no-titlebar"),o&&h.on("load",function(){s(h[0].contentWindow.document.body)}),rcmail.simple_dialog(h,u,null,m),!0}function es(){if(u){var e=$(parent.document.documentElement);return{mode:e[0].className.match(/layout-([a-z]+)/)?RegExp.$1:l,touch:e.is(".touch")}}return{mode:l,touch:d}}function eo(){var e=es();return"phone"==e.mode||"small"==e.mode}function er(){return es().touch}this.register_content_buttons=function e(t){if(p.frame_nav&&t&&t.length){var n=p.frame_nav.children(".buttons");h=[],$.each(t,function(){this.data("target")&&h.push(this.data("target"))}),n.html("").append(t)}},this.menu_hide=F,this.menu_toggle=W,this.menu_destroy=Y,this.popup_init=O,this.about_dialog=function e(t){var n,a,s=!1,o=$("<iframe>").attr({id:"aboutframe",src:rcmail.url("settings/about",{_framed:1})}),l=$("#supportlink");l.length&&(n=l.attr("href"))&&(s=l.text(),a=function(e){0>n.indexOf("mailto:")?window.open(n):location.href=n}),rcmail.simple_dialog(o,$(t).text(),a,{button:s,button_class:"help",cancel_button:"close",height:400})},this.headers_dialog=function e(){if(document.getElementById("messagecontframe")){messagecontframe.postMessage("headers_dialog","*");return}var t={_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_framed:1},n=$("<iframe>").attr({id:"headersframe",src:rcmail.url("headers",t)});return rcmail.simple_dialog(n,"Headers",null,{cancel_button:"close",height:600}),!0},this.import_dialog=function e(){if(rcmail.commands["import-messages"]){var t=$("#uploadform").clone(!0),n=function(e){return rcmail.command("import-messages",$(t.find("form")[0]))};rcmail.simple_dialog(t,rcmail.gettext("importmessages"),n,{button:"import",closeOnEscape:!0,minWidth:400})}},this.props_dialog=function e(){var t=$("#properties-menu").clone();rcmail.simple_dialog(t,rcmail.gettext("properties"),null,{cancel_button:"close",height:400})},this.spellmenu=function e(t){var n,a,s,o=[],l=rcmail.spellcheck_lang(),c=$("ul",t);if(!c.length){for(n in c=$('<ul class="selectable listing iconized" role="menu">'),rcmail.env.spell_langs)s=$('<li role="menuitem">'),(a=$('<a href="#'+n+'" tabindex="0"></a>').text(rcmail.env.spell_langs[n]).addClass("active").data("lang",n).on("click keypress",function(e){if("keypress"!=e.type||13==rcube_event.get_keycode(e))return rcmail.spellcheck_lang_set($(this).data("lang")),rcmail.hide_menu("spell-menu",e),!1})).appendTo(s),o.push(s);c.append(o).appendTo(t)}$("li",c).each(function(){var e=$("a",this);e.data("lang")==l?e.addClass("selected").attr("aria-selected","true"):e.hasClass("selected")&&e.removeClass("selected").removeAttr("aria-selected")})},this.searchmenu=function e(t){var n,a="*",s=$('input[name="s_mods[]"]',t),o=$("#s_scope",t),l=$("#s_interval",t),c=rcmail.env.mailbox,d=rcmail.env.search_mods,u=rcmail.env.search_scope||"base";if(!$(t).data("initialized")&&($(t).data("initialized",!0),s.length&&(s.on("change",function(){var e,n,a,s,o,l,c;e=t,n=this,o=rcmail.env.task,l=rcmail.env.search_mods||{},c=rcmail.env.mailbox,"mail"==o?(l[c]||(l[c]=rcube_clone_object(l["*"])),s=l[c],a="text"):(s=l,a="*"),n.checked?s[n.value]=1:delete s[n.value],n.value==a&&$('input[name="s_mods[]"]',e).not(n).map(function(){this.checked=!0,n.checked?(this.disabled=!0,delete s[this.value]):(this.disabled=!1,s[this.value]=1)}),rcmail.set_searchmods(s)}),rcmail.addEventListener("beforesearch",function(){rcmail.env.search_scope=o.val(),rcmail.env.search_interval=l.val()}))),o.val(u),d){if("mail"==rcmail.env.task&&(d=d[c]||d["*"],a="text"),d[a])s.map(function(){this.checked=!0,this.disabled=this.value!=a});else for(n in s.prop("disabled",!1).prop("checked",!1),d)s.filter('[value="'+n+'"]').prop("checked",!0)}},this.headersmenu=function e(t,n,a){$("li > a",t).each(function(){var e=$(this),t="#compose_"+e.data("target");e[$(t).is(":visible")?"removeClass":"addClass"]("active").off().on("click",function(){$(t).removeClass("hidden").find(".recipient-input input").focus(),e.removeClass("active"),rcmail.set_menu_buttons()})})},this.header_reset=function e(t){$("#"+t).val("").change().closest(".form-group").nextAll(":not(.hidden)").first().find("input").focus(),$("a[data-target="+t.replace(/^_/,"")+"]").addClass("active"),rcmail.set_menu_buttons()},this.attachmentmenu=X,this.mailtomenu=V,this.recipient_selector=function e(t,n){n||(n={});var a=rcmail.gettext(n.title||"insertcontact"),s=$("#recipient-dialog"),o=s.parent(),l=function(){s.is(":visible")&&rcmail.env.recipient_dialog.dialog("close")},c=function(){if(n.action){n.action(),l();return}rcmail.command("add-recipient")};rcmail.env.recipient_selector_initialized||(rcmail.addEventListener("add-recipient",l),rcmail.env.recipient_selector_initialized=!0),t&&(rcmail.env.focused_field="#_"+t),rcmail.contact_list.clear_selection(),rcmail.contact_list.multiselect=!("multiselect"in n)||n.multiselect,rcmail.env.recipient_dialog=rcmail.simple_dialog(s,a,c,{button:rcmail.gettext(n.button||"insert"),button_class:n.button_class||"insert recipient",height:600,classes:{"ui-dialog-content":"p-0"},open:function(){$("#directorylist a").first().focus()},close:function(){s.appendTo(o),$(this).remove(),$(n.focus||rcmail.env.focused_field).focus()}})},this.show_list=M,this.show_sidebar=A,this.smart_field_init=function e(t){var n=t.id+"_list",a=$('<div class="multi-input"><div class="content"></div><div class="invalid-feedback"></div></div>'),s=t.value?t.value.split("\n"):[""];!$("#"+n).length&&($.each(s,function(e,n){en($(".content",a),n,e,t)}),a.attr("id",n),(t=$(t)).attr("disabled")?a.hide():t.prop("disabled",!0),t.data("hidden")&&a.hide(),t.after(a),t.hasClass("is-invalid")&&(a.addClass("is-invalid"),$(".invalid-feedback",a).text(t.data("error-msg"))))},this.smart_field_reset=function e(t,n){var a=t.id+"_list",s=n.length?n:[""],o=$("#"+a).children(".content");o.empty(),$.each(s,function(e,n){en(o,n,e,t)})},this.form_errors=function e(t){$.each(t,function(){var e=$("#"+this[0]).addClass("is-invalid");if("list"==e.data("type")){e.data("error-msg",this[2]),$("#"+this[0]+"_list > .invalid-feedback").text(this[2]);return}e.after($('<span class="invalid-feedback">').text(this[2]))})},this.switch_nav_list=function e(t){var n,a,s=$("a",t),o=$(t).next();o.height()?(o.animate({height:"0"},250),s.addClass("expand").removeClass("collapse"),$(t).removeClass("expanded")):(n=$("tr,li",o).filter(function(){return"none"!=this.style.display}),a=$(n[0]).height()||50,o.animate({height:Math.min(5,n.length)*a+1+"px"},250),s.addClass("collapse").removeClass("expand"),$(t).addClass("expanded"))},this.searchbar_init=D,this.pretty_checkbox=Z,this.pretty_select=et,this.datepicker_init=function e(t){window.MutationObserver&&$(t).not("[data-observed]").each(function(){var e,t=!0,n=u?parent:window,a=function(a){$.each(a,function(a,s){if("attributes"==s.type){var o="true"==$(s.target).attr("aria-hidden");o!=t&&(o?e&&e.remove():e=$("<div>").attr("class","ui-widget-overlay datepicker").appendTo(n.document.body).click(function(e){$(this).remove(),u&&$.datepicker._hideDatepicker()}),t=o)}else s.addedNodes.length&&u&&(n.$("select.ui-datepicker-month",s.target).on("change",function(){$.datepicker._selectMonthYear($.datepicker._lastInput,this,"M")}),n.$("select.ui-datepicker-year",s.target).on("change",function(){$.datepicker._selectMonthYear($.datepicker._lastInput,this,"Y")}))})};$(this).attr("data-observed","1"),u&&($(this).detach().appendTo(parent.document.body),$('<div id="ui-datepicker-div" class="hidden">').appendTo(document.body)),new MutationObserver(a).observe(this,{childList:!0,subtree:!1,attributes:!0,attributeFilter:["aria-hidden"]})})},this.bootstrap_style=x,this.get_screen_mode=L,this.screen_resize_headers=P,this.is_mobile=eo,this.is_touch=er,_(),R(),function e(){if(function e(){if("print"!=rcmail.env.action){var t=rcmail.get_cookie("colorMode"),n=window.matchMedia("(prefers-color-scheme: dark)"),a=function(){rcmail.set_cookie("colorMode","",new Date)},s=function(){try{$(this.contentWindow.document).find("html")["dark"==c?"addClass":"removeClass"]("dark-mode")}catch(e){}},o=function(){"dark"==c?($("#taskmenu a.theme").removeClass("dark").addClass("light").find("span").text(rcmail.gettext("lightmode")),$(".click_change_theme").removeClass("dark").addClass("light").find("span"),$(".sebicon_contrast_txt").text(rcmail.gettext("lightmode")),$("html").addClass("dark-mode"),$('meta[name="theme-color"]').attr("content","#1A1C1E")):($("#taskmenu a.theme").removeClass("light").addClass("dark").find("span").text(rcmail.gettext("darkmode")),$(".click_change_theme").removeClass("light").addClass("dark").find("span"),$(".sebicon_contrast_txt").text(rcmail.gettext("darkmode")),$("html").removeClass("dark-mode"),$('meta[name="theme-color"]').attr("content","#ffffff")),I(l),$("iframe").each(s)};if(!1===rcmail.env.dark_mode_support){"dark"==t&&(a(),$("iframe").each(s));return}$("#taskmenu a.theme").on("click",function(){c=$(this).is(".dark")?"dark":"light",o(),rcmail.set_cookie("colorMode",c,!1)}),$(".click_change_theme").on("click",function(){c=$(this).is(".dark")?"dark":"light",o(),rcmail.set_cookie("colorMode",c,!1)}),n.addListener(function(e){c=e.matches?"dark":"light",o(),a()}),t?c=t:n.matches&&(c="dark"),o(),$("iframe").on("load",s)}}(),p.last_selected=$("#layout > div.selected")[0],!p.last_selected&&v.content.length&&$.each(["sidebar","list","content"],function(){if(v[this].length)return p.last_selected=v[this][0],v[this].addClass("selected"),!1}),$(window).on("resize",function(){clearTimeout(p.resize_timeout),p.resize_timeout=setTimeout(function(){T()},25)}),p.open_window=rcmail.open_window,rcmail.open_window=ei,rcmail.addEventListener("message",j).addEventListener("menu-open",W).addEventListener("menu-close",W).addEventListener("editor-init",w).addEventListener("autocomplete_create",C).addEventListener("googiespell_create",C).addEventListener("setquota",G).addEventListener("enable-command",E).addEventListener("destroy-entity-selector",function(e){Y(e.name)}).addEventListener("clonerow",ee).addEventListener("init",k),v.list.length||v.content.length){var t=[];$("[data-fab]").each(function(){var e=$(this),n=e.data("fab-task")||"*",a=e.data("fab-action")||"*";"*"!=n&&n!=rcmail.env.task||"*"!=a&&a!=rcmail.env.action&&("none"!=a||rcmail.env.action)||t.push(b(e,!1,!1,!0))}),t.length&&$('<div class="floating-action-buttons">').append(t).appendTo(v.list.length?v.list:v.content)}v.sidebar.length&&ea(v.sidebar),v.list.length&&ea(v.list)}(),x(),function e(){if(!p.got_smart_toolbar){p.got_smart_toolbar=!0;var t,n=[],a=[],s=es(),o=function(e,t,n){var a=$('<li role="menuitem">');(e=n?b($(e),!0,"hidden-big hidden-large"):$(e).detach()).contents().filter(function(){3==this.nodeType&&0==this.nodeValue.trim().length&&$(this).remove()}),e.is(".spacer")?a.addClass("spacer"):a.append(e),t.push(a)};if(v.content.find(".header > .menu").each(function(){var e=$(this);e.children().each(function(){o(this,n)}),e.remove()}),v.list.find(".header > .menu").each(function(){var e=$(this);t=e.next(),e.children().each(function(){"large"!=s.mode&&$(this).data("popup-pos","right"),o(this,n,!0),o(this,a)}),e.remove()}),$('ul[data-menu="toolbar-small"] > li > a').each(function(){var e=$(this).clone();e.attr("id",this.id+"_clone"),n.push($('<li role="menuitem">').addClass("hidden-big").append(e))}),a.length){var l=v.list.children(".header"),c={class:"menu toolbar popupmenu listing iconized",id:"toolbar-list-menu"},d=$('<a class="button icon toolbar-list-button" href="#list-menu">').attr({"data-popup":"toolbar-list-menu"}),u=$("<ul>").attr(c).data("popup-parent",l).append(a);t.length?u.insertBefore(t):l.append(u),l.append(d)}if(n.length){var l=v.content.children(".header"),c={class:"menu toolbar popupmenu listing iconized",id:"toolbar-menu"},d=$('<a class="button icon toolbar-menu-button" href="#menu">').attr({"data-popup":"toolbar-menu"});l.append($("<ul>").attr(c).data("popup-parent",l).append(n)).append(d),v.list.find("a.toolbar-menu-button").click(function(e){e.stopPropagation(),d.click()})}}}(),function e(){if(v.list.length){var t=p.last_selected,n=function(e){"string"==typeof e&&e.length||(e=$("h1.voice").text()||$("title").text()||""),v.content.find(".header > .header-title").text(e)},a=function(e,a,s,o){eo()&&p.frame_nav&&function e(t,n){if(t.match(/_action=(create|add)/)||t.match(/_nav=hide/)){$(p.frame_nav).addClass("hide-nav-buttons");return}var a,s,o,l=$("[data-list]",v.list).data("list");if(!l||!(o=rcmail[l])){$(p.frame_nav).is(".hide-nav-buttons")&&!$(".buttons",p.frame_nav).children().length&&$(p.frame_nav).addClass("hidden");return}$(p.frame_nav).removeClass("hide-nav-buttons hidden"),(s=o.get_single_selection())&&(o.rows&&o.rows[s]&&!o.rows[s].expanded?o.expand_row(n,s):o.get_node&&(a=o.get_node(s))&&a.collapsed&&o.expand(s));var c,d,u=$("#"+rcmail.env.contentframe),m=$("a.button.next",p.frame_nav).off("click").addClass("disabled"),h=$("a.button.prev",p.frame_nav).off("click").addClass("disabled");((d=o.get_next())||rcmail.env.current_page<rcmail.env.pagecount)&&m.removeClass("disabled").on("click",function(){p.content_lock=!0,Q(u),d?o.select(d):(rcmail.env.list_uid="FIRST",rcmail.command("nextpage"))}),((c=o.get_prev())&&("*"!=c||"subscription_list"!=l)||rcmail.env.current_page>1)&&h.removeClass("disabled").on("click",function(){p.content_lock=!0,Q(u),c?o.select(c):(rcmail.env.list_uid="LAST",rcmail.command("previouspage"))})}(a,e),s&&!v.content.is(":visible")?p.last_selected=v.content[0]:s||p.last_selected==t||p.content_lock||(p.last_selected=t),S(),n(o&&s?o:null),p.content_lock=!1},s=function(e){"large"!=l&&!p.content_lock&&e.force&&M(),p.content_lock=!1,e.title&&$(".header > .header-title",v.list).text(e.title)},o=function(e){var t={};if(("addressbook"==rcmail.env.task||"mail"==rcmail.env.task)&&(t.force=!0),"mail"==rcmail.env.task&&!rcmail.env.action){var n="string"==$.type(e)?e:rcmail.env.mailbox,a=rcmail.env.mailboxes[n];t.title=a?a.name:""}s(t)};v.content.find("iframe").on("load",function(e){var t,s="",o=!0;$(this).parent(".iframe-wrapper").scrollTop(0);try{o=!(s=(t=e.target.contentWindow).location.href).endsWith(rcmail.env.blankpage),$(t).on("unload",n)}catch(l){}a(e,s,o)}),rcmail.addEventListener("afterlist",o).addEventListener("afterlistgroup",o).addEventListener("afterlistsearch",o).addEventListener("show-list",function(e){e.force=!0,s(e)}).addEventListener("show-content",function(e){e.obj&&!$(e.obj).is("iframe")&&($(e.scrollElement||e.obj).scrollTop(0),eo()&&Q(e.obj)),a(e.event||new Event,"_action="+(e.mode||"edit"),!0,e.title)})}}(),$("[data-popup]").each(function(){O(this)}),$(document).on("click",N),rcube_webmail.set_iframe_events({mousedown:N,touchstart:N}),s=[],$.ui&&$.widget("ui.dialog",$.ui.dialog,{open:function(){var e,t,n,a,s,o;return $(this.element).is(".iframe")&&(this.options.width=Math.max(576,this.options.width)),this._super(),e=this,n=(t=$(e.uiDialog)).width(),a=t.height(),s=$(window).width(),o=$(window).height(),s<=480?t.css({width:"100%",height:"100%"}):(a>o&&t.css("height","100%"),n>s&&t.css("width","100%")),$(document).click(),Q($("div.popup > iframe",t)),x(e.uiDialog),this},close:function(){return this._super(),$(".select-menu:visible").remove(),this}}),g.menu.on("click",function(){return A(),!1}),g.back_list.on("click",function(){return M(),!1}),g.back_content.on("click",function(){var e;return e=!0,v.list.addClass("hidden"),v.sidebar.addClass("hidden"),v.content.removeClass("hidden"),e&&v.sidebar.removeClass("layout-sticky"),P(),p.last_selected=v.content[0],!1}),$(".searchbar").each(function(){D(this)}),!u||rcmail.env.extwin||parent.$(".ui-dialog:visible").length?!u&&((n=v.content.find(".boxtitle").first().detach().text())||(n=$("h1.voice").first().text()),n&&v.content.find(".header > .header-title").text(n)):(n=$("h1.voice").first().text())&&parent.$("#layout-content > .header > .header-title:not(.constant)").text(n),$("a[data-content-button]").each(function(){s.push(b($(this)))}),$(".formbuttons").filter(function(){return!$(this).parent(".searchoptions").length}).find("button").each(function(){var e=$(this);if(u||e.parents("#layout-content").length){if(e.is(".cancel")){e.addClass("hidden");return}s.push(b(e))}}),(u?parent.UI:o).register_content_buttons(s),(a=rcmail.gui_objects.messageform)&&(a=$('form[name="'+a+'"]'),$("#_cc, #_bcc, #_replyto, #_followupto",$(".compose-headers")).each(function(){$(this).on("change",function(){$("#compose"+$(this).attr("id"))[this.value?"removeClass":"addClass"]("hidden")})}),$("#compose-options").find("textarea,input,select").each(function(){var e=$("<input>").attr({type:"hidden",name:$(this).attr("name")}).appendTo(a);$(this).attr("tabindex",2).on("change",function(){e.val("checkbox"!=this.type||this.checked?$(this).val():"")}).change()})),$("[data-recipient-input]").each(function(){var e,t,n,a,s,o,l,c,d;e=this,a="",s=function(){$(e).val(t.text()+n.val())},o=function(e,t,a){var l=$('<li class="recipient">'),c=$('<span class="name">').html(function e(t){var n,a,s="",o=t.length;for('"'!=t.charAt(0)&&t.indexOf('"')>-1&&(t='"'+t.replace("\\","\\\\").replace('"','\\"')+'"'),n=0;n<o;n++)switch(a=t.charAt(n)){case'"':if(n>0&&n<o-1){s+='"';break}s+='<span class="quotes">'+a+"</span>";break;case"\\":s+='<span class="quotes">'+a+"</span>","\\"==t.charAt(n+1)&&(s+=a,n++);break;case"<":s+="&lt;";break;case">":s+="&gt;";break;default:s+=a}return s}(e||t)).on("dblclick",function(e){var t,n,a,s,l,c;t=e,n=o,a=$(t.target).parents(".recipient"),s=a.text().replace(/,+$/,""),l=$("<input>").attr({type:"text","data-submit":"true"}).val(s),c=$("<label>").text(rcmail.gettext("recipient")).append(l),rcmail.simple_dialog(c,"recipientedit",function(){var e,t=l.val();if(t){if(t!=s){if(1!=(e=J(t)).recipients.length)return!1;n(e.recipients[0].name,e.recipients[0].email,a)}return!0}})}),d=$('<span class="email">'),u=$("<a>").attr({class:"button icon remove"}).click(function(){return l.remove(),s(),n.focus(),!1});e&&(t=" <"+t+">"),d.text((e?t:"")+","),l.attr("title",e?e+t:null).append([c,d,u]),a?a.replaceWith(l):l.insertBefore(n.parent()),s()},l=function(e){var t;return t=J(e=(e||n.val()).replace(/[,;\s]+$/,"")),$.each(t.recipients,function(){o(this.name,this.email)}),n.val(t.text),s(),t.recipients.length>0},c=function(e,n,a){var s,o,c=this.value;!1!==a&&("paste"==e.type?(o=(e.originalEvent.clipboardData||window.clipboardData).getData("text")||"",c=c.substring(0,this.selectionStart)+o+c.substring(this.selectionEnd),e.preventDefault()):n&&(s=t.find("li.recipient").last()).length&&this.value.indexOf(s.text().replace(/[ ,]+$/,""))>-1&&s.remove(),l(c))},d=function(e){return 8!=e.keyCode||n.val().length?!((" "==e.key||","==e.key||";"==e.key||"Enter"==e.key&&!rcmail.ksearch_visible())&&l())&&void 0:(t.children("li.recipient").last().remove(),s(),!1)},n=$("<input>").attr({type:"text",tabindex:$(e).attr("tabindex")}).on("paste change",c).on("keydown",d).on("blur",function(){t.removeClass("focus")}).on("focus mousedown",function(){t.addClass("focus")}),t=$("<ul>").addClass("form-control recipient-input ac-input rounded-left").append($('<li class="input">').append(n)).on("mouseup",function(){a=window.getSelection().toString()}).on("click",function(){a.length||n.focus()}).sortable({appendTo:document.body,items:"> .recipient",connectWith:".recipient-input",receive:function(e,n){var a=t.text();t.find(".recipient").remove(),l(a),n.sender&&n.sender.find("input").change()}}),$(e).css({position:"absolute",opacity:0,left:"-5000px",width:"10px"}).attr("tabindex",-1).after(t).on("focus",function(e){n.focus(),e.preventDefault()}).on("change",function(){$("li.recipient",t).remove(),n.val(this.value).change()}).change(),rcmail.init_address_input_events(n)}),$(".image-upload").each(function(){var e,t,n,a;e=this,t=$("<a>").attr({class:"icon button delete",href:"#"}).click(function(e){return rcmail.command("delete-photo","",this,e),!1}),n=$(e).find("img")[0],a=function(){var t=-1!=(n.currentSrc||n.src).indexOf(rcmail.env.photo_placeholder);$(e)[t?"removeClass":"addClass"]("changed")},$(e).append(t).click(function(){rcmail.upload_input("upload-form")}),a(),$(n).on("load",a)}),$("textarea[data-html-editor]").each(function(){var e,t,n,a,s,o,l;e=this,n=!1,a=$(e),s=a.parent(),o=$('<a class="mce-i-html" href="#" tabindex="-1"></a>').attr("title",rcmail.gettext("htmltoggle")).on("click",function(e){rcmail.command("toggle-editor",{id:a.attr("id"),html:!0},"",e.originalEvent)&&s.addClass("ishtml")}).on("keydown",function(e){if(9==e.which)return a.focus(),!1}),l=$('<div class="editor-toolbar">').append(o),s.is("td")?(t=$('input[type="checkbox"]',s.parent().next()),n=!0):t=a.next("select.hidden"),function e(t){var n,a,s=function(){if(!t.scrollHeight)return setTimeout(s,250);if(n||(n=parseInt($(t).css("padding-top"))+parseInt($(t).css("padding-bottom"))+2,a=$(t).height()),!(t.scrollHeight-n<=a)){var e,o=0;$(t).parents().each(function(){if(this.scrollTop>0)return e=this,o=this.scrollTop,!1});var l=$(t).outerHeight();$(t).outerHeight(0);var c=Math.max(a,t.scrollHeight);$(t).outerHeight(l),c!==l&&$(t).height(c),o&&(e.scrollTop=o)}};$(t).on("input",s).trigger("input")}(e),1==t.length&&(s.addClass("html-editor"),a.after(l).data("control",t).on("keydown",function(e){e.altKey&&121==e.which&&o.focus()}),n&&(t.parents("tr").first().hide(),s.prev().hide(),s.addClass("col-sm-12")))}),$("#dragmessage-menu,#dragcontact-menu").each(function(){rcmail.gui_object("dragmenu",this.id)}),setTimeout(function(){$(".button-selected").addClass("selected")},50),$(".listbutton").each(function(){var e=y(this.id);$(this).addClass("button").removeClass("listbutton"),e.data.sel&&(e.data.sel=e.data.sel.replace("listbutton","button")),e.data.act&&(e.data.act=e.data.act.replace("listbutton","button")),rcmail.buttons[e.command][e.index]=e.data,rcmail.init_button(e.command,e.data)}),$("[data-hidden]").each(function(){for(var e,t=$(this).data("hidden"),n=$(this).parent("li"),a=/(large|big|small|phone|lbs)/g;e=a.exec(t);)$(n.length?n:this).addClass("hidden-"+e[1])}),$("[data-list]").each(function(){$("input[type=checkbox]",this).each(function(){Z(this)})}),u&&$(".formcontent").each(function(){$(this).next(".formbuttons").length&&$(this).parent().addClass("formcontainer")}),$("#attachment-list + a.zipdownload").appendTo(".header-links"),$("html").filter(".ipad,.iphone,.webkit.mobile,.webkit.tablet").addClass("webkit-scroller").length&&$(v.menu).addClass("webkit-scroller"),$(".treelist").each(function(){var e=this,t=function(){$(e)[$(".treetoggle",e).length>0?"removeClass":"addClass"]("notree")};window.MutationObserver&&new MutationObserver(t).observe(e,{childList:!0,subtree:!0}),t(),$("li.mailbox > a").on("mouseover",function(){rcube_webmail.long_subject_title_ex(this)})}),T()}if(log=Function.prototype.bind.call(console.log,console),warn=Function.prototype.bind.call(console.warn,console),error=Function.prototype.bind.call(console.error,console),window.rcmail)rcmail.show_menu=function(e,t,n){var a="object"==typeof e?e.menu:e,s=$("#"+a);return"string"==typeof e&&(e={menu:a}),rcmail.triggerEvent(!1===t?"menu-close":"menu-open",{name:a,obj:s,props:e,originalEvent:n})},rcmail.hide_menu=function(e,t){return rcmail.triggerEvent("menu-close",{name:e,props:{menu:e},originalEvent:t})};else var contactphoto,rcmail=parent.rcmail,rcube_webmail=parent.rcube_webmail,bw={};var UI=new rcube_elastic_ui;if($&&$.datepicker){var e=$.datepicker._newInst;$.extend($.datepicker,{_newInst:function(t,n){var a=e.call(this,t,n);return a.inline||UI.datepicker_init(a.dpDiv),a}})}if(/*!
 * pulltorefreshjs v0.1.22
 * (c) Rafael Soto
 * Released under the MIT License.
 */ !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).PullToRefresh=t()}(this,function(){var e={pullStartY:null,pullMoveY:null,handlers:[],styleEl:null,events:null,dist:0,state:"pending",timeout:null,distResisted:0,supportsPassive:!1,supportsPointerEvents:"undefined"!=typeof window&&!!window.PointerEvent};try{window.addEventListener("test",null,{get passive(){e.supportsPassive=!0}})}catch(t){}var n,a={setupDOM:function(t){if(!t.ptrElement){var n=document.createElement("div");t.mainElement!==document.body?t.mainElement.parentNode.insertBefore(n,t.mainElement):document.body.insertBefore(n,document.body.firstChild),n.classList.add(t.classPrefix+"ptr"),n.innerHTML=t.getMarkup().replace(/__PREFIX__/g,t.classPrefix),t.ptrElement=n,"function"==typeof t.onInit&&t.onInit(t),e.styleEl||(e.styleEl=document.createElement("style"),e.styleEl.setAttribute("id","pull-to-refresh-js-style"),document.head.appendChild(e.styleEl)),e.styleEl.textContent=t.getStyles().replace(/__PREFIX__/g,t.classPrefix).replace(/\s+/g," ")}return t},onReset:function(t){t.ptrElement&&(t.ptrElement.classList.remove(t.classPrefix+"refresh"),t.ptrElement.style[t.cssProp]="0px",setTimeout(function(){t.ptrElement&&t.ptrElement.parentNode&&(t.ptrElement.parentNode.removeChild(t.ptrElement),t.ptrElement=null),e.state="pending"},t.refreshTimeout))},update:function(t){var n=t.ptrElement.querySelector("."+t.classPrefix+"icon"),a=t.ptrElement.querySelector("."+t.classPrefix+"text");n&&("refreshing"===e.state?n.innerHTML=t.iconRefreshing:n.innerHTML=t.iconArrow),a&&("releasing"===e.state&&(a.innerHTML=t.instructionsReleaseToRefresh),"pulling"!==e.state&&"pending"!==e.state||(a.innerHTML=t.instructionsPullToRefresh),"refreshing"===e.state&&(a.innerHTML=t.instructionsRefreshing))}},s=function(t){return e.pointerEventsEnabled&&e.supportsPointerEvents?t.screenY:t.touches[0].screenY},o=function(){function t(t){var n=e.handlers.filter(function(e){return e.contains(t.target)})[0];e.enable=!!n,n&&"pending"===e.state&&(d=a.setupDOM(n),n.shouldPullToRefresh()&&(e.pullStartY=s(t)),clearTimeout(e.timeout),a.update(n))}function o(t){d&&d.ptrElement&&e.enable&&(e.pullStartY?e.pullMoveY=s(t):d.shouldPullToRefresh()&&(e.pullStartY=s(t)),"refreshing"!==e.state?("pending"===e.state&&(d.ptrElement.classList.add(d.classPrefix+"pull"),e.state="pulling",a.update(d)),e.pullStartY&&e.pullMoveY&&(e.dist=e.pullMoveY-e.pullStartY),e.distExtra=e.dist-d.distIgnore,e.distExtra>0&&(t.cancelable&&t.preventDefault(),d.ptrElement.style[d.cssProp]=e.distResisted+"px",e.distResisted=d.resistanceFunction(e.distExtra/d.distThreshold)*Math.min(d.distMax,e.distExtra),"pulling"===e.state&&e.distResisted>d.distThreshold&&(d.ptrElement.classList.add(d.classPrefix+"release"),e.state="releasing",a.update(d)),"releasing"===e.state&&e.distResisted<d.distThreshold&&(d.ptrElement.classList.remove(d.classPrefix+"release"),e.state="pulling",a.update(d)))):t.cancelable&&d.shouldPullToRefresh()&&e.pullStartY<e.pullMoveY&&t.preventDefault())}function l(){if(d&&d.ptrElement&&e.enable){if(clearTimeout(n),n=setTimeout(function(){d&&d.ptrElement&&"pending"===e.state&&a.onReset(d)},500),"releasing"===e.state&&e.distResisted>d.distThreshold)e.state="refreshing",d.ptrElement.style[d.cssProp]=d.distReload+"px",d.ptrElement.classList.add(d.classPrefix+"refresh"),e.timeout=setTimeout(function(){var e=d.onRefresh(function(){return a.onReset(d)});e&&"function"==typeof e.then&&e.then(function(){return a.onReset(d)}),e||d.onRefresh.length||a.onReset(d)},d.refreshTimeout);else{if("refreshing"===e.state)return;d.ptrElement.style[d.cssProp]="0px",e.state="pending"}a.update(d),d.ptrElement.classList.remove(d.classPrefix+"release"),d.ptrElement.classList.remove(d.classPrefix+"pull"),e.pullStartY=e.pullMoveY=null,e.dist=e.distResisted=0}}function c(){d&&d.mainElement.classList.toggle(d.classPrefix+"top",d.shouldPullToRefresh())}var d,u=e.supportsPassive?{passive:e.passive||!1}:void 0;return e.pointerEventsEnabled&&e.supportsPointerEvents?(window.addEventListener("pointerup",l),window.addEventListener("pointerdown",t),window.addEventListener("pointermove",o,u)):(window.addEventListener("touchend",l),window.addEventListener("touchstart",t),window.addEventListener("touchmove",o,u)),window.addEventListener("scroll",c),{onTouchEnd:l,onTouchStart:t,onTouchMove:o,onScroll:c,destroy:function(){e.pointerEventsEnabled&&e.supportsPointerEvents?(window.removeEventListener("pointerdown",t),window.removeEventListener("pointerup",l),window.removeEventListener("pointermove",o,u)):(window.removeEventListener("touchstart",t),window.removeEventListener("touchend",l),window.removeEventListener("touchmove",o,u)),window.removeEventListener("scroll",c)}}},l={distThreshold:60,distMax:80,distReload:80,distIgnore:0,mainElement:"body",triggerElement:"body",ptrElement:".ptr",classPrefix:"ptr--",cssProp:"min-height",iconArrow:"&#8675;",iconRefreshing:"&hellip;",instructionsPullToRefresh:"Pull down to refresh",instructionsReleaseToRefresh:"Release to refresh",instructionsRefreshing:"Refreshing",refreshTimeout:500,getMarkup:function(){return'\n<div class="__PREFIX__box">\n  <div class="__PREFIX__content">\n    <div class="__PREFIX__text"></div>\n  </div>\n</div>\n'},getStyles:function(){return"\n.__PREFIX__ptr {\n  pointer-events: none;\n  font-size: 0.85em;\n  font-weight: bold;\n  height: 0;\n  transition: height 0.3s, min-height 0.3s;\n  text-align: center;\n  width: 100%;\n  overflow: hidden;\n  display: flex;\n  align-items: flex-end;\n  align-content: stretch;\n}\n\n.__PREFIX__box {\n  padding: 10px;\n  flex-basis: 100%;\n}\n\n.__PREFIX__pull {\n  transition: none;\n}\n\n.__PREFIX__text {\n  margin-top: .33em;\n}\n\n.__PREFIX__icon {\n  transition: transform .3s;\n}\n\n/*\nWhen at the top of the page, disable vertical overscroll so passive touch\nlisteners can take over.\n*/\n.__PREFIX__top {\n  touch-action: pan-x pan-down pinch-zoom;\n}\n\n.__PREFIX__release .__PREFIX__icon {\n  transform: rotate(180deg);\n}\n"},onInit:function(){},onRefresh:function(){return location.reload()},resistanceFunction:function(e){return Math.min(1,e/2.5)},shouldPullToRefresh:function(){return!window.scrollY}},c=["mainElement","ptrElement","triggerElement"],d=function(t){var n={};return Object.keys(l).forEach(function(e){n[e]=t[e]||l[e]}),n.refreshTimeout="number"==typeof t.refreshTimeout?t.refreshTimeout:l.refreshTimeout,c.forEach(function(e){"string"==typeof n[e]&&(n[e]=document.querySelector(n[e]))}),e.events||(e.events=o()),n.contains=function(e){return n.triggerElement.contains(e)},n.destroy=function(){clearTimeout(e.timeout);var t=e.handlers.indexOf(n);e.handlers.splice(t,1)},n};return{setPassiveMode:function(t){e.passive=t},setPointerEventsMode:function(t){e.pointerEventsEnabled=t},destroyAll:function(){e.events&&(e.events.destroy(),e.events=null),e.handlers.forEach(function(e){e.destroy()})},init:function(t){void 0===t&&(t={});var n=d(t);return e.handlers.push(n),n},_:{setupHandler:d,setupEvents:o,setupDOM:a.setupDOM,onReset:a.onReset,update:a.update}}}),"small"==UI.get_screen_mode()&&document.getElementById("messagelist-content")&&PullToRefresh.init({mainElement:"#messagelist",onRefresh:function(){return new Promise(function(e){setTimeout(function(){UI_pull_to_refresh(e)},0)})},shouldPullToRefresh:function(){return!(document.querySelector("#greydiv")&&document.querySelector("#greydiv").classList.contains("fadeoff70create"))&&!document.getElementById("messagelist-content").scrollTop},refreshTimeout:50,instructionsPullToRefresh:'<i class="sebicon iconrefresh icon_pulltorefresh" ></i>',instructionsRefreshing:'<i class="sebicon iconrefresh icon_pulltorefresh anim_rotatepulltorefresh" ></i>',instructionsReleaseToRefresh:'<i class="sebicon iconrefresh icon_pulltorefresh"></i>'}),document.getElementById("messagelist-content")&&(document.getElementById("messagelist-content").addEventListener("wheel",e=>{scroll_mailbymail(e)}),new ResizeObserver(resizemessagelist).observe(document.getElementById("messagelist-content"))),document.getElementsByClassName("gitissue16").length){var t=$("#folderlist-content").width()-$("#mailboxlist").width();$(".gitissue16 a").css({marginRight:t+"px"})}function resizemessagelist(){if(document.getElementById("messagelist-content")){if(document.getElementById("searchmenu").classList.contains("hidden")?$("#messagelist-header").show():$("#messagelist-header").hide(),document.getElementById("searchmenu").classList.contains("hidden")){var e=document.getElementById("messagelist-content"),t=e.offsetHeight;if(e.querySelector(".message")){var n=e.querySelector(".message").getBoundingClientRect().height;e.style.paddingBottom=t%n+"px"}}}}function scroll_mailbymail(e){e.preventDefault(),e.stopPropagation();var t=document.getElementById("messagelist-content"),n=t.scrollTop,a=t.querySelectorAll("tr.message");a=Array.from(a).filter(e=>"none"!=e.style.display);for(var s=0;s<a.length&&!(n<=a[s].offsetTop);s++);a[s].offsetTop-n>15&&e.deltaY>0&&s--,e.deltaY>0?s++:s--,s<0&&(s=0),s>=a.length&&(s=a.length),t.scrollTop=a[s].offsetTop}function refresh_mail_anim(){var e=document.getElementsByClassName("refresh")[0];e.classList.add("anim_rotate"),e.classList.add("disabled"),UI_pull_to_refresh(function(){e.classList.remove("anim_rotate"),e.classList.remove("disabled")}),document.activeElement.blur()}var r=document.getElementsByClassName("refresh");if(r.length&&(r[0].setAttribute("onClick","refresh_mail_anim()"),r[0].style.width="45px"),document.documentElement.classList.contains("iframe")){var n=document.querySelector(".header-content");if(n&&(set_onclick_to_class(n,".flag","return parent.rcmail.command('mark','flagged','',this,event)"),set_onclick_to_class(n,".unread","return parent.rcmail.command('mark','unread',this,event)"),set_onclick_to_class(n,".delete","return parent.rcmail.command('delete','',this,event)")),parent.rcmail.env.archive_folder){var a,s=document.getElementById("message-header").querySelector(".reply"),o=document.createElement("a");o.className="button archive hide_small",o.onclick=function(e){return parent.rcmail.command("plugin.archive","",this,e)},o.innerHTML="<span class='inner'>"+parent.rcmail.labels["archive.buttontext"]+"</span>",s.parentElement.insertBefore(o,s);var l=document.getElementById("message-menu-inner").querySelector(".unread").parentNode,c=document.createElement("li");c.onclick=function(e){return parent.rcmail.command("plugin.archive","",this,e)},c.innerHTML='<a class="archive" id="" role="button" tabindex="0" aria-disabled="false" href="#" onclick="return parent.rcmail.command(\'plugin.archive\',\'\',this,event)" title=""><span class="inner">'+parent.rcmail.labels["archive.buttontext"]+"</span></a>",l.parentElement.insertBefore(c,l),parent.document.getElementById("header_topmenu_archive").style.display="inline-block"}}function change_contactphoto_by_divLetter(){var e=$(".contactphoto")[0],t=document.createElement("div");t.className="sel_circle maillogo_no_select replacecontactpic";var n=textforcircle($(".header .from").text()),a=colors_from_txt(n);t.style.backgroundColor="#"+a,t.innerHTML=n,e.parentElement.appendChild(t),e.style.display="none"}function flag_click(){window.frameElement?(parent.messagelist.querySelector(".focused").querySelector(".flag").firstChild.click(),parent.hide_messagestack_few_secs()):(document.body.classList.contains("status-flagged")?rcmail.command("mark","unflagged",this,event):rcmail.command("mark","flagged",this,event),hide_messagestack_few_secs())}function unread_click(){window.frameElement?(parent.messagelist.querySelector(".focused").querySelector(".msgicon").click(),parent.hide_messagestack_few_secs()):rcmail.command("mark","unread",this,event)}function hide_messagestack_few_secs(){document.getElementById("messagestack").style.visibility="hidden",UI_pull_to_refresh_check(function(){})}function set_onclick_to_class(e,t,n){for(var a=e.querySelectorAll(t),s=0;s<a.length;s++)a[s].setAttribute("onClick",n)}function UI_pull_to_refresh(e){document.getElementById("messagestack").style.visibility="hidden",rcmail.command("checkmail","",!1,!1),UI_pull_to_refresh_check(e)}function UI_pull_to_refresh_check(e){$("#messagestack").html()?setTimeout(function(){UI_pull_to_refresh_check(e)},100):(document.getElementById("messagestack").style.visibility="visible",e())}function listupdate_go_msgs(){for(var e=document.getElementById("messagelist").querySelectorAll(".message"),t=JSON.parse(localStorage.contactphoto??"{}"),n=0;n<e.length;n++){var a=e[n].querySelector(".selection");if(!a.querySelector(".sel_circle")){a.querySelector("input").style.display="none";var s=document.createElement("div");s.className="sel_circle maillogo_no_select",s.onclick=function(e){e.preventDefault()};var o="";if(e[n].querySelector(".rcmContactAddress"))var o=e[n].querySelector(".rcmContactAddress").title;var l=urlencode(o);if(1==t[l])s.style.backgroundImage="url('?_task=addressbook&_action=photo&_email="+l+"&_error=1&_bgcolor=transparent')",s.style.backgroundColor="";else{var c=get_personna_from_mailblock(e[n]),d=colors_from_txt(c);s.style.backgroundColor="#"+d,s.innerHTML=c}a.appendChild(s);var s=document.createElement("div");s.className="sel_circle maillogo_is_select",s.onclick=function(e){e.preventDefault()},s.style.backgroundColor="#0078D4",s.innerHTML="<i class='sebicon selecticon' style='color:#fff' onclick='return function(e){e.preventDefault()}'></i>",a.appendChild(s)}var u=e[n].querySelectorAll(".attachment").length,p=e[n].querySelectorAll(".report").length;if((2==u||p)&&(e[n].querySelector(".subject").querySelector(".subject").style.paddingRight="18px"),!e[n].querySelector(".deleteicon")){var m=e[n].querySelector(".size"),s=document.createElement("span");if(s.className="sebicon deleteicon insummary",s.onclick=function(e){var t=e.target.closest(".message").uid;rcmail.env.mailbox==rcmail.env.trash_mailbox?rcmail.with_selected_messages("delete",{_uid:[t]}):rcmail.command("move",{id:rcmail.env.trash_mailbox,uids:[t]},"",event,!0)},!m){var m=document.createElement("span");m.className="size skip-on-drag",e[n].querySelector(".date").after(m)}m.appendChild(s)}}setTimeout(try_changeletters_by_image,0)}function try_changeletters_by_image(){for(var e=document.getElementById("messagelist").querySelectorAll(".message"),t=0;t<e.length;t++)if(e[t].querySelector(".maillogo_no_select").innerHTML){var n=urlencode(e[t].querySelector(".rcmContactAddress").title);if(is_contactphoto(n)){var a=e[t].querySelector(".maillogo_no_select");a.innerHTML="",a.style.backgroundImage="url('?_task=addressbook&_action=photo&_email="+n+"&_error=1&_bgcolor=transparent')",a.style.backgroundColor=""}}}function elastic2022_logout(){delete localStorage.contactphoto,rcmail.command("switch-task","logout",!1,!1)}function is_contactphoto(e){var t=JSON.parse(localStorage.contactphoto??"{}");if(void 0!==t[e])return t[e];var n=new XMLHttpRequest;return(n.open("GET","?_task=addressbook&_action=photo&_email="+e+"&_error=1&_bgcolor=transparent",!1),n.onerror=function(){console.log("** An error occurred during the check")},n.send(),4!=n.readyState)?(error("xmlhttprequest"),!1):4==n.readyState&&200==n.status?(LS_add_info(e,1),!0):4==n.readyState&&204==n.status?(LS_add_info(e,0),!1):void 0}function LS_add_info(e,t){var n=JSON.parse(localStorage.contactphoto??"{}");n[e]=t,localStorage.contactphoto=JSON.stringify(n)}function LS_remove_contact(){var e=urlencode($("#ff_email0")[0].value);LS_remove(e)}function LS_remove(e){var t=JSON.parse(localStorage.contactphoto??"{}");delete t[e],localStorage.contactphoto=JSON.stringify(t)}function get_personna_from_mailblock(e){return e.querySelector(".rcmContactAddress")?textforcircle(e.querySelector(".rcmContactAddress").textContent):""}function textforcircle(e){var t=(e=e.trim().replace(/[|&;$%@"<>()+-.,]/g,"").trim()).split(" "),n=e.charAt(0);return t[1]&&(n+=t[1].charAt(0)),n.toUpperCase()}function colors_from_txt(e){if(!e)return"AAA";for(var t="DF71AE D45345 9877D5 6EB9C2 A47563 E1843B 62BF78 5196D5 EACF47".split(" "),n=0,a=0;a<e.length;a++)n+=e.charAt(a).charCodeAt(0)+255*a;return t[n%t.length]}function click_menu(){if(!document.querySelector("#greydiv")){var e=document.createElement("div");e.id="greydiv",e.onclick=function(){close_leftmenu()},document.body.appendChild(e)}document.querySelector("#greydiv").classList.add("fadeoff70create"),document.querySelector("#menuleft")||document.querySelector("#greydiv").insertAdjacentHTML("afterend","<div id='menuleft'><div>&nbsp;</div><div id='menuleft_cont'></div><hr style='margin-top:40px;border-top:1px solid #374549;width: 80%;'><div id='menuleft_bottom' class='menu'></div></div>");var t=document.querySelector("#menuleft");if(setTimeout(function(){t.classList.add("menu_marginleft")},0),"mail"==rcmail.env.task&&(is_plugin_ident_switch_account()&&$("#menuleft_cont").append($("#plugin-ident_switch-account")),$("#menuleft_cont").append($("#folderlist-content")),$("#menuleft_cont").append($(".gitissue16"))),"addressbook"==rcmail.env.task&&($("#menuleft_cont").append($("#directorylist")),$("#directorylist").append($("#layout-sidebar .header a"))),"calendar"==rcmail.env.task&&($("#menuleft_cont").append($("#layout-sidebar .searchbar")),$("#menuleft_cont").append($("#calendars-content"))),!menuleft_cont.classList.contains("link_added")){var n="",a=document.querySelector(".menu_bottom").querySelectorAll("a");for(i=0;i<a.length;++i)n+="<div class='menuopt'>"+a[i].outerHTML+"</div>";n+=document.querySelector("#taskmenu").innerHTML,document.querySelector("#menuleft_bottom").innerHTML=n,$("#mailboxlist a").on("click",function(){close_leftmenu()}),$("#menuleft_bottom > .click_change_theme").click(function(){$("#taskmenu .click_change_theme").click()}),menuleft_cont.classList.add("link_added")}}function close_leftmenu(){document.querySelector("#greydiv").classList.contains("fadeoff70create")&&(document.querySelector("#greydiv").classList.remove("fadeoff70create"),document.querySelector("#menuleft").classList.remove("menu_marginleft"),"mail"==rcmail.env.task&&setTimeout(function(){is_plugin_ident_switch_account()&&$(".header-title.username").append($("#plugin-ident_switch-account")),$("#folderlist-content").insertBefore($(".menu.menu_bottom")),$(".gitissue16").insertBefore($(".menu.menu_bottom"))},300),"addressbook"==rcmail.env.task&&setTimeout(function(){$("#directorylist").insertBefore($("#layout-sidebar .scroller")),$("#layout-sidebar .header").append($("#directorylist a.sidebar-menu"))},300),"calendar"==rcmail.env.task&&(setTimeout(function(){$("#menuleft .searchbar").insertBefore($(".menu.menu_bottom"))},50),setTimeout(function(){$("#calendars-content").insertBefore($(".menu.menu_bottom"))},50)))}function dtel(e){$("#mailboxlist a")[0].text=e}function mail_menu_show_attachement(){$("#layout-sidebar").removeClass("hidden"),$("#layout-content").addClass("hidden"),UI.screen_resize_headers()}"preview"==rcmail.env.action&&($(".contactphoto")[0].onerror=function(){change_contactphoto_by_divLetter()}),window.onmessage=function(e){"headers_dialog"==e.data&&UI.headers_dialog(),"resize_message"==e.data&&autoscale_message_reset()};var use_autoscale=1;function autoscale_message_reset(){if(use_autoscale){delete document.body.dataset.originalscrollWidth;var e=document.querySelector("#messagebody").style;e.width="",e.height="",e.transform="",e.transformOrigin="","no"!=$("#divscale_default").data("scale")&&setTimeout(function(){autoscale_message()},0)}}function autoscale_message(){if(window.innerWidth-$(document).width()>=0){$("#divscale_default").css("display","none");return}$("#divscale_default").css("display","inline-block");var e=document.body.scrollWidth,t=document.querySelector("#messagebody").style;if(t.width=e+"px",document.body.dataset.originalscrollWidth)var n=document.body.dataset.originalscrollWidth,a=document.body.dataset.originalHeight;else{var n=document.body.scrollWidth,a=document.querySelector("#message-htmlpart1").getBoundingClientRect().height;document.body.dataset.originalscrollWidth=n,document.body.dataset.originalHeight=a}var s=(document.body.clientWidth-7)/n;t.height=a*s+"px",t.transform="scale("+s+")",t.transformOrigin="0 0"}function scale_default(){$("#divscale_default").css("display","none"),$("#divscale_default").data("scale","no"),autoscale_message_reset()}function go_PWA(){var e=window.location.href,t=e.substring(0,e.lastIndexOf("/"))+"/",n={name:"Rouncube",theme_color:$('meta[name="theme-color"]').attr("content"),start_url:t,icons:[{src:t+"/skins/elastic2022/images/rc192x192.png",sizes:"192x192",purpose:"maskable",purpose:"any"},{src:t+"/skins/elastic2022/images/rc512x512.png",sizes:"512x512",purpose:"maskable",purpose:"any"}],display:"standalone"};let a=JSON.stringify(n),s=new Blob([a],{type:"application/json"}),o=new FileReader;o.readAsDataURL(s),o.onload=function(){var e=document.createElement("link");e.href=o.result,e.rel="manifest",document.getElementsByTagName("head")[0].appendChild(e)}}function define_priority(e){var t=0;e.checked&&(t=2);var e=$("#compose-priority")[0];e.value=t,e.dispatchEvent(new Event("change"))}function is_plugin_ident_switch_account(){return 0!=$("#plugin-ident_switch-account").length}function init_plugin_ident_switch_account(){$sw=$("#plugin-ident_switch-account"),plugin_switchIdent_addCbElastic2022($sw)&&$sw.show()}function plugin_switchIdent_addCbElastic2022(e){var t=$(".header-title.username");return t.length>0&&(t.prepend(e),!0)}function elastic2022_change_mailheader(){var e=$(".header-headers .date")[0].closest("tr");e.querySelector(".header-title").style.visibility="hidden",e.parentElement.appendChild(e),$(".header-headers .date")[0].innerHTML="<span class='tddatemovetoright'>"+$(".header-headers .date").text()+"</span>",$(".header-headers .replyto").parent().remove(),$(".header-headers .sender").each(function(){var e;$(".header-headers .from .adr a")[0].href==jQuery(this).find(".rcmContactAddress")[0].href&&this.parentElement.remove()}),$(".header-headers .priority .prio3").closest("tr").remove(),$(".header-headers .header-title").first().remove(),$(".header-headers .header.from").attr("colspan",2),$(".header-headers .header-title").last().text("").width(0)}function elastic2022_change_attachmentslist(){if($(".attachment-size").each(function(){this.innerText=this.innerText.replace(/[()~]/g,"")}),$(".attachmentslist .filename").off(),$(".attachmentslist .filename").removeAttr("onclick"),$(".attachmentslist .filename").attr("target","_blank"),$(".attachmentslist li:not(.rfc822, .pdf, .image) .filename").attr("download",""),$(".attachmentslist .image").each(function(){var e=jQuery(this).find(".filename")[0].href;e+="&_embed=1&_mimeclass=image&_thumb=1",jQuery(this).find(".filename").append("<div class='attachmentslistthumnb' style='background-image: url("+e+");'></div>")}),"function"==typeof rcube_calendar){var e=$("#attachmentsavecal").text();$(".attachmentslist .ics").each(function(){jQuery(this).find(".filename").append("<div class='attachmentslistplus' title='"+e+"' onclick='click_add_calendar(event,this)'></div>")})}if($(".attachmentslist .rfc822").each(function(){var e=jQuery(this).find(".filename")[0],t=e.href;e.href+="&_extwin=1&_frame=1",e.dataset.original_href=t,jQuery(this).find(".filename").append("<div class='attachmentslistplus' onclick='click_dl_attachement(this)'></div>")}),$(".attachmentslist .audio").each(function(){jQuery(this).find(".filename").append("<div class='attachmentslistplus' onclick='audiobutton(event,this)'></div>")}),$(".zipdownload").length){var t=$(".zipdownload")[0];$(".tdzipdownload").css("display","table-cell"),$(".tdzipdownload").prop("title",t.innerText),$(".tdzipdownload").on("click",function(){window.location=t.href}),$(".tdattachmentslist").attr("style","padding-right: 6px !important"),$(".zipdownload").remove()}$(".attachmentslist li").length>3&&($("#attach_fullsize").show(),setTimeout(function(){$("#attach_fullsize").show()},300),$(".attachmentslist").css("max-height","100px"))}function audiobutton(e,t){var n=$("#audioplayer")[0],a=jQuery(t).closest(".filename")[0].href;if(n.src==a){if(!1==n.paused){n.pause(),t.classList.remove("audiopause"),e.preventDefault();return}}else audioend(),n.src=a;n.play(),t.classList.add("audiopause"),audioanim(),e.preventDefault()}function audioanim(){var e=$(".audiopause")[0],t=$("#audioplayer")[0],n=100*t.currentTime/t.duration;log(t.currentTime+" / "+t.duration),isNaN(n)&&(n=0),n>=100&&audioend(),e&&(e.closest("li").style.backgroundSize=n+"% 42px",setTimeout(function(){audioanim()},50))}function audioend(){$(".audio").css("background-size","0% 42px"),$(".audiopause").removeClass("audiopause")}function click_add_calendar(e,t){var n=t.closest("li").id.replace("attach",""),a=$.ajax("?_task=calendar&_action=print",{async:!1}).responseText,s=a.indexOf("rcmail.set_env({")+15,o=a.indexOf("\n",s)-2,l=JSON.parse(a.substring(s,o)),c=0;$.each(l.calendars,function(e,t){t.editable&&c++}),1==c?rcmail.http_post("calendar/mailimportattach",{_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_part:n},rcmail.set_busy(!0,"itip.savingdata")):(rcmail.command("menu-open",{menu:"popupcalendarchoice",link:t},t,e),$("#popupcalendarchoice ul").empty(),$.each(l.calendars,function(e,t){if(t.editable){var a=t.name,s=t.calendar_id;$("#popupcalendarchoice ul").append($('<li role="menuitem" onclick="click_add_calendarid('+s+",'"+n+'\')"><a class="calendar" role="button" tabindex="-1" aria-disabled="true" href="#">'+a+"</a></li>"))}})),e.preventDefault()}function click_dl_attachement(e){var t=e.closest("a").dataset.original_href;location.assign(t),event.preventDefault()}function click_add_calendarid(e,t){rcmail.http_post("calendar/mailimportattach",{_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_part:t,_calendar:e},rcmail.set_busy(!0,"itip.savingdata"))}function attach_fullsize(){$(".attachmentslist").css("max-height","unset"),$("#attach_fullsize").hide()}function click_from_button(e){if(!e.disabled){var t=e.checked;rcmail.set_cookie("fromButton",t,!1),t?$("#compose_from").show():$("#compose_from").hide()}}function e2022_sortmenu_start(){$("#listsort-menu .submit").removeClass("submit");var e=rcmail.env.sort_col;e||(e="arrival"),$("#listsort-menu ."+e).addClass("submit"),$("#listsort-menu ."+rcmail.env.sort_order).addClass("submit")}function e2022_sortmenu(){var e=event.target;e.closest("ul").querySelector(".submit").classList.remove("submit"),e.classList.add("submit"),e2022_sortmenu_refresh()}function e2022_sortmenu_refresh(){var e=[...document.querySelector(".sort_order .submit").classList].filter(e=>"submit"!=e)[0],t=[...document.querySelector(".sort_col .submit").classList].filter(e=>"submit"!=e)[0];rcmail.set_list_sorting(t,e),rcmail.list_mailbox("","",t+"_"+e)}function e2022_filtermenu(){var e=[...event.target.classList].filter(e=>e.startsWith("_"))[0].replace("_","");"WITHATTACHMENT"==e&&(e="OR OR OR HEADER Content-Type application/ HEADER Content-Type multipart/mixed HEADER Content-Type multipart/signed HEADER Content-Type multipart/report"),$(rcmail.gui_objects.search_filter).val(e),rcmail.command("search")}go_PWA();